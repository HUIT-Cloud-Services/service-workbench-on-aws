{"version":3,"sources":["../../../../../src/parts/workflows/drafts/edit/WorkflowDraftMetaEditor.js"],"names":["_","React","observer","inject","decorate","action","runInAction","observable","Button","Header","Divider","Icon","displayError","displaySuccess","Form","DropDown","Input","TextArea","WorkflowDraftMetaEditor","Component","constructor","props","handleCancel","resetFlags","onCancel","noop","handlePrevious","event","preventDefault","stopPropagation","getEditor","previousPage","handleFormSubmission","form","editor","title","desc","instanceTtl","runSpecSize","runSpecTarget","values","draft","version","setTitle","setDescription","setInstanceTtl","setRunSpec","size","target","update","clickedOnNext","nextPage","error","handleFormErrors","window","scrollTo","componentDidMount","getVersion","getMetaForm","metaForm","handleOnSubmitNext","onSubmit","render","hasPrevious","hasPreviousPage","titleField","$","descField","instanceTtlField","runSpecSizeField","runSpecTargetField","processing","e"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,OAAOA,CAAP,MAAc,QAAd;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAASC,QAAT,EAAmBC,MAAnB,QAAiC,YAAjC;AACA,SAASC,QAAT,EAAmBC,MAAnB,EAA2BC,WAA3B,EAAwCC,UAAxC,QAA0D,MAA1D;AACA,SAASC,MAAT,EAAiBC,MAAjB,EAAyBC,OAAzB,EAAkCC,IAAlC,QAA8C,mBAA9C;AACA,SAASC,YAAT,EAAuBC,cAAvB,QAA6C,2CAA7C;AACA,OAAOC,IAAP,MAAiB,gDAAjB;AACA,OAAOC,QAAP,MAAqB,oDAArB;AACA,OAAOC,KAAP,MAAkB,iDAAlB;AACA,OAAOC,QAAP,MAAqB,oDAArB,C,CAEA;AACA;AACA;;AACA,MAAMC,uBAAN,SAAsCjB,KAAK,CAACkB,SAA5C,CAAsD;AACpDC,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,UAAMA,KAAN;;AADiB,SAgCnBC,YAhCmB,GAgCJ,MAAM;AACnB,WAAKC,UAAL;AACA,YAAMC,QAAQ,GAAG,KAAKH,KAAL,CAAWG,QAAX,IAAuBxB,CAAC,CAACyB,IAA1C;AACAD,MAAAA,QAAQ;AACT,KApCkB;;AAAA,SAsCnBE,cAtCmB,GAsCFC,KAAK,IAAI;AACxB;AACA,WAAKJ,UAAL;AACAI,MAAAA,KAAK,CAACC,cAAN;AACAD,MAAAA,KAAK,CAACE,eAAN;AACA,WAAKC,SAAL,GAAiBC,YAAjB;AACD,KA5CkB;;AAAA,SAuDnBC,oBAvDmB,GAuDI,MAAMC,IAAN,IAAc;AACnC,YAAMC,MAAM,GAAG,KAAKJ,SAAL,EAAf;AACA,YAAM;AAAEK,QAAAA,KAAF;AAASC,QAAAA,IAAT;AAAeC,QAAAA,WAAf;AAA4BC,QAAAA,WAA5B;AAAyCC,QAAAA;AAAzC,UAA2DN,IAAI,CAACO,MAAL,EAAjE;AACA,YAAM;AAAEC,QAAAA;AAAF,UAAYP,MAAlB;AACA,YAAMQ,OAAO,GAAGR,MAAM,CAACQ,OAAvB;AAEAA,MAAAA,OAAO,CAACC,QAAR,CAAiBR,KAAjB;AACAO,MAAAA,OAAO,CAACE,cAAR,CAAuBR,IAAvB;AACAM,MAAAA,OAAO,CAACG,cAAR,CAAuBR,WAAvB;AACAK,MAAAA,OAAO,CAACI,UAAR,CAAmB;AACjBC,QAAAA,IAAI,EAAET,WADW;AAEjBU,QAAAA,MAAM,EAAET;AAFS,OAAnB;;AAKA,UAAI;AACF,cAAML,MAAM,CAACe,MAAP,CAAcR,KAAd,CAAN;;AACA,YAAI,KAAKS,aAAT,EAAwB;AACtB,eAAKpB,SAAL,GAAiBqB,QAAjB;AACA;AACD;;AACDtC,QAAAA,cAAc,CAAC,0CAAD,CAAd;AACD,OAPD,CAOE,OAAOuC,KAAP,EAAc;AACd9C,QAAAA,WAAW,CAAC,MAAM;AAChB,eAAKiB,UAAL;AACD,SAFU,CAAX;AAGAX,QAAAA,YAAY,CAACwC,KAAD,CAAZ;AACD;AACF,KAlFkB;;AAAA,SAoFnBC,gBApFmB,GAoFA,MAAM;AACvBC,MAAAA,MAAM,CAACC,QAAP,CAAgB,CAAhB,EAAmB,CAAnB;AACD,KAtFkB;;AAGjBjD,IAAAA,WAAW,CAAC,MAAM;AAChB,WAAK4C,aAAL,GAAqB,KAArB;AACD,KAFU,CAAX;AAGD;;AAEDM,EAAAA,iBAAiB,GAAG;AAClBF,IAAAA,MAAM,CAACC,QAAP,CAAgB,CAAhB,EAAmB,CAAnB;AACD,GAXmD,CAapD;;;AACAzB,EAAAA,SAAS,GAAG;AACV,WAAO,KAAKT,KAAL,CAAWa,MAAlB;AACD,GAhBmD,CAkBpD;;;AACAuB,EAAAA,UAAU,GAAG;AACX,WAAO,KAAK3B,SAAL,GAAiBY,OAAxB;AACD;;AAEDgB,EAAAA,WAAW,GAAG;AACZ,WAAO,KAAK5B,SAAL,GAAiB6B,QAAxB;AACD;;AAEDpC,EAAAA,UAAU,GAAG;AACX;AACA;AACA,SAAK2B,aAAL,GAAqB,KAArB;AACD;;AAgBDU,EAAAA,kBAAkB,CAACjC,KAAD,EAAQkC,QAAR,EAAkB;AAClClC,IAAAA,KAAK,CAACC,cAAN;AACAD,IAAAA,KAAK,CAACE,eAAN;AACA,SAAKN,UAAL;AACA,SAAK2B,aAAL,GAAqB,IAArB;AAEAW,IAAAA,QAAQ,CAAClC,KAAD,CAAR,CANkC,CAMjB;AAClB;;AAmCDmC,EAAAA,MAAM,GAAG;AACP,UAAM5B,MAAM,GAAG,KAAKJ,SAAL,EAAf;AACA,UAAMiC,WAAW,GAAG7B,MAAM,CAAC8B,eAA3B;AACA,UAAM/B,IAAI,GAAG,KAAKyB,WAAL,EAAb;AACA,UAAMO,UAAU,GAAGhC,IAAI,CAACiC,CAAL,CAAO,OAAP,CAAnB;AACA,UAAMC,SAAS,GAAGlC,IAAI,CAACiC,CAAL,CAAO,MAAP,CAAlB;AACA,UAAME,gBAAgB,GAAGnC,IAAI,CAACiC,CAAL,CAAO,aAAP,CAAzB;AACA,UAAMG,gBAAgB,GAAGpC,IAAI,CAACiC,CAAL,CAAO,aAAP,CAAzB;AACA,UAAMI,kBAAkB,GAAGrC,IAAI,CAACiC,CAAL,CAAO,eAAP,CAA3B;AAEA,wBACE,oBAAC,IAAD;AACE,MAAA,IAAI,EAAEjC,IADR;AAEE,MAAA,QAAQ,EAAE,KAAKX,YAFjB;AAGE,MAAA,SAAS,EAAE,KAAKU,oBAHlB;AAIE,MAAA,OAAO,EAAE,KAAKqB;AAJhB,OAMG,CAAC;AAAEkB,MAAAA,UAAF;AAAcV,MAAAA,QAAd;AAAwBrC,MAAAA;AAAxB,KAAD,kBACC,uDACE,oBAAC,KAAD;AAAO,MAAA,KAAK,EAAEyC,UAAd;AAA0B,MAAA,QAAQ,EAAEM;AAApC,MADF,eAEE,oBAAC,QAAD;AAAU,MAAA,KAAK,EAAEJ,SAAjB;AAA4B,MAAA,IAAI,EAAE,CAAlC;AAAqC,MAAA,QAAQ,EAAEI;AAA/C,MAFF,eAGE,oBAAC,OAAD;AAAS,MAAA,UAAU,MAAnB;AAAoB,MAAA,SAAS,EAAC;AAA9B,oBACE,oBAAC,MAAD;AAAQ,MAAA,EAAE,EAAC,IAAX;AAAgB,MAAA,SAAS,EAAC;AAA1B,oBACE,oBAAC,IAAD;AAAM,MAAA,IAAI,EAAC,wBAAX;AAAoC,MAAA,SAAS,EAAC;AAA9C,MADF,eADF,CAHF,eASE,oBAAC,KAAD;AAAO,MAAA,KAAK,EAAEH,gBAAd;AAAgC,MAAA,QAAQ,EAAEG;AAA1C,MATF,eAUE,oBAAC,QAAD;AAAU,MAAA,KAAK,EAAEF,gBAAjB;AAAmC,MAAA,QAAQ,EAAEE,UAA7C;AAAyD,MAAA,KAAK,EAAE,KAAhE;AAAuE,MAAA,SAAS;AAAhF,MAVF,eAWE,oBAAC,QAAD;AAAU,MAAA,KAAK,EAAED,kBAAjB;AAAqC,MAAA,QAAQ,EAAEC,UAA/C;AAA2D,MAAA,KAAK,EAAE,KAAlE;AAAyE,MAAA,SAAS;AAAlF,MAXF,eAYE;AAAK,MAAA,SAAS,EAAC;AAAf,oBACE,oBAAC,MAAD;AACE,MAAA,OAAO,EAAC,OADV;AAEE,MAAA,KAAK,EAAC,MAFR;AAGE,MAAA,IAAI,EAAC,aAHP;AAIE,MAAA,aAAa,EAAC,OAJhB;AAKE,MAAA,QAAQ,EAAEA,UALZ;AAME,MAAA,SAAS,EAAC,KANZ;AAOE,MAAA,OAAO,EAAC,MAPV;AAQE,MAAA,OAAO,EAAEC,CAAC,IAAI,KAAKZ,kBAAL,CAAwBY,CAAxB,EAA2BX,QAA3B;AARhB,MADF,EAWGE,WAAW,iBACV,oBAAC,MAAD;AACE,MAAA,OAAO,EAAC,OADV;AAEE,MAAA,IAAI,EAAC,YAFP;AAGE,MAAA,aAAa,EAAC,MAHhB;AAIE,MAAA,QAAQ,EAAEQ,UAJZ;AAKE,MAAA,SAAS,EAAC,KALZ;AAME,MAAA,OAAO,EAAC,UANV;AAOE,MAAA,OAAO,EAAE,KAAK7C;AAPhB,MAZJ,eAsBE,oBAAC,MAAD;AACE,MAAA,OAAO,EAAC,OADV;AAEE,MAAA,KAAK,EAAC,MAFR;AAGE,MAAA,IAAI,EAAC,MAHP;AAIE,MAAA,aAAa,EAAC,MAJhB;AAKE,MAAA,QAAQ,EAAE6C,UALZ;AAME,MAAA,SAAS,EAAC,KANZ;AAOE,MAAA,OAAO,EAAC;AAPV,MAtBF,eA+BE,oBAAC,MAAD;AAAQ,MAAA,OAAO,EAAC,MAAhB;AAAuB,MAAA,QAAQ,EAAEA,UAAjC;AAA6C,MAAA,OAAO,EAAE/C;AAAtD,gBA/BF,CAZF,CAPJ,CADF;AA2DD;;AA9JmD,C,CAiKtD;;;AACApB,QAAQ,CAACc,uBAAD,EAA0B;AAChCI,EAAAA,YAAY,EAAEjB,MADkB;AAEhCuD,EAAAA,kBAAkB,EAAEvD,MAFY;AAGhC2B,EAAAA,oBAAoB,EAAE3B,MAHU;AAIhCgD,EAAAA,gBAAgB,EAAEhD,MAJc;AAKhCqB,EAAAA,cAAc,EAAErB,MALgB;AAMhCkB,EAAAA,UAAU,EAAElB,MANoB;AAOhC6C,EAAAA,aAAa,EAAE3C;AAPiB,CAA1B,CAAR;AAUA,eAAeJ,MAAM,GAAGD,QAAQ,CAACgB,uBAAD,CAAX,CAArB","sourcesContent":["/*\n *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\").\n *  You may not use this file except in compliance with the License.\n *  A copy of the License is located at\n *\n *  http://aws.amazon.com/apache2.0\n *\n *  or in the \"license\" file accompanying this file. This file is distributed\n *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n *  express or implied. See the License for the specific language governing\n *  permissions and limitations under the License.\n */\n\nimport _ from 'lodash';\nimport React from 'react';\nimport { observer, inject } from 'mobx-react';\nimport { decorate, action, runInAction, observable } from 'mobx';\nimport { Button, Header, Divider, Icon } from 'semantic-ui-react';\nimport { displayError, displaySuccess } from '@aws-ee/base-ui/dist/helpers/notification';\nimport Form from '@aws-ee/base-ui/dist/parts/helpers/fields/Form';\nimport DropDown from '@aws-ee/base-ui/dist/parts/helpers/fields/DropDown';\nimport Input from '@aws-ee/base-ui/dist/parts/helpers/fields/Input';\nimport TextArea from '@aws-ee/base-ui/dist/parts/helpers/fields/TextArea';\n\n// expected props\n// - editor (via props) an instance of the WorkflowDraftEditor model\n// - onCancel (via props)\nclass WorkflowDraftMetaEditor extends React.Component {\n  constructor(props) {\n    super(props);\n\n    runInAction(() => {\n      this.clickedOnNext = false;\n    });\n  }\n\n  componentDidMount() {\n    window.scrollTo(0, 0);\n  }\n\n  // Returns WorkflowTemplateDraftEditor\n  getEditor() {\n    return this.props.editor;\n  }\n\n  // Returns WorkflowVersion\n  getVersion() {\n    return this.getEditor().version;\n  }\n\n  getMetaForm() {\n    return this.getEditor().metaForm;\n  }\n\n  resetFlags() {\n    // we use these flags to tell the difference between clicking on 'save' vs 'next' because\n    // 'next' will result in saving the form\n    this.clickedOnNext = false;\n  }\n\n  handleCancel = () => {\n    this.resetFlags();\n    const onCancel = this.props.onCancel || _.noop;\n    onCancel();\n  };\n\n  handlePrevious = event => {\n    // we don't save the form in this case\n    this.resetFlags();\n    event.preventDefault();\n    event.stopPropagation();\n    this.getEditor().previousPage();\n  };\n\n  handleOnSubmitNext(event, onSubmit) {\n    event.preventDefault();\n    event.stopPropagation();\n    this.resetFlags();\n    this.clickedOnNext = true;\n\n    onSubmit(event); // this will eventually call handleFormSubmission()\n  }\n\n  handleFormSubmission = async form => {\n    const editor = this.getEditor();\n    const { title, desc, instanceTtl, runSpecSize, runSpecTarget } = form.values();\n    const { draft } = editor;\n    const version = editor.version;\n\n    version.setTitle(title);\n    version.setDescription(desc);\n    version.setInstanceTtl(instanceTtl);\n    version.setRunSpec({\n      size: runSpecSize,\n      target: runSpecTarget,\n    });\n\n    try {\n      await editor.update(draft);\n      if (this.clickedOnNext) {\n        this.getEditor().nextPage();\n        return;\n      }\n      displaySuccess('The workflow draft is saved successfully');\n    } catch (error) {\n      runInAction(() => {\n        this.resetFlags();\n      });\n      displayError(error);\n    }\n  };\n\n  handleFormErrors = () => {\n    window.scrollTo(0, 0);\n  };\n\n  render() {\n    const editor = this.getEditor();\n    const hasPrevious = editor.hasPreviousPage;\n    const form = this.getMetaForm();\n    const titleField = form.$('title');\n    const descField = form.$('desc');\n    const instanceTtlField = form.$('instanceTtl');\n    const runSpecSizeField = form.$('runSpecSize');\n    const runSpecTargetField = form.$('runSpecTarget');\n\n    return (\n      <Form\n        form={form}\n        onCancel={this.handleCancel}\n        onSuccess={this.handleFormSubmission}\n        onError={this.handleFormErrors}\n      >\n        {({ processing, onSubmit, onCancel }) => (\n          <>\n            <Input field={titleField} disabled={processing} />\n            <TextArea field={descField} rows={6} disabled={processing} />\n            <Divider horizontal className=\"mb3\">\n              <Header as=\"h4\" className=\"color-grey\">\n                <Icon name=\"list alternate outline\" className=\"color-grey\" />\n                Properties\n              </Header>\n            </Divider>\n            <Input field={instanceTtlField} disabled={processing} />\n            <DropDown field={runSpecSizeField} disabled={processing} fluid={false} selection />\n            <DropDown field={runSpecTargetField} disabled={processing} fluid={false} selection />\n            <div className=\"mt4\">\n              <Button\n                floated=\"right\"\n                color=\"teal\"\n                icon=\"right arrow\"\n                labelPosition=\"right\"\n                disabled={processing}\n                className=\"ml2\"\n                content=\"Next\"\n                onClick={e => this.handleOnSubmitNext(e, onSubmit)}\n              />\n              {hasPrevious && (\n                <Button\n                  floated=\"right\"\n                  icon=\"left arrow\"\n                  labelPosition=\"left\"\n                  disabled={processing}\n                  className=\"ml3\"\n                  content=\"previous\"\n                  onClick={this.handlePrevious}\n                />\n              )}\n              <Button\n                floated=\"right\"\n                color=\"blue\"\n                icon=\"save\"\n                labelPosition=\"left\"\n                disabled={processing}\n                className=\"ml2\"\n                content=\"Save\"\n              />\n              <Button floated=\"left\" disabled={processing} onClick={onCancel}>\n                Cancel\n              </Button>\n            </div>\n          </>\n        )}\n      </Form>\n    );\n  }\n}\n\n// see https://medium.com/@mweststrate/mobx-4-better-simpler-faster-smaller-c1fbc08008da\ndecorate(WorkflowDraftMetaEditor, {\n  handleCancel: action,\n  handleOnSubmitNext: action,\n  handleFormSubmission: action,\n  handleFormErrors: action,\n  handlePrevious: action,\n  resetFlags: action,\n  clickedOnNext: observable,\n});\n\nexport default inject()(observer(WorkflowDraftMetaEditor));\n"],"file":"WorkflowDraftMetaEditor.js"}