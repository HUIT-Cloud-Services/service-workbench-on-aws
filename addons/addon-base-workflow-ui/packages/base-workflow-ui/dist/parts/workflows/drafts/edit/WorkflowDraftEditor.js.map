{"version":3,"sources":["../../../../../src/parts/workflows/drafts/edit/WorkflowDraftEditor.js"],"names":["_","React","observer","inject","decorate","action","observable","runInAction","withRouter","TimeAgo","Header","Container","Breadcrumb","Label","Segment","c","gotoFn","isStoreReady","isStoreEmpty","isStoreNotEmpty","Stores","ErrorBox","ProgressPlaceHolder","getWorkflowDraftEditor","WorkflowCommonDraftStepsEditor","WorkflowStepEditor","WorkflowDraftMetaEditor","WorkflowDraftPublisher","WorkflowDraftEditor","Component","constructor","props","handleCancel","draftEditor","goto","cancel","stores","getStore","workflowTemplatesStore","stepTemplatesStore","componentDidMount","window","scrollTo","load","workflowDraftsStore","getStores","getUserDisplayName","userDisplayName","getDraft","id","getDraftId","decodeURIComponent","match","params","draftId","store","isNil","getVersion","version","hasDraft","draft","render","content","hasError","error","loading","ready","renderMain","renderBreadcrumb","className","title","createdAt","createdBy","by","getDisplayName","uid","renderContent","currentPage","renderMetaContent","renderStepsContent","renderPublishContent","editor"],"mappings":"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","sourcesContent":["/*\n *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\").\n *  You may not use this file except in compliance with the License.\n *  A copy of the License is located at\n *\n *  http://aws.amazon.com/apache2.0\n *\n *  or in the \"license\" file accompanying this file. This file is distributed\n *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n *  express or implied. See the License for the specific language governing\n *  permissions and limitations under the License.\n */\n\nimport _ from 'lodash';\nimport React from 'react';\nimport { observer, inject } from 'mobx-react';\nimport { decorate, action, observable, runInAction } from 'mobx';\nimport { withRouter } from 'react-router-dom';\nimport TimeAgo from 'react-timeago';\nimport { Header, Container, Breadcrumb, Label, Segment } from 'semantic-ui-react';\nimport c from 'classnames';\nimport { gotoFn } from '@aws-ee/base-ui/dist/helpers/routing';\nimport { isStoreReady, isStoreEmpty, isStoreNotEmpty } from '@aws-ee/base-ui/dist/models/BaseStore';\nimport Stores from '@aws-ee/base-ui/dist/models/Stores';\nimport ErrorBox from '@aws-ee/base-ui/dist/parts/helpers/ErrorBox';\n\nimport ProgressPlaceHolder from '../../../workflow-common/ProgressPlaceholder';\nimport { getWorkflowDraftEditor } from '../../../../models/workflows/drafts/edit/WorkflowDraftEditor';\nimport WorkflowCommonDraftStepsEditor from '../../../workflow-common/drafts/edit/WorkflowCommonDraftStepsEditor';\nimport WorkflowStepEditor from './WorkflowStepEditor';\nimport WorkflowDraftMetaEditor from './WorkflowDraftMetaEditor';\nimport WorkflowDraftPublisher from './WorkflowDraftPublisher';\n\n// expected props\n// - workflowDraftsStore (via injection)\n// - workflowTemplatesStore (via injection)\n// - stepTemplatesStore (via injection)\n// - userDisplayName (via injection)\n// - draftId (via react router params)\n// - className (via props)\n// - location (from react router)\nclass WorkflowDraftEditor extends React.Component {\n  constructor(props) {\n    super(props);\n\n    runInAction(() => {\n      this.stores = new Stores([this.getStore(), this.props.workflowTemplatesStore, this.props.stepTemplatesStore]);\n    });\n  }\n\n  componentDidMount() {\n    window.scrollTo(0, 0);\n    this.stores.load();\n  }\n\n  getStore() {\n    return this.props.workflowDraftsStore;\n  }\n\n  getStores() {\n    return this.stores;\n  }\n\n  getUserDisplayName() {\n    return this.props.userDisplayName;\n  }\n\n  getWorkflowDraftEditor() {\n    return getWorkflowDraftEditor(this.getDraft().id);\n  }\n\n  getDraftId() {\n    return decodeURIComponent((this.props.match.params || {}).draftId);\n  }\n\n  getDraft() {\n    const store = this.getStore();\n    if (!isStoreReady(store)) return {};\n    const draftId = this.getDraftId();\n\n    if (_.isNil(draftId)) return {};\n    return store.getDraft(draftId) || {};\n  }\n\n  getVersion() {\n    const draftEditor = this.getWorkflowDraftEditor();\n    return draftEditor.version;\n  }\n\n  hasDraft() {\n    const store = this.getStore();\n    const draft = this.getDraft();\n    return store.hasDraft(draft.id);\n  }\n\n  handleCancel = () => {\n    const draftEditor = this.getWorkflowDraftEditor();\n    const goto = gotoFn(this);\n    draftEditor.cancel();\n    goto('/workflows/published');\n  };\n\n  render() {\n    const stores = this.getStores();\n    const store = this.getStore();\n    let content = null;\n\n    if (stores.hasError) {\n      content = <ErrorBox error={stores.error} className=\"p0\" />;\n    } else if (stores.loading) {\n      content = <ProgressPlaceHolder />;\n    } else if (stores.ready && isStoreEmpty(store)) {\n      content = <ErrorBox error=\"The workflow draft does not exist or is no longer available\" className=\"p0\" />;\n    } else if (stores.ready && isStoreNotEmpty(store) && !this.hasDraft()) {\n      content = <ErrorBox error=\"The workflow draft does not exist or is no longer available\" className=\"p0\" />;\n    } else if (stores.ready && isStoreNotEmpty(store) && this.hasDraft()) {\n      content = this.renderMain();\n    } else {\n      content = null;\n    }\n\n    return (\n      <Container className=\"mt3\">\n        {this.renderBreadcrumb()}\n        {content}\n      </Container>\n    );\n  }\n\n  renderBreadcrumb() {\n    const draftId = this.getDraftId();\n    const goto = gotoFn(this);\n\n    return (\n      <Breadcrumb className=\"block mb3\">\n        <Breadcrumb.Section link onClick={() => goto('/workflows/published')}>\n          Workflow Drafts\n        </Breadcrumb.Section>\n        <Breadcrumb.Divider icon=\"right angle\" />\n        <Breadcrumb.Section active>{draftId}</Breadcrumb.Section>\n      </Breadcrumb>\n    );\n  }\n\n  renderMain() {\n    const hasDraft = this.hasDraft();\n    const draftId = this.getDraftId();\n    const className = this.props.className;\n    const draft = this.getDraft();\n    const version = this.getVersion();\n    const { id, title } = version;\n    const { createdAt, createdBy } = draft;\n    const userDisplayName = this.getUserDisplayName();\n    const by = () => <span className=\"ml1\">by {userDisplayName.getDisplayName({ uid: createdBy })}</span>;\n\n    if (!hasDraft) {\n      return <ErrorBox error={`The workflow template draft \"${draftId}\" is not available`} className=\"p0\" />;\n    }\n\n    return (\n      <div className={c(className)}>\n        <div className=\"flex mb2\">\n          <Header as=\"h3\" color=\"grey\" className=\"mt0 flex-auto ellipsis\">\n            <Label color=\"teal\" className=\"ml0 mr1\">\n              Draft\n            </Label>\n            {title}\n            <Header.Subheader className=\"fs-9 color-grey mt1\">\n              <div>\n                <span className=\"ellipsis breakout\">{id}</span>\n              </div>\n              <div>\n                created <TimeAgo date={createdAt} /> {by()}\n              </div>\n            </Header.Subheader>\n          </Header>\n        </div>\n        <Segment clearing className=\"p3\">\n          {this.renderContent()}\n        </Segment>\n      </div>\n    );\n  }\n\n  renderContent() {\n    const draftEditor = this.getWorkflowDraftEditor();\n    const currentPage = draftEditor.currentPage;\n\n    if (currentPage === 0) return this.renderMetaContent(draftEditor);\n    if (currentPage === 1) return this.renderStepsContent(draftEditor);\n    if (currentPage === 2) return this.renderPublishContent(draftEditor);\n    return '';\n  }\n\n  renderMetaContent(editor) {\n    return <WorkflowDraftMetaEditor editor={editor} onCancel={this.handleCancel} />;\n  }\n\n  renderStepsContent(editor) {\n    return (\n      <WorkflowCommonDraftStepsEditor editor={editor} stepEditor={WorkflowStepEditor} onCancel={this.handleCancel} />\n    );\n  }\n\n  renderPublishContent(editor) {\n    return <WorkflowDraftPublisher editor={editor} onCancel={this.handleCancel} />;\n  }\n}\n\n// see https://medium.com/@mweststrate/mobx-4-better-simpler-faster-smaller-c1fbc08008da\ndecorate(WorkflowDraftEditor, {\n  handleCancel: action,\n  stores: observable,\n});\n\nexport default inject(\n  'userDisplayName',\n  'workflowDraftsStore',\n  'workflowTemplatesStore',\n  'stepTemplatesStore',\n)(withRouter(observer(WorkflowDraftEditor)));\n"],"file":"WorkflowDraftEditor.js"}