{"version":3,"sources":["../../../../src/parts/workflows/published/WorkflowPublishedList.js"],"names":["_","React","observer","inject","decorate","action","runInAction","withRouter","TimeAgo","Header","Icon","Segment","Message","Table","gotoFn","isStoreEmpty","isStoreNotEmpty","Stores","ErrorBox","whiteGradient","ProgressPlaceHolder","WorkflowPublishedList","Component","constructor","props","handleWorkflowClick","event","preventDefault","stopPropagation","workflowId","currentTarget","dataset","workflow","version","goto","stores","getStore","componentDidMount","getStores","load","forceLoad","store","startHeartbeat","componentWillUnmount","stopHeartbeat","workflowsStore","getUserDisplayName","userDisplayName","render","content","hasError","error","loading","ready","renderEmpty","renderTable","renderTitle","show","showCreateDraftWizard","list","map","renderWorkflowRow","latest","id","v","title","updatedAt","updatedBy","isSystem","uid","by","getDisplayName","renderDescription","__html","descHtml","bottom","maxWidth"],"mappings":"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","sourcesContent":["/*\n *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\").\n *  You may not use this file except in compliance with the License.\n *  A copy of the License is located at\n *\n *  http://aws.amazon.com/apache2.0\n *\n *  or in the \"license\" file accompanying this file. This file is distributed\n *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n *  express or implied. See the License for the specific language governing\n *  permissions and limitations under the License.\n */\n\nimport _ from 'lodash';\nimport React from 'react';\nimport { observer, inject } from 'mobx-react';\nimport { decorate, action, runInAction } from 'mobx';\nimport { withRouter } from 'react-router-dom';\nimport TimeAgo from 'react-timeago';\nimport { Header, Icon, Segment, Message, Table } from 'semantic-ui-react';\nimport { gotoFn } from '@aws-ee/base-ui/dist/helpers/routing';\nimport { isStoreEmpty, isStoreNotEmpty } from '@aws-ee/base-ui/dist/models/BaseStore';\nimport Stores from '@aws-ee/base-ui/dist/models/Stores';\nimport ErrorBox from '@aws-ee/base-ui/dist/parts/helpers/ErrorBox';\n\n// eslint-disable-next-line import/no-useless-path-segments\nimport whiteGradient from '../../../../src/images/white-gradient.png'; // We need this because we are getting the image from src and not dist\nimport ProgressPlaceHolder from '../../workflow-common/ProgressPlaceholder';\n\n// expected props\n// - workflowsStore (via injection)\n// - userDisplayName (via injection)\n// - location (from react router)\nclass WorkflowPublishedList extends React.Component {\n  constructor(props) {\n    super(props);\n    runInAction(() => {\n      this.stores = new Stores([this.getStore()]);\n    });\n  }\n\n  componentDidMount() {\n    this.getStores().load({ forceLoad: true });\n    const store = this.getStore();\n    store.startHeartbeat();\n  }\n\n  componentWillUnmount() {\n    const store = this.getStore();\n    store.stopHeartbeat();\n  }\n\n  getStores() {\n    return this.stores;\n  }\n\n  getStore() {\n    return this.props.workflowsStore;\n  }\n\n  getUserDisplayName() {\n    return this.props.userDisplayName;\n  }\n\n  handleWorkflowClick = event => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    // see https://reactjs.org/docs/events.html and https://github.com/facebook/react/issues/5733\n    const workflowId = event.currentTarget.dataset.workflow;\n    const version = event.currentTarget.dataset.version;\n    const goto = gotoFn(this);\n\n    goto(`/workflows/published/id/${workflowId}/v/${version}`);\n  };\n\n  render() {\n    const stores = this.getStores();\n    const store = this.getStore();\n    let content = null;\n\n    if (stores.hasError) {\n      content = <ErrorBox error={stores.error} className=\"p0\" />;\n    } else if (stores.loading) {\n      content = <ProgressPlaceHolder />;\n    } else if (stores.ready && isStoreEmpty(store)) {\n      content = this.renderEmpty();\n    } else if (stores.ready && isStoreNotEmpty(store)) {\n      content = this.renderTable();\n    } else {\n      content = null;\n    }\n\n    return (\n      <div className=\"mb4\">\n        {this.renderTitle()}\n        {content}\n      </div>\n    );\n  }\n\n  renderEmpty() {\n    const show = this.showCreateDraftWizard;\n    if (show) return null;\n    return (\n      <Segment placeholder>\n        <Header icon className=\"color-grey\">\n          <Icon name=\"fork\" />\n          No workflows\n          <Header.Subheader>\n            To create a workflow, start by creating a draft and then publish the draft.\n          </Header.Subheader>\n        </Header>\n      </Segment>\n    );\n  }\n\n  renderTitle() {\n    return (\n      <div className=\"mb3 flex\">\n        <Header as=\"h3\" className=\"color-grey mt1 mb0 flex-auto\">\n          <Icon name=\"fork\" className=\"align-top\" />\n          <Header.Content className=\"left-align\">Workflows</Header.Content>\n        </Header>\n      </div>\n    );\n  }\n\n  renderTable() {\n    const store = this.getStore();\n    const list = store.list;\n\n    return (\n      <Table selectable padded>\n        <Table.Header>\n          <Table.Row>\n            <Table.HeaderCell singleLine>Workflow</Table.HeaderCell>\n            <Table.HeaderCell>Updated</Table.HeaderCell>\n          </Table.Row>\n        </Table.Header>\n        <Table.Body>{_.map(list, workflow => this.renderWorkflowRow(workflow))}</Table.Body>\n      </Table>\n    );\n  }\n\n  renderWorkflowRow(workflow) {\n    const latest = workflow.latest;\n    if (!latest)\n      return (\n        <Table.Row>\n          <Table.Cell colSpan=\"2\">\n            <Message warning>\n              <p>Workflow &quot;{workflow.id}&quot; does not have any version!</p>\n            </Message>\n          </Table.Cell>\n        </Table.Row>\n      );\n\n    const { id, v, title, updatedAt, updatedBy } = latest;\n    const userDisplayName = this.getUserDisplayName();\n    const isSystem = userDisplayName.isSystem({ uid: updatedBy });\n    const by = () => (isSystem ? '' : <span>{userDisplayName.getDisplayName({ uid: updatedBy })}</span>);\n\n    return (\n      <Table.Row\n        className=\"cursor-pointer\"\n        key={workflow.id}\n        data-workflow={workflow.id}\n        data-version={workflow.latest.v}\n        onClick={this.handleWorkflowClick}\n      >\n        <Table.Cell>\n          <Header as=\"h4\" color=\"grey\">\n            {title}\n            <Header.Subheader className=\"fs-9\">\n              <div>\n                <span className=\"ellipsis breakout color-grey\">\n                  {id} v{v}\n                </span>\n              </div>\n            </Header.Subheader>\n          </Header>\n        </Table.Cell>\n        <Table.Cell collapsing>\n          <div>{by()}</div>\n          <TimeAgo date={updatedAt} />\n        </Table.Cell>\n      </Table.Row>\n    );\n  }\n\n  renderDescription(latest) {\n    /* eslint-disable react/no-danger */\n    return (\n      <>\n        <div className=\"overflow-hidden height-60-px\">\n          <div dangerouslySetInnerHTML={{ __html: latest.descHtml }} />\n        </div>\n        <img src={whiteGradient} alt=\"\" className=\"absolute height-50-px\" style={{ bottom: '0', maxWidth: '100%' }} />\n      </>\n    );\n    /* eslint-enable react/no-danger */\n  }\n}\n\n// see https://medium.com/@mweststrate/mobx-4-better-simpler-faster-smaller-c1fbc08008da\ndecorate(WorkflowPublishedList, {\n  handleWorkflowClick: action,\n});\n\nexport default inject('workflowsStore', 'userDisplayName')(withRouter(observer(WorkflowPublishedList)));\n"],"file":"WorkflowPublishedList.js"}