{"version":3,"sources":["../../../../src/parts/workflows/published/WorkflowInstanceDetailPage.js"],"names":["_","React","observer","inject","decorate","withRouter","TimeAgo","Header","Label","Breadcrumb","Container","Progress","Message","Table","gotoFn","swallowError","isStoreError","isStoreReady","isStoreLoading","ErrorBox","ProgressPlaceHolder","WorkflowInstanceDetailPage","Component","componentDidMount","store","getInstanceStore","load","startHeartbeat","componentWillUnmount","stopHeartbeat","workflowStore","getWorkflowStore","version","getVersionNumber","instanceId","getInstanceId","workflowId","getWorkflowId","props","workflowsStore","getUserDisplayName","userDisplayName","match","params","parseInt","getWorkflow","workflow","getVersion","num","getInstance","workflowVersion","render","content","error","renderMain","renderBreadcrumb","versionNumber","goto","instance","id","title","descHtml","updatedAt","updatedBy","statusMsg","statusLabel","statusColor","msgSpread","statusSummary","isSystem","uid","by","getDisplayName","v","__html","displayInstanceStatusMsg","renderSteps","steps","msg","isEmpty","map","step","index"],"mappings":"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","sourcesContent":["/*\n *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\").\n *  You may not use this file except in compliance with the License.\n *  A copy of the License is located at\n *\n *  http://aws.amazon.com/apache2.0\n *\n *  or in the \"license\" file accompanying this file. This file is distributed\n *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n *  express or implied. See the License for the specific language governing\n *  permissions and limitations under the License.\n */\n\n/* eslint-disable react/no-danger */\nimport _ from 'lodash';\nimport React from 'react';\nimport { observer, inject } from 'mobx-react';\nimport { decorate } from 'mobx';\nimport { withRouter } from 'react-router-dom';\nimport TimeAgo from 'react-timeago';\nimport { Header, Label, Breadcrumb, Container, Progress, Message, Table } from 'semantic-ui-react';\nimport { gotoFn } from '@aws-ee/base-ui/dist/helpers/routing';\nimport { swallowError } from '@aws-ee/base-ui/dist/helpers/utils';\nimport { isStoreError, isStoreReady, isStoreLoading } from '@aws-ee/base-ui/dist/models/BaseStore';\nimport ErrorBox from '@aws-ee/base-ui/dist/parts/helpers/ErrorBox';\n\nimport ProgressPlaceHolder from '../../workflow-common/ProgressPlaceholder';\n\n// expected props\n// - workflowsStore (via injection)\n// - userDisplayName (via injection)\n// - location (from react router)\nclass WorkflowInstanceDetailPage extends React.Component {\n  componentDidMount() {\n    const store = this.getInstanceStore();\n    swallowError(store.load());\n    store.startHeartbeat();\n  }\n\n  componentWillUnmount() {\n    const store = this.getInstanceStore();\n    store.stopHeartbeat();\n  }\n\n  getInstanceStore() {\n    const workflowStore = this.getWorkflowStore();\n    const version = this.getVersionNumber();\n    const instanceId = this.getInstanceId();\n    return workflowStore.getInstanceStore(version, instanceId);\n  }\n\n  getWorkflowStore() {\n    const workflowId = this.getWorkflowId();\n    return this.props.workflowsStore.getWorkflowStore(workflowId);\n  }\n\n  getUserDisplayName() {\n    return this.props.userDisplayName;\n  }\n\n  getInstanceId() {\n    return (this.props.match.params || {}).instanceId;\n  }\n\n  getWorkflowId() {\n    return (this.props.match.params || {}).workflowId;\n  }\n\n  getVersionNumber() {\n    return parseInt((this.props.match.params || {}).version, 10);\n  }\n\n  getWorkflow() {\n    const store = this.getWorkflowStore();\n    if (!isStoreReady(store)) return {};\n    return store.workflow;\n  }\n\n  getVersion() {\n    const workflow = this.getWorkflow();\n    const num = this.getVersionNumber();\n\n    return workflow.getVersion(num);\n  }\n\n  getInstance() {\n    const instanceId = this.getInstanceId();\n    const workflowVersion = this.getVersion();\n    return workflowVersion.getInstance(instanceId);\n  }\n\n  render() {\n    const store = this.getInstanceStore();\n    let content = null;\n\n    if (isStoreError(store)) {\n      content = <ErrorBox error={store.error} className=\"p0\" />;\n    } else if (isStoreLoading(store)) {\n      content = <ProgressPlaceHolder />;\n    } else if (isStoreReady(store)) {\n      content = this.renderMain();\n    } else {\n      content = null;\n    }\n\n    return (\n      <Container className=\"mt3\">\n        {this.renderBreadcrumb()}\n        {content}\n      </Container>\n    );\n  }\n\n  renderBreadcrumb() {\n    const workflowId = this.getWorkflowId();\n    const versionNumber = this.getVersionNumber();\n    const instanceId = this.getInstanceId();\n    const goto = gotoFn(this);\n\n    return (\n      <Breadcrumb className=\"block mb3\">\n        <Breadcrumb.Section link onClick={() => goto('/workflows/published')}>\n          Workflows\n        </Breadcrumb.Section>\n        <Breadcrumb.Divider icon=\"right angle\" />\n        <Breadcrumb.Section link onClick={() => goto(`/workflows/published/id/${workflowId}/v/${versionNumber}`)}>\n          {workflowId}\n        </Breadcrumb.Section>\n        <Breadcrumb.Divider icon=\"right angle\" />\n        <Breadcrumb.Section active>{instanceId}</Breadcrumb.Section>\n      </Breadcrumb>\n    );\n  }\n\n  renderMain() {\n    const version = this.getVersion();\n    const instance = this.getInstance();\n    const { id, title, descHtml } = version;\n    const { updatedAt, updatedBy } = instance;\n    const { statusMsg, statusLabel, statusColor, msgSpread } = instance.statusSummary;\n    const userDisplayName = this.getUserDisplayName();\n    const isSystem = userDisplayName.isSystem({ uid: updatedBy });\n    const by = () =>\n      isSystem ? '' : <span className=\"ml1\">by {userDisplayName.getDisplayName({ uid: updatedBy })}</span>;\n\n    return (\n      <>\n        <div className=\"flex mb2\">\n          <Header as=\"h3\" color=\"grey\" className=\"mt0 flex-auto ellipsis\">\n            <Label color={statusColor} className=\"ml0 mr1\">\n              {statusLabel}\n            </Label>\n            <Label color=\"blue\" className=\"ml0 mr1\">\n              Workflow Instance\n            </Label>\n            {title} - {instance.id}\n            <Header.Subheader className=\"fs-9 color-grey mt1\">\n              <div>\n                updated <TimeAgo date={updatedAt} /> {by()}\n              </div>\n            </Header.Subheader>\n          </Header>\n          <div className=\"ml1\">\n            <span className=\"ellipsis pr1 fs-9 breakout color-grey\">{id}</span>\n            <span className=\"fs-9 color-grey\">{version.v}</span>\n          </div>\n        </div>\n        <div className=\"mb3\">\n          <div dangerouslySetInnerHTML={{ __html: descHtml }} />\n        </div>\n        {this.displayInstanceStatusMsg(statusMsg, msgSpread)}\n        <Progress percent={100} size=\"tiny\" color={statusColor} />\n        {this.renderSteps(instance.steps)}\n      </>\n    );\n  }\n\n  displayInstanceStatusMsg(msg, msgSpread) {\n    if (!msg) return null;\n    return <Message {...msgSpread}>{msg}</Message>;\n  }\n\n  renderSteps(steps) {\n    if (_.isEmpty(steps)) return 'This workflow instance does not have any steps';\n\n    return (\n      <Table basic=\"very\" celled striped stackable>\n        <Table.Header>\n          <Table.Row>\n            <Table.HeaderCell>Step</Table.HeaderCell>\n            <Table.HeaderCell>Status</Table.HeaderCell>\n          </Table.Row>\n        </Table.Header>\n\n        <Table.Body>\n          {_.map(steps, (step, index) => (\n            <Table.Row key={index}>\n              <Table.Cell textAlign=\"left\" className=\"fs-9\">\n                <div>\n                  <span className=\"mr2 bold\">{index + 1}</span> {step.title}\n                </div>\n                {step.statusMsg && (\n                  <div className={`color-${step.statusColor || 'grey'} breakout ml3 mt2`}>{step.statusMsg}</div>\n                )}\n              </Table.Cell>\n              <Table.Cell collapsing textAlign=\"center\" className=\"fs-9\">\n                <Label size=\"tiny\" color={step.statusColor}>\n                  {step.statusLabel}\n                </Label>\n              </Table.Cell>\n            </Table.Row>\n          ))}\n        </Table.Body>\n      </Table>\n    );\n  }\n}\n\n// see https://medium.com/@mweststrate/mobx-4-better-simpler-faster-smaller-c1fbc08008da\ndecorate(WorkflowInstanceDetailPage, {});\n\nexport default inject('workflowsStore', 'userDisplayName')(withRouter(observer(WorkflowInstanceDetailPage)));\n"],"file":"WorkflowInstanceDetailPage.js"}