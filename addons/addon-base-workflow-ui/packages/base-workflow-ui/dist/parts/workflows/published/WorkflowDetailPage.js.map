{"version":3,"sources":["../../../../src/parts/workflows/published/WorkflowDetailPage.js"],"names":["_","React","observer","inject","decorate","action","withRouter","TimeAgo","Header","Label","Breadcrumb","Container","Dropdown","gotoFn","swallowError","isStoreError","isStoreReady","isStoreLoading","ErrorBox","ProgressPlaceHolder","getUIState","WorkflowDetailTabs","WorkflowDetailPage","Component","handleVersionChange","value","goto","workflowId","getWorkflowId","componentDidMount","store","getStore","load","startHeartbeat","componentWillUnmount","stopHeartbeat","getState","props","workflowsStore","getWorkflowStore","getUserDisplayName","userDisplayName","match","params","getVersionNumber","parseInt","version","getWorkflow","workflow","getVersion","num","render","content","error","renderMain","renderBreadcrumb","id","title","updatedAt","updatedBy","descHtml","isSystem","uid","by","getDisplayName","uiState","renderVersionDropdown","__html","versions","versionNumbers","currentVersion","options","map","text","length","_e","data"],"mappings":"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","sourcesContent":["/*\n *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\").\n *  You may not use this file except in compliance with the License.\n *  A copy of the License is located at\n *\n *  http://aws.amazon.com/apache2.0\n *\n *  or in the \"license\" file accompanying this file. This file is distributed\n *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n *  express or implied. See the License for the specific language governing\n *  permissions and limitations under the License.\n */\n\nimport _ from 'lodash';\nimport React from 'react';\nimport { observer, inject } from 'mobx-react';\nimport { decorate, action } from 'mobx';\nimport { withRouter } from 'react-router-dom';\nimport TimeAgo from 'react-timeago';\nimport { Header, Label, Breadcrumb, Container, Dropdown } from 'semantic-ui-react';\nimport { gotoFn } from '@aws-ee/base-ui/dist/helpers/routing';\nimport { swallowError } from '@aws-ee/base-ui/dist/helpers/utils';\nimport { isStoreError, isStoreReady, isStoreLoading } from '@aws-ee/base-ui/dist/models/BaseStore';\nimport ErrorBox from '@aws-ee/base-ui/dist/parts/helpers/ErrorBox';\n\nimport ProgressPlaceHolder from '../../workflow-common/ProgressPlaceholder';\nimport getUIState from '../../workflow-common/component-states/WorkflowCommonCardState';\nimport WorkflowDetailTabs from './WorkflowDetailTabs';\n\n// expected props\n// - workflowsStore (via injection)\n// - userDisplayName (via injection)\n// - location (from react router)\nclass WorkflowDetailPage extends React.Component {\n  componentDidMount() {\n    const store = this.getStore();\n    swallowError(store.load());\n    store.startHeartbeat();\n  }\n\n  componentWillUnmount() {\n    const store = this.getStore();\n    store.stopHeartbeat();\n  }\n\n  getState() {\n    return getUIState(`wf-${this.getWorkflowId()}`);\n  }\n\n  getStore() {\n    const workflowId = this.getWorkflowId();\n    return this.props.workflowsStore.getWorkflowStore(workflowId);\n  }\n\n  getUserDisplayName() {\n    return this.props.userDisplayName;\n  }\n\n  getWorkflowId() {\n    return (this.props.match.params || {}).workflowId;\n  }\n\n  getVersionNumber() {\n    return parseInt((this.props.match.params || {}).version, 10);\n  }\n\n  getWorkflow() {\n    const store = this.getStore();\n    if (!isStoreReady(store)) return {};\n    return store.workflow;\n  }\n\n  getVersion() {\n    const workflow = this.getWorkflow();\n    const num = this.getVersionNumber();\n\n    return workflow.getVersion(num);\n  }\n\n  handleVersionChange = ({ value = '' }) => {\n    const goto = gotoFn(this);\n    const workflowId = this.getWorkflowId();\n    goto(`/workflows/published/id/${workflowId}/v/${value}`);\n  };\n\n  render() {\n    const store = this.getStore();\n    let content = null;\n\n    if (isStoreError(store)) {\n      content = <ErrorBox error={store.error} className=\"p0\" />;\n    } else if (isStoreLoading(store)) {\n      content = <ProgressPlaceHolder />;\n    } else if (isStoreReady(store)) {\n      content = this.renderMain();\n    } else {\n      content = null;\n    }\n\n    return (\n      <Container className=\"mt3\">\n        {this.renderBreadcrumb()}\n        {content}\n      </Container>\n    );\n  }\n\n  renderBreadcrumb() {\n    const workflowId = this.getWorkflowId();\n    const goto = gotoFn(this);\n\n    return (\n      <Breadcrumb className=\"block mb3\">\n        <Breadcrumb.Section link onClick={() => goto('/workflows/published')}>\n          Workflows\n        </Breadcrumb.Section>\n        <Breadcrumb.Divider icon=\"right angle\" />\n        <Breadcrumb.Section active>{workflowId}</Breadcrumb.Section>\n      </Breadcrumb>\n    );\n  }\n\n  renderMain() {\n    const version = this.getVersion();\n    const { id, title, updatedAt, updatedBy, descHtml } = version;\n    const userDisplayName = this.getUserDisplayName();\n    const isSystem = userDisplayName.isSystem({ uid: updatedBy });\n    const by = () =>\n      isSystem ? '' : <span className=\"ml1\">by {userDisplayName.getDisplayName({ uid: updatedBy })}</span>;\n\n    const uiState = this.getState();\n\n    /* eslint-disable react/no-danger */\n    return (\n      <>\n        <div className=\"flex mb2\">\n          <Header as=\"h3\" color=\"grey\" className=\"mt0 flex-auto ellipsis\">\n            <Label color=\"teal\" className=\"ml0 mr1\">\n              Workflow\n            </Label>\n            {title}\n            <Header.Subheader className=\"fs-9 color-grey mt1\">\n              <div>\n                updated <TimeAgo date={updatedAt} /> {by()}\n              </div>\n            </Header.Subheader>\n          </Header>\n          <div className=\"ml1\">\n            <span className=\"ellipsis pr1 fs-9 breakout color-grey\">{id}</span> {this.renderVersionDropdown()}\n          </div>\n        </div>\n        <div className=\"mb3\">\n          <div dangerouslySetInnerHTML={{ __html: descHtml }} />\n        </div>\n        <WorkflowDetailTabs uiState={uiState} workflow={version} />\n      </>\n    );\n    /* eslint-enable react/no-danger */\n  }\n\n  renderVersionDropdown() {\n    const workflow = this.getWorkflow();\n    const versions = workflow.versionNumbers;\n    const currentVersion = this.getVersionNumber();\n    const options = _.map(versions, version => ({ text: `v${version}`, value: version }));\n\n    if (versions.length === 1) return <span className=\"bold color-grey pr2\">v{currentVersion}</span>;\n\n    return (\n      <Dropdown\n        className=\"color-grey\"\n        inline\n        options={options}\n        value={currentVersion}\n        onChange={(_e, data) => this.handleVersionChange(data)}\n      />\n    );\n  }\n}\n\n// see https://medium.com/@mweststrate/mobx-4-better-simpler-faster-smaller-c1fbc08008da\ndecorate(WorkflowDetailPage, {\n  handleVersionChange: action,\n});\n\nexport default inject('workflowsStore', 'userDisplayName')(withRouter(observer(WorkflowDetailPage)));\n"],"file":"WorkflowDetailPage.js"}