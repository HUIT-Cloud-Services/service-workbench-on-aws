{"version":3,"sources":["../../../../src/parts/workflow-common/drafts/WorkflowCommonDraftCard.js"],"names":["_","React","observer","inject","decorate","action","observable","runInAction","TimeAgo","Header","Label","Button","Icon","Modal","c","displayError","displaySuccess","getUIState","WorkflowCommonDraftCard","Component","constructor","props","handleOnTabChange","_event","data","getState","setMainTabIndex","activeIndex","handleEditDraft","event","preventDefault","stopPropagation","draft","getDraft","onEdit","undefined","showDeleteDialog","shouldShowDeleteDialog","deletingInProgress","hideDeleteDialog","handleDeleteDraft","clean","draftsStore","getDraftsStore","deleteDraft","error","id","selectedMainTabIndex","mainTabIndex","getVersion","template","workflow","getUserDisplayName","userDisplayName","render","className","version","isTemplate","title","createdAt","createdBy","by","getDisplayName","uid","renderActionButtons","renderMainTabs","renderDeleteDialog","progress","renderer","isFunction","children","noop","uiState"],"mappings":"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","sourcesContent":["/*\n *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\").\n *  You may not use this file except in compliance with the License.\n *  A copy of the License is located at\n *\n *  http://aws.amazon.com/apache2.0\n *\n *  or in the \"license\" file accompanying this file. This file is distributed\n *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n *  express or implied. See the License for the specific language governing\n *  permissions and limitations under the License.\n */\n\nimport _ from 'lodash';\nimport React from 'react';\nimport { observer, inject } from 'mobx-react';\nimport { decorate, action, observable, runInAction } from 'mobx';\nimport TimeAgo from 'react-timeago';\nimport { Header, Label, Button, Icon, Modal } from 'semantic-ui-react';\nimport c from 'classnames';\nimport { displayError, displaySuccess } from '@aws-ee/base-ui/dist/helpers/notification';\n\nimport getUIState from '../component-states/WorkflowCommonCardState';\n\n// expected props\n// - draft - a WorkflowTemplateDraft or WorkflowDraft model instance (via props)\n// - draftsStore (via props) (either workflowTemplateDraftsStore or workflowDraftsStore)\n// - onEdit (via props) called with (draft)\n// - userDisplayName (via injection)\n// - className (via props)\nclass WorkflowCommonDraftCard extends React.Component {\n  constructor(props) {\n    super(props);\n\n    runInAction(() => {\n      this.shouldShowDeleteDialog = false;\n      this.deletingInProgress = false;\n    });\n  }\n\n  getDraftsStore() {\n    return this.props.draftsStore;\n  }\n\n  getState() {\n    return getUIState(this.getDraft().id);\n  }\n\n  selectedMainTabIndex() {\n    return this.getState().mainTabIndex;\n  }\n\n  getDraft() {\n    return this.props.draft;\n  }\n\n  getVersion() {\n    const draft = this.getDraft();\n    return draft.template || draft.workflow;\n  }\n\n  getUserDisplayName() {\n    return this.props.userDisplayName;\n  }\n\n  handleOnTabChange = (_event, data) => {\n    this.getState().setMainTabIndex(data.activeIndex);\n  };\n\n  handleEditDraft = async event => {\n    event.preventDefault();\n    event.stopPropagation();\n    const draft = this.getDraft();\n    if (this.props.onEdit) return this.props.onEdit(draft);\n    return undefined;\n  };\n\n  showDeleteDialog = () => {\n    this.shouldShowDeleteDialog = true;\n    this.deletingInProgress = false;\n  };\n\n  hideDeleteDialog = () => {\n    if (this.deletingInProgress) return;\n    this.shouldShowDeleteDialog = false;\n  };\n\n  handleDeleteDraft = async () => {\n    const clean = () => {\n      runInAction(() => {\n        this.shouldShowDeleteDialog = false;\n        this.deletingInProgress = false;\n      });\n    };\n\n    const draft = this.getDraft();\n    const draftsStore = this.getDraftsStore();\n\n    try {\n      this.deletingInProgress = true;\n      await draftsStore.deleteDraft(draft);\n      clean();\n      displaySuccess('Draft deleted successfully');\n    } catch (error) {\n      clean();\n      displayError(error);\n    }\n  };\n\n  render() {\n    const className = this.props.className;\n    const draft = this.getDraft();\n    const version = this.getVersion();\n    const isTemplate = draft.template !== undefined;\n    const { id, title } = version;\n    const { createdAt, createdBy } = draft;\n    const userDisplayName = this.getUserDisplayName();\n    const by = () => <span className=\"ml1\">by {userDisplayName.getDisplayName({ uid: createdBy })}</span>;\n\n    return (\n      <>\n        <Label attached=\"top left\">{isTemplate && 'Template '} Draft</Label>\n        <div className={c(className)}>\n          <div className=\"flex\">\n            <Header as=\"h3\" color=\"grey\" className=\"mt0 flex-auto ellipsis\">\n              {title}\n              <Header.Subheader className=\"fs-9 color-grey\">\n                <div>\n                  <span className=\"ellipsis breakout\">{id}</span>\n                </div>\n                <div>\n                  created <TimeAgo date={createdAt} /> {by()}\n                </div>\n              </Header.Subheader>\n            </Header>\n            <div>{this.renderActionButtons()}</div>\n          </div>\n          {this.renderMainTabs(version)}\n        </div>\n        {this.renderDeleteDialog(version)}\n      </>\n    );\n  }\n\n  renderDeleteDialog(version) {\n    const shouldShowDeleteDialog = this.shouldShowDeleteDialog;\n    const { id } = version;\n    const progress = this.deletingInProgress;\n\n    return (\n      <Modal open={shouldShowDeleteDialog} size=\"tiny\" onClose={this.hideDeleteDialog} closeOnDimmerClick={!progress}>\n        <Header content=\"Delete Draft\" />\n        <Modal.Content>\n          <p>Are you sure you want to delete draft &quot;{id}&quot; ?</p>\n        </Modal.Content>\n        <Modal.Actions>\n          <Button disabled={progress} onClick={this.hideDeleteDialog}>\n            Cancel\n          </Button>\n          <Button loading={progress} disabled={progress} color=\"red\" onClick={this.handleDeleteDraft}>\n            <Icon name=\"remove\" /> Delete\n          </Button>\n        </Modal.Actions>\n      </Modal>\n    );\n  }\n\n  renderActionButtons() {\n    return (\n      <Button.Group basic size=\"mini\">\n        <Button icon=\"edit\" onClick={this.handleEditDraft} />\n        <Button icon=\"trash\" onClick={this.showDeleteDialog} />\n      </Button.Group>\n    );\n  }\n\n  renderMainTabs(version) {\n    const renderer = _.isFunction(this.props.children) ? this.props.children : _.noop;\n    const uiState = this.getState();\n    return renderer({\n      uiState,\n      version,\n    });\n  }\n}\n\n// see https://medium.com/@mweststrate/mobx-4-better-simpler-faster-smaller-c1fbc08008da\ndecorate(WorkflowCommonDraftCard, {\n  showDeleteDialog: action,\n  hideDeleteDialog: action,\n  handleDeleteDraft: action,\n  handleEditDraft: action,\n  shouldShowDeleteDialog: observable,\n  deletingInProgress: observable,\n});\n\nexport default inject('userDisplayName')(observer(WorkflowCommonDraftCard));\n"],"file":"WorkflowCommonDraftCard.js"}