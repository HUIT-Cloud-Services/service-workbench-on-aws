{"version":3,"sources":["../../../src/parts/workflow-templates/WorkflowTemplateCard.js"],"names":["_","React","observer","inject","decorate","runInAction","action","withRouter","TimeAgo","Header","Dropdown","Label","displayError","getUIState","WorkflowTemplateCardTabs","WorkflowTemplateCard","Component","constructor","props","handleOnVersionChange","value","getState","setVersionNumber","state","versionSpecified","isNil","v","versionNumber","template","latest","getTemplate","id","selectedVersionNumber","getTemplateVersion","version","getVersion","isEmpty","getUserDisplayName","userDisplayName","render","templateVersion","title","createdAt","createdBy","isSystem","uid","by","getDisplayName","renderVersionDropdown","renderMainTabs","currentVersion","versions","versionNumbers","options","map","text","length","e","data","uiState"],"mappings":"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","sourcesContent":["/*\n *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\").\n *  You may not use this file except in compliance with the License.\n *  A copy of the License is located at\n *\n *  http://aws.amazon.com/apache2.0\n *\n *  or in the \"license\" file accompanying this file. This file is distributed\n *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n *  express or implied. See the License for the specific language governing\n *  permissions and limitations under the License.\n */\n\nimport _ from 'lodash';\nimport React from 'react';\nimport { observer, inject } from 'mobx-react';\nimport { decorate, runInAction, action } from 'mobx';\nimport { withRouter } from 'react-router-dom';\nimport TimeAgo from 'react-timeago';\nimport { Header, Dropdown, Label } from 'semantic-ui-react';\nimport { displayError } from '@aws-ee/base-ui/dist/helpers/notification';\n\nimport getUIState from '../workflow-common/component-states/WorkflowCommonCardState';\nimport WorkflowTemplateCardTabs from './WorkflowTemplateCardTabs';\n\n// expected props\n// - template - a WorkflowTemplate model instance (via props)\n// - v - the selected version number, will default to latest or existing state (via props)\n// - userDisplayName (via injection)\n// - location (from react router)\nclass WorkflowTemplateCard extends React.Component {\n  constructor(props) {\n    super(props);\n    runInAction(() => {\n      const state = this.getState();\n      const versionSpecified = !_.isNil(this.props.v);\n      let v;\n\n      if (versionSpecified) {\n        v = this.props.v;\n      } else if (state.versionNumber === -1) {\n        v = this.props.template.latest.v;\n      } else {\n        v = state.versionNumber;\n      }\n      state.setVersionNumber(v);\n    });\n  }\n\n  getState() {\n    return getUIState(this.getTemplate().id);\n  }\n\n  selectedVersionNumber() {\n    return this.getState().versionNumber;\n  }\n\n  getTemplate() {\n    return this.props.template;\n  }\n\n  getTemplateVersion() {\n    const template = this.getTemplate();\n    const v = this.selectedVersionNumber();\n    const version = template.getVersion(v);\n    if (_.isEmpty(version)) {\n      // This is an error\n      displayError(`Version ${v} of this workflow template is not valid`);\n      return {};\n    }\n\n    return version;\n  }\n\n  getUserDisplayName() {\n    return this.props.userDisplayName;\n  }\n\n  handleOnVersionChange = ({ value = 1 }) => {\n    this.getState().setVersionNumber(value);\n  };\n\n  render() {\n    const templateVersion = this.getTemplateVersion();\n    const { id, v, title, createdAt, createdBy } = templateVersion;\n    const userDisplayName = this.getUserDisplayName();\n    const isSystem = userDisplayName.isSystem({ uid: createdBy });\n    const by = () =>\n      isSystem ? '' : <span className=\"ml1\">by {userDisplayName.getDisplayName({ uid: createdBy })}</span>;\n\n    return (\n      <>\n        <Label attached=\"top left\">Template</Label>\n        <div className=\"flex mb1\">\n          <Header as=\"h3\" color=\"grey\" className=\"mt0 flex-auto ellipsis\">\n            {title}\n            <Header.Subheader className=\"fs-9\">\n              created <TimeAgo date={createdAt} /> {by()}\n            </Header.Subheader>\n          </Header>\n          <div className=\"ml1\">\n            <span className=\"ellipsis pr1 fs-9 breakout color-grey\">{id}</span> {this.renderVersionDropdown(v)}\n          </div>\n        </div>\n        {this.renderMainTabs(templateVersion)}\n      </>\n    );\n  }\n\n  renderVersionDropdown(currentVersion) {\n    const template = this.getTemplate();\n    const versions = template.versionNumbers;\n    const options = _.map(versions, version => ({ text: `v${version}`, value: version }));\n\n    if (versions.length === 1) return <span className=\"bold color-grey pr2\">v{template.latest.v}</span>;\n\n    return (\n      <Dropdown\n        className=\"color-grey\"\n        inline\n        options={options}\n        value={currentVersion}\n        onChange={(e, data) => this.handleOnVersionChange(data)}\n      />\n    );\n  }\n\n  renderMainTabs(template) {\n    const uiState = this.getState();\n    return <WorkflowTemplateCardTabs template={template} uiState={uiState} />;\n  }\n}\n\n// see https://medium.com/@mweststrate/mobx-4-better-simpler-faster-smaller-c1fbc08008da\ndecorate(WorkflowTemplateCard, {\n  handleOnVersionChange: action,\n});\n\nexport default inject('userDisplayName')(withRouter(observer(WorkflowTemplateCard)));\n"],"file":"WorkflowTemplateCard.js"}