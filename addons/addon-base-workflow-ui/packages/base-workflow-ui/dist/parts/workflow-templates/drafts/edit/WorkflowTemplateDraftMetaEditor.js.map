{"version":3,"sources":["../../../../../src/parts/workflow-templates/drafts/edit/WorkflowTemplateDraftMetaEditor.js"],"names":["_","React","observer","inject","decorate","action","runInAction","observable","Button","Header","Divider","Icon","Segment","displayError","displaySuccess","Form","DropDown","Input","TextArea","PropsOverrideTable","WorkflowTemplateDraftMetaEditor","Component","constructor","props","handleCancel","resetFlags","onCancel","noop","handlePrevious","event","preventDefault","stopPropagation","getEditor","previousPage","handleFormSubmission","form","editor","templateTitle","templateDesc","instanceTtl","runSpecSize","runSpecTarget","values","draft","template","allowed","toPropsOverride","key","value","item","replace","startsWith","isEmpty","push","forEach","setTitle","setDescription","setInstanceTtl","setRunSpec","size","target","setPropsOverrideOption","update","clickedOnNext","nextPage","error","handleFormErrors","window","scrollTo","componentDidMount","getWorkflowTemplate","getMetaForm","metaForm","handleOnSubmitNext","onSubmit","render","hasPrevious","hasPreviousPage","templateTitleField","$","templateDescField","instanceTtlField","runSpecSizeField","runSpecTargetField","rows","propertyOverrideSummaryRows","fields","map","name","processing","e"],"mappings":"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","sourcesContent":["/*\n *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\").\n *  You may not use this file except in compliance with the License.\n *  A copy of the License is located at\n *\n *  http://aws.amazon.com/apache2.0\n *\n *  or in the \"license\" file accompanying this file. This file is distributed\n *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n *  express or implied. See the License for the specific language governing\n *  permissions and limitations under the License.\n */\n\nimport _ from 'lodash';\nimport React from 'react';\nimport { observer, inject } from 'mobx-react';\nimport { decorate, action, runInAction, observable } from 'mobx';\nimport { Button, Header, Divider, Icon, Segment } from 'semantic-ui-react';\n\nimport { displayError, displaySuccess } from '@aws-ee/base-ui/dist/helpers/notification';\nimport Form from '@aws-ee/base-ui/dist/parts/helpers/fields/Form';\nimport DropDown from '@aws-ee/base-ui/dist/parts/helpers/fields/DropDown';\nimport Input from '@aws-ee/base-ui/dist/parts/helpers/fields/Input';\nimport TextArea from '@aws-ee/base-ui/dist/parts/helpers/fields/TextArea';\nimport PropsOverrideTable from '../../PropertyOverrideTable';\n\n// expected props\n// - editor (via props) an instance of the WorkflowTemplateDraftEditor model\n// - onCancel (via props)\nclass WorkflowTemplateDraftMetaEditor extends React.Component {\n  constructor(props) {\n    super(props);\n\n    runInAction(() => {\n      this.clickedOnNext = false;\n    });\n  }\n\n  componentDidMount() {\n    window.scrollTo(0, 0);\n  }\n\n  // WorkflowTemplateDraftEditor\n  getEditor() {\n    return this.props.editor;\n  }\n\n  getWorkflowTemplate() {\n    return this.getEditor().draft.template;\n  }\n\n  getMetaForm() {\n    return this.getEditor().metaForm;\n  }\n\n  resetFlags() {\n    // we use these flags to tell the difference between clicking on 'save' vs 'next' because\n    // 'next' will result in saving the form\n    this.clickedOnNext = false;\n  }\n\n  handleCancel = () => {\n    this.resetFlags();\n    const onCancel = this.props.onCancel || _.noop;\n    onCancel();\n  };\n\n  handlePrevious = event => {\n    // we don't save the form in this case\n    this.resetFlags();\n    event.preventDefault();\n    event.stopPropagation();\n    this.getEditor().previousPage();\n  };\n\n  handleOnSubmitNext(event, onSubmit) {\n    event.preventDefault();\n    event.stopPropagation();\n    this.resetFlags();\n    this.clickedOnNext = true;\n\n    onSubmit(event); // this will eventually call handleFormSubmission()\n  }\n\n  handleFormSubmission = async form => {\n    const editor = this.getEditor();\n    const { templateTitle, templateDesc, instanceTtl, runSpecSize, runSpecTarget } = form.values();\n    const { draft } = editor;\n    const template = draft.template;\n    const allowed = [];\n    const toPropsOverride = (key, value) => {\n      const item = key.replace(/^propsOverride_/, '');\n      if (_.startsWith(key, 'propsOverride_') && !_.isEmpty(item) && value === true) allowed.push(item);\n    };\n\n    _.forEach(form.values(), (value, key) => toPropsOverride(key, value));\n\n    template.setTitle(templateTitle);\n    template.setDescription(templateDesc);\n    template.setInstanceTtl(instanceTtl);\n    template.setRunSpec({\n      size: runSpecSize,\n      target: runSpecTarget,\n    });\n    template.setPropsOverrideOption({ allowed });\n\n    try {\n      await editor.update(draft);\n      if (this.clickedOnNext) {\n        this.getEditor().nextPage();\n        return;\n      }\n      displaySuccess('The workflow template draft is saved successfully');\n    } catch (error) {\n      runInAction(() => {\n        this.resetFlags();\n      });\n      displayError(error);\n    }\n  };\n\n  handleFormErrors = () => {\n    window.scrollTo(0, 0);\n  };\n\n  render() {\n    const editor = this.getEditor();\n    const hasPrevious = editor.hasPreviousPage;\n    const form = this.getMetaForm();\n    const templateTitleField = form.$('templateTitle');\n    const templateDescField = form.$('templateDesc');\n    const instanceTtlField = form.$('instanceTtl');\n    const runSpecSizeField = form.$('runSpecSize');\n    const runSpecTargetField = form.$('runSpecTarget');\n    const rows = this.getWorkflowTemplate().propertyOverrideSummaryRows || [];\n    const fields = _.map(rows, item => form.$(`propsOverride_${item.name}`));\n\n    return (\n      <Form\n        form={form}\n        onCancel={this.handleCancel}\n        onSuccess={this.handleFormSubmission}\n        onError={this.handleFormErrors}\n      >\n        {({ processing, onSubmit, onCancel }) => (\n          <>\n            <Input field={templateTitleField} disabled={processing} />\n            <TextArea field={templateDescField} rows={6} disabled={processing} />\n            <Divider horizontal className=\"mb3\">\n              <Header as=\"h4\" className=\"color-grey\">\n                <Icon name=\"list alternate outline\" className=\"color-grey\" />\n                Properties\n              </Header>\n            </Divider>\n            <Input field={instanceTtlField} disabled={processing} />\n            <DropDown field={runSpecSizeField} disabled={processing} fluid={false} selection />\n            <DropDown field={runSpecTargetField} disabled={processing} fluid={false} selection />\n            <Divider horizontal className=\"mb3\">\n              <Header as=\"h4\" className=\"color-grey\">\n                <Icon name=\"list alternate outline\" className=\"color-grey\" />\n                Properties Override\n              </Header>\n            </Divider>\n            <Segment padded>\n              <PropsOverrideTable rows={fields} editable processing={processing} />\n            </Segment>\n            <div className=\"mt4\">\n              <Button\n                floated=\"right\"\n                color=\"teal\"\n                icon=\"right arrow\"\n                labelPosition=\"right\"\n                disabled={processing}\n                className=\"ml2\"\n                content=\"Next\"\n                onClick={e => this.handleOnSubmitNext(e, onSubmit)}\n              />\n              {hasPrevious && (\n                <Button\n                  floated=\"right\"\n                  icon=\"left arrow\"\n                  labelPosition=\"left\"\n                  disabled={processing}\n                  className=\"ml3\"\n                  content=\"previous\"\n                  onClick={this.handlePrevious}\n                />\n              )}\n              <Button\n                floated=\"right\"\n                color=\"blue\"\n                icon=\"save\"\n                labelPosition=\"left\"\n                disabled={processing}\n                className=\"ml2\"\n                content=\"Save\"\n              />\n              <Button floated=\"left\" disabled={processing} onClick={onCancel}>\n                Cancel\n              </Button>\n            </div>\n          </>\n        )}\n      </Form>\n    );\n  }\n}\n\n// see https://medium.com/@mweststrate/mobx-4-better-simpler-faster-smaller-c1fbc08008da\ndecorate(WorkflowTemplateDraftMetaEditor, {\n  handleCancel: action,\n  handleOnSubmitNext: action,\n  handleFormSubmission: action,\n  handleFormErrors: action,\n  handlePrevious: action,\n  resetFlags: action,\n  clickedOnNext: observable,\n});\n\nexport default inject()(observer(WorkflowTemplateDraftMetaEditor));\n"],"file":"WorkflowTemplateDraftMetaEditor.js"}