{"version":3,"sources":["../../../../../src/parts/workflow-templates/drafts/edit/WorkflowTemplateStepConfigOverrideEditor.js"],"names":["_","React","observer","inject","decorate","action","computed","Icon","Divider","Button","Segment","Header","Form","ConfigOverrideTable","WorkflowTemplateStepConfigOverrideEditor","Component","handleEditOn","event","preventDefault","stopPropagation","stepEditorModel","getStepEditor","setConfigOverrideEdit","handleEditOff","handleSave","form","onSave","props","noop","values","allowed","filter","keys","key","applyConfigOverrides","stepEditor","getStep","step","getConfigOverrideForm","configOverrideForm","editing","configOverrideEdit","render","rows","configOverrideSummaryRows","hasRows","length","canEdit","className","renderEditingContent","renderReadOnlyContent","configOverrideRows","fields","map","item","$","name","processing","_onSubmit","onCancel"],"mappings":"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","sourcesContent":["/*\n *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\").\n *  You may not use this file except in compliance with the License.\n *  A copy of the License is located at\n *\n *  http://aws.amazon.com/apache2.0\n *\n *  or in the \"license\" file accompanying this file. This file is distributed\n *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n *  express or implied. See the License for the specific language governing\n *  permissions and limitations under the License.\n */\n\nimport _ from 'lodash';\nimport React from 'react';\nimport { observer, inject } from 'mobx-react';\nimport { decorate, action, computed } from 'mobx';\nimport { Icon, Divider, Button, Segment, Header } from 'semantic-ui-react';\nimport Form from '@aws-ee/base-ui/dist/parts/helpers/fields/Form';\n\nimport ConfigOverrideTable from '../../ConfigOverrideTable';\n\n// expected props\n// - stepEditor - a WorkflowTemplateStepEditor model instance (via props)\n// - onSave - called when the props are saved (via props)\n// - className (via props)\nclass WorkflowTemplateStepConfigOverrideEditor extends React.Component {\n  getStepEditor() {\n    return this.props.stepEditor;\n  }\n\n  getStep() {\n    return this.getStepEditor().step;\n  }\n\n  getConfigOverrideForm() {\n    return this.getStepEditor().configOverrideForm;\n  }\n\n  get editing() {\n    return this.getStepEditor().configOverrideEdit;\n  }\n\n  handleEditOn = event => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    const stepEditorModel = this.getStepEditor();\n    stepEditorModel.setConfigOverrideEdit(true);\n  };\n\n  handleEditOff = () => {\n    const stepEditorModel = this.getStepEditor();\n    stepEditorModel.setConfigOverrideEdit(false);\n  };\n\n  handleSave = async form => {\n    const onSave = this.props.onSave || _.noop;\n    const stepEditorModel = this.getStepEditor();\n    const values = form.values();\n    const allowed = _.filter(_.keys(values), key => values[key] === true);\n\n    stepEditorModel.applyConfigOverrides(allowed);\n\n    await onSave();\n    stepEditorModel.setConfigOverrideEdit(false);\n  };\n\n  render() {\n    const editing = this.editing;\n    const step = this.getStep();\n    const rows = step.configOverrideSummaryRows || [];\n    const hasRows = rows.length > 0;\n    const canEdit = !editing && hasRows;\n\n    return (\n      <div className={this.props.className}>\n        {!editing && (\n          <div className=\"flex\">\n            <div className=\"flex-auto\">\n              <Icon name=\"cog\" className=\"mr1 color-grey\" />\n              <b>Configuration Override</b>\n            </div>\n            {canEdit && (\n              <div className=\"pl1 pr0\" onClick={this.handleEditOn}>\n                <Icon name=\"edit\" color=\"grey\" className=\"cursor-pointer\" />\n              </div>\n            )}\n          </div>\n        )}\n        <Divider className=\"mt1 mb2\" />\n        {editing && this.renderEditingContent()}\n        {!editing && this.renderReadOnlyContent()}\n      </div>\n    );\n  }\n\n  renderReadOnlyContent() {\n    const step = this.getStep();\n    const configOverrideRows = step.configOverrideSummaryRows || [];\n    const hasRows = configOverrideRows.length > 0;\n\n    return (\n      <>\n        {hasRows && (\n          <Segment padded>\n            <ConfigOverrideTable rows={configOverrideRows} />\n          </Segment>\n        )}\n        {!hasRows && <div>No configuration entries are available</div>}\n      </>\n    );\n  }\n\n  renderEditingContent() {\n    const form = this.getConfigOverrideForm();\n    const step = this.getStep();\n    const configOverrideRows = step.configOverrideSummaryRows || [];\n    const fields = _.map(configOverrideRows, item => form.$(item.name));\n\n    return (\n      <>\n        <Header textAlign=\"center\" as=\"h2\" color=\"grey\" className=\"mt1 mb3\">\n          Change Configuration Override\n        </Header>\n        <Form form={form} dimmer={false} onCancel={this.handleEditOff} onSuccess={this.handleSave}>\n          {({ processing, _onSubmit, onCancel }) => (\n            <div className=\"mt3\">\n              <Segment padded>\n                <ConfigOverrideTable rows={fields} editable processing={processing} />\n              </Segment>\n              <div className=\"mt3 clearfix\">\n                <Button\n                  floated=\"right\"\n                  color=\"blue\"\n                  icon=\"save\"\n                  labelPosition=\"left\"\n                  disabled={processing}\n                  className=\"ml2\"\n                  type=\"submit\"\n                  content=\"Save\"\n                />\n                <Button floated=\"left\" disabled={processing} onClick={onCancel}>\n                  Cancel\n                </Button>\n              </div>\n            </div>\n          )}\n        </Form>\n      </>\n    );\n  }\n}\n\n// see https://medium.com/@mweststrate/mobx-4-better-simpler-faster-smaller-c1fbc08008da\ndecorate(WorkflowTemplateStepConfigOverrideEditor, {\n  editing: computed,\n  handleEditOn: action,\n  handleEditOff: action,\n  handleSave: action,\n});\n\nexport default inject()(observer(WorkflowTemplateStepConfigOverrideEditor));\n"],"file":"WorkflowTemplateStepConfigOverrideEditor.js"}