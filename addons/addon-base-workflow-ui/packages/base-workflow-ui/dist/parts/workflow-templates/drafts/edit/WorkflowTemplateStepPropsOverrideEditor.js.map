{"version":3,"sources":["../../../../../src/parts/workflow-templates/drafts/edit/WorkflowTemplateStepPropsOverrideEditor.js"],"names":["_","React","observer","inject","decorate","action","computed","Icon","Divider","Button","Segment","Header","Form","PropsOverrideTable","WorkflowTemplateStepPropsOverrideEditor","Component","handleEditOn","event","preventDefault","stopPropagation","stepEditorModel","getStepEditor","setPropsOverrideEdit","handleEditOff","handleSave","form","onSave","props","noop","values","allowed","filter","keys","key","applyPropsOverrides","stepEditor","getStep","step","getPropsOverrideForm","propsOverrideForm","editing","propsOverrideEdit","render","canEdit","className","renderEditingContent","renderReadOnlyContent","rows","propertyOverrideSummaryRows","hasRows","length","fields","map","item","$","name","processing","_onSubmit","onCancel"],"mappings":"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","sourcesContent":["/*\n *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\").\n *  You may not use this file except in compliance with the License.\n *  A copy of the License is located at\n *\n *  http://aws.amazon.com/apache2.0\n *\n *  or in the \"license\" file accompanying this file. This file is distributed\n *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n *  express or implied. See the License for the specific language governing\n *  permissions and limitations under the License.\n */\n\nimport _ from 'lodash';\nimport React from 'react';\nimport { observer, inject } from 'mobx-react';\nimport { decorate, action, computed } from 'mobx';\nimport { Icon, Divider, Button, Segment, Header } from 'semantic-ui-react';\nimport Form from '@aws-ee/base-ui/dist/parts/helpers/fields/Form';\n\nimport PropsOverrideTable from '../../PropertyOverrideTable';\n\n// expected props\n// - stepEditor - a WorkflowTemplateStepEditor model instance (via props)\n// - onSave - called when the props are saved (via props)\n// - className (via props)\nclass WorkflowTemplateStepPropsOverrideEditor extends React.Component {\n  getStepEditor() {\n    return this.props.stepEditor;\n  }\n\n  getStep() {\n    return this.getStepEditor().step;\n  }\n\n  getPropsOverrideForm() {\n    return this.getStepEditor().propsOverrideForm;\n  }\n\n  get editing() {\n    return this.getStepEditor().propsOverrideEdit;\n  }\n\n  handleEditOn = event => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    const stepEditorModel = this.getStepEditor();\n    stepEditorModel.setPropsOverrideEdit(true);\n  };\n\n  handleEditOff = () => {\n    const stepEditorModel = this.getStepEditor();\n    stepEditorModel.setPropsOverrideEdit(false);\n  };\n\n  handleSave = async form => {\n    const onSave = this.props.onSave || _.noop;\n    const stepEditorModel = this.getStepEditor();\n    const values = form.values();\n    const allowed = _.filter(_.keys(values), key => values[key] === true);\n\n    stepEditorModel.applyPropsOverrides(allowed);\n\n    await onSave();\n    stepEditorModel.setPropsOverrideEdit(false);\n  };\n\n  render() {\n    const editing = this.editing;\n    const canEdit = !editing;\n\n    return (\n      <div className={this.props.className}>\n        {!editing && (\n          <div className=\"flex\">\n            <div className=\"flex-auto\">\n              <Icon name=\"file alternate outline\" className=\"mr1 color-grey\" />\n              <b>Properties Override</b>\n            </div>\n            {canEdit && (\n              <div className=\"pl1 pr0\" onClick={this.handleEditOn}>\n                <Icon name=\"edit\" color=\"grey\" className=\"cursor-pointer\" />\n              </div>\n            )}\n          </div>\n        )}\n        <Divider className=\"mt1 mb2\" />\n        {editing && this.renderEditingContent()}\n        {!editing && this.renderReadOnlyContent()}\n      </div>\n    );\n  }\n\n  renderReadOnlyContent() {\n    const step = this.getStep();\n    const rows = step.propertyOverrideSummaryRows || [];\n    const hasRows = rows.length > 0;\n\n    return (\n      <>\n        {hasRows && (\n          <Segment padded>\n            <PropsOverrideTable rows={rows} />\n          </Segment>\n        )}\n        {!hasRows && <div>No properties are available to override</div>}\n      </>\n    );\n  }\n\n  renderEditingContent() {\n    const form = this.getPropsOverrideForm();\n    const step = this.getStep();\n    const rows = step.propertyOverrideSummaryRows || [];\n    const fields = _.map(rows, item => form.$(item.name));\n\n    return (\n      <>\n        <Header textAlign=\"center\" as=\"h2\" color=\"grey\" className=\"mt1 mb3\">\n          Change Properties Override\n        </Header>\n        <Form form={form} dimmer={false} onCancel={this.handleEditOff} onSuccess={this.handleSave}>\n          {({ processing, _onSubmit, onCancel }) => (\n            <div className=\"mt3\">\n              <Segment padded>\n                <PropsOverrideTable rows={fields} editable processing={processing} />\n              </Segment>\n              <div className=\"mt3 clearfix\">\n                <Button\n                  floated=\"right\"\n                  color=\"blue\"\n                  icon=\"save\"\n                  labelPosition=\"left\"\n                  disabled={processing}\n                  className=\"ml2\"\n                  type=\"submit\"\n                  content=\"Save\"\n                />\n                <Button floated=\"left\" disabled={processing} onClick={onCancel}>\n                  Cancel\n                </Button>\n              </div>\n            </div>\n          )}\n        </Form>\n      </>\n    );\n  }\n}\n\n// see https://medium.com/@mweststrate/mobx-4-better-simpler-faster-smaller-c1fbc08008da\ndecorate(WorkflowTemplateStepPropsOverrideEditor, {\n  editing: computed,\n  handleEditOn: action,\n  handleEditOff: action,\n  handleSave: action,\n});\n\nexport default inject()(observer(WorkflowTemplateStepPropsOverrideEditor));\n"],"file":"WorkflowTemplateStepPropsOverrideEditor.js"}