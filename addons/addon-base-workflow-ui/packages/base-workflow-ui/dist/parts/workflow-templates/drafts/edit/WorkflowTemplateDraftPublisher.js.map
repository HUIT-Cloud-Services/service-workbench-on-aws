{"version":3,"sources":["../../../../../src/parts/workflow-templates/drafts/edit/WorkflowTemplateDraftPublisher.js"],"names":["_","React","observer","inject","decorate","action","runInAction","observable","withRouter","Button","Header","Dimmer","Loader","displayError","displaySuccess","gotoFn","getUIState","WorkflowTemplateCardTabs","WorkflowTemplateDraftPublisher","Component","constructor","props","handleCancel","event","preventDefault","stopPropagation","processing","onCancel","noop","handlePrevious","getEditor","previousPage","handlePublish","editor","draft","goto","publishResult","publish","hasErrors","Error","eventBus","getUiEventBus","fireEvent","template","error","componentDidMount","window","scrollTo","uiEventBus","getState","getWorkflowTemplate","id","render","uiState"],"mappings":"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","sourcesContent":["/*\n *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\").\n *  You may not use this file except in compliance with the License.\n *  A copy of the License is located at\n *\n *  http://aws.amazon.com/apache2.0\n *\n *  or in the \"license\" file accompanying this file. This file is distributed\n *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n *  express or implied. See the License for the specific language governing\n *  permissions and limitations under the License.\n */\n\nimport _ from 'lodash';\nimport React from 'react';\nimport { observer, inject } from 'mobx-react';\nimport { decorate, action, runInAction, observable } from 'mobx';\nimport { withRouter } from 'react-router-dom';\nimport { Button, Header, Dimmer, Loader } from 'semantic-ui-react';\nimport { displayError, displaySuccess } from '@aws-ee/base-ui/dist/helpers/notification';\nimport { gotoFn } from '@aws-ee/base-ui/dist/helpers/routing';\n\nimport getUIState from '../../../workflow-common/component-states/WorkflowCommonCardState';\nimport WorkflowTemplateCardTabs from '../../WorkflowTemplateCardTabs';\n\n// expected props\n// - editor (via prop) an instance of the WorkflowTemplateDraftEditor model\n// - uiEventBus (via props)\n// - location (from react router)\nclass WorkflowTemplateDraftPublisher extends React.Component {\n  constructor(props) {\n    super(props);\n\n    runInAction(() => {\n      this.processing = false;\n    });\n  }\n\n  componentDidMount() {\n    window.scrollTo(0, 0);\n  }\n\n  getUiEventBus() {\n    return this.props.uiEventBus;\n  }\n\n  getState() {\n    const template = this.getWorkflowTemplate();\n    return getUIState(`${template.id}-draft-publish-page`);\n  }\n\n  // Return WorkflowTemplateDraftEditor\n  getEditor() {\n    return this.props.editor;\n  }\n\n  getWorkflowTemplate() {\n    return this.getEditor().draft.template;\n  }\n\n  handleCancel = event => {\n    event.preventDefault();\n    event.stopPropagation();\n    this.processing = false;\n    const onCancel = this.props.onCancel || _.noop;\n    onCancel();\n  };\n\n  handlePrevious = event => {\n    event.preventDefault();\n    event.stopPropagation();\n    this.processing = false;\n    this.getEditor().previousPage();\n  };\n\n  handlePublish = async event => {\n    event.preventDefault();\n    event.stopPropagation();\n    const editor = this.getEditor();\n    const { draft } = editor;\n    const goto = gotoFn(this);\n\n    this.processing = true;\n\n    try {\n      const publishResult = await editor.publish(draft);\n      runInAction(() => {\n        this.processing = false;\n      });\n      // TODO examine the publishResult and figure out if we have validation errors\n      if (publishResult.hasErrors) {\n        throw new Error('There were validation errors in your submission');\n      }\n      const eventBus = this.getUiEventBus();\n      await eventBus.fireEvent('workflowTemplatePublished', publishResult.template);\n      displaySuccess('The workflow template draft is published successfully');\n      goto('/workflow-templates/published');\n      return;\n    } catch (error) {\n      runInAction(() => {\n        this.processing = false;\n      });\n      displayError(error);\n    }\n  };\n\n  render() {\n    const processing = this.processing;\n    const template = this.getWorkflowTemplate();\n    const uiState = this.getState();\n\n    return (\n      <>\n        <Dimmer.Dimmable dimmed={processing}>\n          <Dimmer active={processing} inverted>\n            <Loader inverted>Processing</Loader>\n          </Dimmer>\n          <Header as=\"h3\" color=\"grey\" className=\"mt0 mb3\">\n            Review &amp; Publish\n          </Header>\n          {/* TODO add an elaborate error/validation error panel, showing errors at all levels including workflow template level and step level */}\n          <WorkflowTemplateCardTabs template={template} uiState={uiState} className=\"mb4 mt0\" />\n        </Dimmer.Dimmable>\n        <div>\n          <Button\n            floated=\"right\"\n            color=\"teal\"\n            disabled={processing}\n            className=\"ml2\"\n            content=\"Publish\"\n            onClick={this.handlePublish}\n          />\n          <Button\n            floated=\"right\"\n            icon=\"left arrow\"\n            labelPosition=\"left\"\n            disabled={processing}\n            className=\"ml3\"\n            content=\"previous\"\n            onClick={this.handlePrevious}\n          />\n          <Button floated=\"left\" disabled={processing} onClick={this.handleCancel}>\n            Cancel\n          </Button>\n        </div>\n      </>\n    );\n  }\n}\n\n// see https://medium.com/@mweststrate/mobx-4-better-simpler-faster-smaller-c1fbc08008da\ndecorate(WorkflowTemplateDraftPublisher, {\n  handleCancel: action,\n  handlePublish: action,\n  handlePrevious: action,\n  processing: observable,\n});\n\nexport default inject('uiEventBus')(withRouter(observer(WorkflowTemplateDraftPublisher)));\n"],"file":"WorkflowTemplateDraftPublisher.js"}