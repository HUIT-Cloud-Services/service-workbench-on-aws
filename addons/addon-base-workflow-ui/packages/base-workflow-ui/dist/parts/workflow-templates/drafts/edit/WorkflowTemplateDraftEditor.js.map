{"version":3,"sources":["../../../../../src/parts/workflow-templates/drafts/edit/WorkflowTemplateDraftEditor.js"],"names":["_","React","observer","inject","decorate","action","observable","runInAction","withRouter","TimeAgo","Header","Container","Breadcrumb","Label","Segment","c","gotoFn","isStoreReady","isStoreEmpty","isStoreNotEmpty","Stores","ErrorBox","ProgressPlaceHolder","getWorkflowTemplateDraftEditor","WorkflowTemplateDraftMetaEditor","WorkflowCommonDraftStepsEditor","WorkflowTemplateStepEditor","WorkflowTemplateDraftPublisher","WorkflowTemplateDraftEditor","Component","constructor","props","handleCancel","editor","getDraftEditor","cancel","goto","stores","getStore","stepTemplatesStore","componentDidMount","window","scrollTo","load","workflowTemplateDraftsStore","getStores","getDraft","id","getDraftId","decodeURIComponent","match","params","draftId","store","isNil","getTemplateVersion","draft","template","getUserDisplayName","userDisplayName","hasDraft","render","content","hasError","error","loading","ready","renderMain","renderBreadcrumb","className","templateVersion","title","createdAt","createdBy","by","getDisplayName","uid","renderContent","currentPage","renderMetaContent","renderStepsContent","renderPublishContent"],"mappings":"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","sourcesContent":["/*\n *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\").\n *  You may not use this file except in compliance with the License.\n *  A copy of the License is located at\n *\n *  http://aws.amazon.com/apache2.0\n *\n *  or in the \"license\" file accompanying this file. This file is distributed\n *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n *  express or implied. See the License for the specific language governing\n *  permissions and limitations under the License.\n */\n\nimport _ from 'lodash';\nimport React from 'react';\nimport { observer, inject } from 'mobx-react';\nimport { decorate, action, observable, runInAction } from 'mobx';\nimport { withRouter } from 'react-router-dom';\nimport TimeAgo from 'react-timeago';\nimport { Header, Container, Breadcrumb, Label, Segment } from 'semantic-ui-react';\nimport c from 'classnames';\nimport { gotoFn } from '@aws-ee/base-ui/dist/helpers/routing';\nimport { isStoreReady, isStoreEmpty, isStoreNotEmpty } from '@aws-ee/base-ui/dist/models/BaseStore';\nimport Stores from '@aws-ee/base-ui/dist/models/Stores';\nimport ErrorBox from '@aws-ee/base-ui/dist/parts/helpers/ErrorBox';\n\nimport ProgressPlaceHolder from '../../../workflow-common/ProgressPlaceholder';\nimport { getWorkflowTemplateDraftEditor } from '../../../../models/workflow-templates/drafts/edit/WorkflowTemplateDraftEditor';\nimport WorkflowTemplateDraftMetaEditor from './WorkflowTemplateDraftMetaEditor';\nimport WorkflowCommonDraftStepsEditor from '../../../workflow-common/drafts/edit/WorkflowCommonDraftStepsEditor';\nimport WorkflowTemplateStepEditor from './WorkflowTemplateStepEditor';\nimport WorkflowTemplateDraftPublisher from './WorkflowTemplateDraftPublisher';\n\n// expected props\n// - workflowTemplateDraftsStore (via injection)\n// - stepTemplatesStore (via injection)\n// - draftId (via react router params)\n// - className (via props)\n// - location (from react router)\nclass WorkflowTemplateDraftEditor extends React.Component {\n  constructor(props) {\n    super(props);\n\n    runInAction(() => {\n      this.stores = new Stores([this.getStore(), this.props.stepTemplatesStore]);\n    });\n  }\n\n  componentDidMount() {\n    window.scrollTo(0, 0);\n    this.stores.load();\n  }\n\n  getStore() {\n    return this.props.workflowTemplateDraftsStore;\n  }\n\n  getStores() {\n    return this.stores;\n  }\n\n  getDraftEditor() {\n    return getWorkflowTemplateDraftEditor(this.getDraft().id);\n  }\n\n  getDraftId() {\n    return decodeURIComponent((this.props.match.params || {}).draftId);\n  }\n\n  getDraft() {\n    const store = this.getStore();\n    if (!isStoreReady(store)) return {};\n    const draftId = this.getDraftId();\n\n    if (_.isNil(draftId)) return {};\n    return store.getDraft(draftId) || {};\n  }\n\n  getTemplateVersion() {\n    const draft = this.getDraft();\n    return draft.template || {};\n  }\n\n  getUserDisplayName() {\n    return this.props.userDisplayName;\n  }\n\n  hasDraft() {\n    const store = this.getStore();\n    const draft = this.getDraft();\n    return store.hasDraft(draft.id);\n  }\n\n  handleCancel = () => {\n    const editor = this.getDraftEditor();\n    editor.cancel();\n    const goto = gotoFn(this);\n    goto('/workflow-templates/published');\n  };\n\n  render() {\n    const stores = this.getStores();\n    const store = this.getStore();\n    let content = null;\n\n    if (stores.hasError) {\n      content = <ErrorBox error={stores.error} className=\"p0\" />;\n    } else if (stores.loading) {\n      content = <ProgressPlaceHolder />;\n    } else if (stores.ready && isStoreEmpty(store)) {\n      content = (\n        <ErrorBox error=\"The workflow template draft does not exist or is no longer available\" className=\"p0\" />\n      );\n    } else if (stores.ready && isStoreNotEmpty(store)) {\n      content = this.renderMain();\n    } else {\n      content = null;\n    }\n\n    return (\n      <Container className=\"mt3\">\n        {this.renderBreadcrumb()}\n        {content}\n      </Container>\n    );\n  }\n\n  renderBreadcrumb() {\n    const draftId = this.getDraftId();\n    const goto = gotoFn(this);\n    return (\n      <Breadcrumb className=\"block mb3\">\n        <Breadcrumb.Section link onClick={() => goto('/workflow-templates/published')}>\n          Workflow Template Drafts\n        </Breadcrumb.Section>\n        <Breadcrumb.Divider icon=\"right angle\" />\n        <Breadcrumb.Section active>{draftId}</Breadcrumb.Section>\n      </Breadcrumb>\n    );\n  }\n\n  renderMain() {\n    const hasDraft = this.hasDraft();\n    const draftId = this.getDraftId();\n    const className = this.props.className;\n    const draft = this.getDraft();\n    const templateVersion = this.getTemplateVersion();\n    const { id, title } = templateVersion;\n    const { createdAt, createdBy } = draft;\n    const userDisplayName = this.getUserDisplayName();\n    const by = () => <span className=\"ml1\">by {userDisplayName.getDisplayName({ uid: createdBy })}</span>;\n\n    if (!hasDraft) {\n      return <ErrorBox error={`The workflow template draft \"${draftId}\" is not available`} className=\"p0\" />;\n    }\n\n    return (\n      <div className={c(className)}>\n        <div className=\"flex mb2\">\n          <Header as=\"h3\" color=\"grey\" className=\"mt0 flex-auto ellipsis\">\n            <Label color=\"teal\" className=\"ml0 mr1\">\n              Draft\n            </Label>\n            {title}\n            <Header.Subheader className=\"fs-9 color-grey mt1\">\n              <div>\n                <span className=\"ellipsis breakout\">{id}</span>\n              </div>\n              <div>\n                created <TimeAgo date={createdAt} /> {by()}\n              </div>\n            </Header.Subheader>\n          </Header>\n        </div>\n        <Segment clearing className=\"p3\">\n          {this.renderContent()}\n        </Segment>\n      </div>\n    );\n  }\n\n  renderContent() {\n    const editor = this.getDraftEditor();\n    const currentPage = editor.currentPage;\n\n    if (currentPage === 0) return this.renderMetaContent(editor);\n    if (currentPage === 1) return this.renderStepsContent(editor);\n    if (currentPage === 2) return this.renderPublishContent(editor);\n    return '';\n  }\n\n  renderMetaContent(editor) {\n    return <WorkflowTemplateDraftMetaEditor editor={editor} onCancel={this.handleCancel} />;\n  }\n\n  renderStepsContent(editor) {\n    return (\n      <WorkflowCommonDraftStepsEditor\n        editor={editor}\n        stepEditor={WorkflowTemplateStepEditor}\n        onCancel={this.handleCancel}\n      />\n    );\n  }\n\n  renderPublishContent(editor) {\n    return <WorkflowTemplateDraftPublisher editor={editor} onCancel={this.handleCancel} />;\n  }\n}\n\n// see https://medium.com/@mweststrate/mobx-4-better-simpler-faster-smaller-c1fbc08008da\ndecorate(WorkflowTemplateDraftEditor, {\n  handleCancel: action,\n  stores: observable,\n});\n\nexport default inject(\n  'userDisplayName',\n  'workflowTemplateDraftsStore',\n  'stepTemplatesStore',\n)(withRouter(observer(WorkflowTemplateDraftEditor)));\n"],"file":"WorkflowTemplateDraftEditor.js"}