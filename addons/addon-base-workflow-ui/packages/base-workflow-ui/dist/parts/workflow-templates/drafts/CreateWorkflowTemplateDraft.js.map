{"version":3,"sources":["../../../../src/parts/workflow-templates/drafts/CreateWorkflowTemplateDraft.js"],"names":["_","React","observer","inject","decorate","action","withRouter","Label","Segment","Button","createLink","isStoreLoading","isStoreReady","isStoreError","displayError","ErrorBox","Form","DropDown","Input","getCreateDraftForm","ProgressPlaceHolder","CreateWorkflowTemplateDraft","Component","constructor","props","handleSelectionChange","templateId","form","templateIdField","$","templateTitleField","clear","set","template","id","latest","title","store","getTemplatesStore","getTemplate","isNil","handleCancel","onCancel","noop","handleFormError","_form","_errors","handleFormSubmission","values","isNewTemplate","draftFor","templateTitle","undefined","getStore","draft","createDraft","goto","encodeURIComponent","error","workflowTemplateDraftsStore","workflowTemplatesStore","getDropdownOptions","draftsStore","templates","list","options","forEach","hasTemplate","push","text","value","content","unshift","pathname","location","link","history","render","renderMain","dropDownOptions","dropDownField","draftForValue","isNew","processing","_onSubmit"],"mappings":"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","sourcesContent":["/*\n *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\").\n *  You may not use this file except in compliance with the License.\n *  A copy of the License is located at\n *\n *  http://aws.amazon.com/apache2.0\n *\n *  or in the \"license\" file accompanying this file. This file is distributed\n *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n *  express or implied. See the License for the specific language governing\n *  permissions and limitations under the License.\n */\n\nimport _ from 'lodash';\nimport React from 'react';\nimport { observer, inject } from 'mobx-react';\nimport { decorate, action } from 'mobx';\nimport { withRouter } from 'react-router-dom';\nimport { Label, Segment, Button } from 'semantic-ui-react';\nimport { createLink } from '@aws-ee/base-ui/dist/helpers/routing';\nimport { isStoreLoading, isStoreReady, isStoreError } from '@aws-ee/base-ui/dist/models/BaseStore';\nimport { displayError } from '@aws-ee/base-ui/dist/helpers/notification';\nimport ErrorBox from '@aws-ee/base-ui/dist/parts/helpers/ErrorBox';\nimport Form from '@aws-ee/base-ui/dist/parts/helpers/fields/Form';\nimport DropDown from '@aws-ee/base-ui/dist/parts/helpers/fields/DropDown';\nimport Input from '@aws-ee/base-ui/dist/parts/helpers/fields/Input';\n\nimport getCreateDraftForm from '../../../models/forms/CreateWorkflowTemplateDraftForm';\nimport ProgressPlaceHolder from '../../workflow-common/ProgressPlaceholder';\n\n// expected props\n// - onCancel (via prop) called on cancel\n// - workflowTemplateDraftsStore (via injection)\n// - workflowTemplatesStore (via injection)\n// - className (via props)\n// - location (from react router)\nclass CreateWorkflowTemplateDraft extends React.Component {\n  constructor(props) {\n    super(props);\n    this.form = getCreateDraftForm();\n  }\n\n  getStore() {\n    return this.props.workflowTemplateDraftsStore;\n  }\n\n  getTemplatesStore() {\n    return this.props.workflowTemplatesStore;\n  }\n\n  getDropdownOptions() {\n    const store = this.getTemplatesStore();\n    const draftsStore = this.getStore();\n    const templates = store.list;\n    const options = [];\n\n    _.forEach(templates, template => {\n      if (!draftsStore.hasTemplate(template.id)) {\n        options.push({\n          text: template.latest.title || '',\n          value: template.id,\n          content: (\n            <div>\n              <Label color=\"teal\" horizontal size=\"mini\">\n                Existing\n              </Label>{' '}\n              {template.latest.title} <span className=\"ml1 fs-7 color-grey\">{template.id}</span>\n            </div>\n          ),\n        });\n      }\n    });\n\n    options.unshift({\n      text: 'New Workflow Template',\n      value: '-1',\n      content: (\n        <div>\n          <Label color=\"blue\" horizontal size=\"mini\">\n            New\n          </Label>{' '}\n          Workflow Template\n        </div>\n      ),\n    });\n\n    return options;\n  }\n\n  goto(pathname) {\n    const location = this.props.location;\n    const link = createLink({ location, pathname });\n\n    this.props.history.push(link);\n  }\n\n  handleSelectionChange = templateId => {\n    const form = this.form;\n    const templateIdField = form.$('templateId');\n    const templateTitleField = form.$('templateTitle');\n    const clear = () => {\n      templateIdField.clear();\n      templateTitleField.clear();\n    };\n    const set = template => {\n      templateIdField.set(template.id);\n      templateTitleField.set(template.latest.title);\n    };\n\n    if (templateId === '-1') {\n      clear();\n    } else {\n      const store = this.getTemplatesStore();\n      const template = store.getTemplate(templateId);\n      if (_.isNil(template)) {\n        displayError(`The template \"${templateId}\" is no longer available.`);\n        clear();\n      } else {\n        set(template);\n      }\n    }\n  };\n\n  handleCancel = () => {\n    const onCancel = this.props.onCancel || _.noop;\n    onCancel();\n  };\n\n  handleFormError = (_form, _errors) => {\n    // We don't need to do anything here\n  };\n\n  handleFormSubmission = async form => {\n    const values = form.values();\n    const isNewTemplate = values.draftFor === '-1';\n    const templateId = values.templateId;\n    const templateTitle = isNewTemplate ? values.templateTitle : undefined;\n    const store = this.getStore();\n\n    try {\n      const draft = await store.createDraft({ isNewTemplate, templateId, templateTitle });\n      form.clear();\n      this.goto(`/workflow-templates/drafts/edit/${encodeURIComponent(draft.id)}`);\n    } catch (error) {\n      displayError(error);\n    }\n  };\n\n  render() {\n    const store = this.getStore();\n    let content = null;\n\n    if (isStoreError(store)) {\n      content = <ErrorBox error={store.error} className=\"p0 mb3\" />;\n    } else if (isStoreLoading(store)) {\n      content = <ProgressPlaceHolder />;\n    } else if (isStoreReady(store)) {\n      content = this.renderMain();\n    } else {\n      content = null;\n    }\n\n    return content;\n  }\n\n  renderMain() {\n    const form = this.form;\n    const dropDownOptions = this.getDropdownOptions();\n    const dropDownField = form.$('draftFor');\n    const templateIdField = form.$('templateId');\n    const templateTitleField = form.$('templateTitle');\n    const draftForValue = dropDownField.value;\n    const isNew = draftForValue === '-1';\n\n    return (\n      <Segment clearing className=\"p3\">\n        <Form\n          form={form}\n          onCancel={this.handleCancel}\n          onSuccess={this.handleFormSubmission}\n          onError={this.handleFormError}\n        >\n          {({ processing, _onSubmit, onCancel }) => (\n            <>\n              <DropDown\n                field={dropDownField}\n                options={dropDownOptions}\n                fluid\n                selection\n                disabled={processing}\n                onChange={this.handleSelectionChange}\n              />\n              {isNew && (\n                <>\n                  <Input field={templateIdField} disabled={processing} />\n                  <Input field={templateTitleField} disabled={processing} />\n                </>\n              )}\n              <div className=\"mt3\">\n                <Button floated=\"right\" color=\"blue\" icon disabled={processing} className=\"ml2\" type=\"submit\">\n                  Create Draft\n                </Button>\n                <Button floated=\"right\" disabled={processing} onClick={onCancel}>\n                  Cancel\n                </Button>\n              </div>\n            </>\n          )}\n        </Form>\n      </Segment>\n    );\n  }\n}\n\n// see https://medium.com/@mweststrate/mobx-4-better-simpler-faster-smaller-c1fbc08008da\ndecorate(CreateWorkflowTemplateDraft, {\n  handleCancel: action,\n  handleFormSubmission: action,\n  handleFormError: action,\n});\n\nexport default inject(\n  'workflowTemplateDraftsStore',\n  'workflowTemplatesStore',\n)(withRouter(observer(CreateWorkflowTemplateDraft)));\n"],"file":"CreateWorkflowTemplateDraft.js"}