{"version":3,"sources":["../../../../src/parts/data-sources/register/SubmitStep.js"],"names":["SubmitStep","handleCancel","goto","wizard","reset","handleRetry","retry","handleNext","advanceToNextStep","window","scrollTo","renderContent","operations","running","success","error","failure","_","map","ops","op","renderOperation","renderButtons","isError","isSuccess","isSkipped","skipped","isRunning","color","message","name","minHeight","id","disabled","allFailed","showNext","showRetry","showCancel","renderFailedStepsWarning","props","React","Component","computed","action"],"mappings":"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","sourcesContent":["/*\n *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\").\n *  You may not use this file except in compliance with the License.\n *  A copy of the License is located at\n *\n *  http://aws.amazon.com/apache2.0\n *\n *  or in the \"license\" file accompanying this file. This file is distributed\n *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n *  express or implied. See the License for the specific language governing\n *  permissions and limitations under the License.\n */\n\nimport _ from 'lodash';\nimport React from 'react';\nimport { decorate, computed, action } from 'mobx';\nimport { observer, inject } from 'mobx-react';\nimport { withRouter } from 'react-router-dom';\nimport { Segment, Button, Icon, Header, Progress, Message } from 'semantic-ui-react';\n\nimport { swallowError } from '@aws-ee/base-ui/dist/helpers/utils';\nimport { gotoFn } from '@aws-ee/base-ui/dist/helpers/routing';\n\n// expected props\n// - wizard (via prop)\nclass SubmitStep extends React.Component {\n  componentDidMount() {\n    window.scrollTo(0, 0);\n  }\n\n  get operations() {\n    return this.wizard.operations;\n  }\n\n  get running() {\n    return this.operations.running;\n  }\n\n  get success() {\n    return this.operations.success;\n  }\n\n  get failure() {\n    return this.operations.failure;\n  }\n\n  get allFailed() {\n    return this.operations.allFailed;\n  }\n\n  get wizard() {\n    return this.props.wizard;\n  }\n\n  handleCancel = () => {\n    const goto = gotoFn(this);\n    this.wizard.reset();\n\n    goto('/data-sources');\n  };\n\n  handleRetry = () => {\n    swallowError(this.wizard.retry());\n  };\n\n  handleNext = () => {\n    this.wizard.advanceToNextStep();\n  };\n\n  render() {\n    return (\n      <>\n        <Header as=\"h3\" icon textAlign=\"center\" className=\"mt2\" color=\"grey\">\n          Register Studies\n        </Header>\n        <Segment clearing className=\"p3\">\n          {this.renderContent()}\n        </Segment>\n      </>\n    );\n  }\n\n  renderContent() {\n    const operations = this.operations;\n    const running = this.running;\n    const success = this.success;\n    const error = this.failure;\n\n    return (\n      <div className=\"animated fadeIn\">\n        <div>\n          {running && (\n            <Header className=\"mb3\" as=\"h3\" color=\"grey\">\n              Registering Studies\n            </Header>\n          )}\n          {success && (\n            <Header className=\"mb3\" as=\"h3\" color=\"grey\">\n              Successfully Registered Studies\n            </Header>\n          )}\n          {error && (\n            <Header className=\"mb3\" as=\"h3\" color=\"grey\">\n              Error Registering Studies\n            </Header>\n          )}\n        </div>\n\n        <div>\n          {_.map(operations.ops, op => this.renderOperation(op))}\n          {this.renderButtons()}\n        </div>\n      </div>\n    );\n  }\n\n  renderFailedStepsWarning() {\n    return (\n      <Message warning>\n        <Message.Header>Failures have occurred</Message.Header>\n        <p>It seems that one or more steps have failed while registration. Please fix the errors and retry.</p>\n        <p>\n          If you wish to proceed anyway with creating/updating the CloudFormation stack, resources corresponding to the\n          failed steps might not be reflected in the CloudFormation template.\n        </p>\n      </Message>\n    );\n  }\n\n  renderOperation(op) {\n    const isError = op.failure;\n    const isSuccess = op.success;\n    const isSkipped = op.skipped;\n    const isRunning = op.running;\n    const color = isError ? 'red' : isSuccess ? 'green' : isRunning ? 'orange' : isSkipped ? 'orange' : 'grey';\n    const message = op.error || op.message;\n    const { name } = op;\n\n    return (\n      <Segment clearing padded className=\"mb2\" style={{ minHeight: '130px' }} key={op.id}>\n        <div className=\"flex\">\n          <div className=\"mr2\">\n            <Icon color={color} name={isRunning ? 'circle notch' : 'circle'} loading={isRunning} size=\"large\" />\n          </div>\n          <div className=\"flex-auto\">\n            <Header as=\"h5\" className=\"mb0\">\n              {name}\n            </Header>\n            <Progress\n              className=\"mb1 w-100\"\n              percent={100}\n              active={isRunning}\n              error={isError}\n              success={isSuccess}\n              warning={isSkipped}\n              color={color}\n              size=\"tiny\"\n            />\n            <div className=\"fs-9 color-grey\">{message}</div>\n          </div>\n        </div>\n      </Segment>\n    );\n  }\n\n  renderButtons() {\n    // Show retry button if allFailed or some failure\n    // Show next button if failure or success\n    // Show cancel button if allFailed\n    const running = this.running;\n    const disabled = this.running;\n    const success = this.success;\n    const failure = this.failure;\n    const allFailed = this.allFailed;\n    const showNext = !allFailed && (failure || success);\n    const showRetry = allFailed || failure;\n    const showCancel = showRetry;\n\n    return (\n      <div className=\"mt3\">\n        {this.failure && this.renderFailedStepsWarning()}\n        {showNext && (\n          <Button\n            floated=\"right\"\n            className=\"ml2\"\n            primary\n            icon=\"right arrow\"\n            labelPosition=\"right\"\n            content=\"Next\"\n            loading={running}\n            disabled={disabled}\n            onClick={this.handleNext}\n          />\n        )}\n\n        {showRetry && (\n          <Button\n            floated=\"right\"\n            color=\"red\"\n            className=\"ml2\"\n            content=\"Retry\"\n            loading={running}\n            disabled={disabled}\n            onClick={this.handleRetry}\n          />\n        )}\n\n        {showCancel && (\n          <Button floated=\"right\" className=\"ml2\" content=\"Cancel\" disabled={disabled} onClick={this.handleCancel} />\n        )}\n      </div>\n    );\n  }\n}\n\n// see https://medium.com/@mweststrate/mobx-4-better-simpler-faster-smaller-c1fbc08008da\ndecorate(SubmitStep, {\n  wizard: computed,\n  operations: computed,\n  running: computed,\n  success: computed,\n  failure: computed,\n  allFailed: computed,\n  handleCancel: action,\n  handleRetry: action,\n  handleNext: action,\n});\n\nexport default inject()(withRouter(observer(SubmitStep)));\n"],"file":"SubmitStep.js"}