{"version":3,"sources":["../../../../src/parts/environments-sc/setup/SelectEnvTypeStep.js"],"names":["SelectEnvTypeStep","props","handleSelectedEnvType","typeId","selectedEnvTypeId","handlePrevious","event","preventDefault","stopPropagation","_","isFunction","onPrevious","handleNext","onNext","processing","undefined","window","scrollTo","envTypesStore","load","pathname","goto","store","content","renderLoadingError","renderEmpty","renderContent","nextDisabled","isUndefined","renderCards","renderButtons","envTypes","listApproved","isSelected","type","id","getAttrs","attrs","color","onClick","map","name","__html","descHtml","error","userStore","React","Component","action","computed","observable"],"mappings":"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","sourcesContent":["import _ from 'lodash';\nimport React from 'react';\nimport { decorate, computed, runInAction, observable, action } from 'mobx';\nimport { observer, inject } from 'mobx-react';\nimport { withRouter } from 'react-router-dom';\nimport { Icon, Header, Segment, Button, Card, Radio, Divider } from 'semantic-ui-react';\nimport c from 'classnames';\nimport { displayError } from '@aws-ee/base-ui/dist/helpers/notification';\nimport { swallowError } from '@aws-ee/base-ui/dist/helpers/utils';\nimport { isStoreLoading, isStoreError, isStoreEmpty } from '@aws-ee/base-ui/dist/models/BaseStore';\nimport BasicProgressPlaceholder from '@aws-ee/base-ui/dist/parts/helpers/BasicProgressPlaceholder';\nimport { gotoFn } from '@aws-ee/base-ui/dist/helpers/routing';\nimport ErrorBox from '@aws-ee/base-ui/dist/parts/helpers/ErrorBox';\n\n// expected props\n// - onPrevious (via props)\n// - onNext (via props) a function is called with the selected envTypeId\n// - envTypesStore (via injection)\n// - userStore (via injection)\nclass SelectEnvTypeStep extends React.Component {\n  constructor(props) {\n    super(props);\n    runInAction(() => {\n      this.selectedEnvTypeId = undefined;\n      this.processing = false;\n    });\n  }\n\n  componentDidMount() {\n    window.scrollTo(0, 0);\n    swallowError(this.envTypesStore.load());\n  }\n\n  goto(pathname) {\n    const goto = gotoFn(this);\n    goto(pathname);\n  }\n\n  get userStore() {\n    return this.props.userStore;\n  }\n\n  get envTypesStore() {\n    return this.props.envTypesStore;\n  }\n\n  handleSelectedEnvType = typeId => {\n    this.selectedEnvTypeId = typeId;\n  };\n\n  handlePrevious = event => {\n    event.preventDefault();\n    event.stopPropagation();\n    if (_.isFunction(this.props.onPrevious)) this.props.onPrevious();\n  };\n\n  handleNext = async event => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    if (_.isFunction(this.props.onNext)) {\n      try {\n        this.processing = true;\n        await this.props.onNext(this.selectedEnvTypeId);\n      } catch (error) {\n        displayError(error);\n      } finally {\n        runInAction(() => {\n          this.processing = false;\n        });\n      }\n    }\n  };\n\n  render() {\n    const store = this.envTypesStore;\n    if (!store) return null;\n\n    let content;\n    if (isStoreError(store)) {\n      content = this.renderLoadingError();\n    } else if (isStoreLoading(store)) {\n      content = <BasicProgressPlaceholder className=\"mt2\" />;\n    } else if (isStoreEmpty(store)) {\n      content = this.renderEmpty();\n    } else {\n      content = this.renderContent();\n    }\n\n    return content;\n  }\n\n  renderContent() {\n    // Logic:\n    // - if external researcher and no aws creds configured yet, show a message\n    // - if guest (internal/external) show a message\n    // - if internal researcher and no project ids, show a message\n    // - else show env types card\n    const nextDisabled = _.isUndefined(this.selectedEnvTypeId);\n\n    return (\n      <div className=\"mt2 animated fadeIn\">\n        {this.renderCards()}\n        {this.renderButtons({ nextDisabled })}\n      </div>\n    );\n  }\n\n  renderCards() {\n    const processing = this.processing;\n    const envTypes = this.envTypesStore.listApproved || [];\n    const isSelected = type => type.id === this.selectedEnvTypeId;\n    const getAttrs = type => {\n      const attrs = {};\n      if (isSelected(type)) attrs.color = 'blue';\n      if (!processing) attrs.onClick = () => this.handleSelectedEnvType(type.id);\n      return attrs;\n    };\n\n    return (\n      <Card.Group stackable itemsPerRow={3}>\n        {_.map(envTypes, type => (\n          <Card\n            data-testid=\"env-type-card\"\n            key={type.id}\n            raised\n            className={c('mb3', { 'cursor-pointer': !processing })}\n            {...getAttrs(type)}\n          >\n            <Card.Content>\n              <Card.Header>\n                <div className=\"flex mt1\">\n                  <Radio className=\"mr2\" checked={isSelected(type)} disabled={processing} />\n                  <Header as=\"h4\" className=\"flex-auto mt0 pt0\">\n                    {type.name}\n                  </Header>\n                </div>\n                <Divider />\n              </Card.Header>\n              <Card.Description>\n                <div className=\"mb3 pr1 pl1 pb1\">\n                  {/* Yes, we are doing dangerouslySetInnerHTML, the content was already sanitized by showdownjs */}\n                  {/* eslint-disable-next-line react/no-danger */}\n                  <div dangerouslySetInnerHTML={{ __html: type.descHtml }} />\n                </div>\n              </Card.Description>\n            </Card.Content>\n          </Card>\n        ))}\n      </Card.Group>\n    );\n  }\n\n  renderLoadingError() {\n    const store = this.envTypesStore;\n    return (\n      <>\n        <ErrorBox error={store.error} className=\"p0 mt2 mb3\" />\n        {this.renderButtons()}\n      </>\n    );\n  }\n\n  renderEmpty() {\n    return (\n      <>\n        <Segment placeholder className=\"mt2\">\n          <Header icon className=\"color-grey\">\n            <Icon name=\"server\" />\n            No workspace types\n            <Header.Subheader>\n              There are no workspace types to choose from. Your role might be restricted. Please contact your\n              administrator.\n            </Header.Subheader>\n          </Header>\n        </Segment>\n        {this.renderButtons()}\n      </>\n    );\n  }\n\n  renderButtons({ nextDisabled = true } = {}) {\n    const processing = this.processing;\n    return (\n      <div className=\"mt3\">\n        <Button\n          floated=\"right\"\n          icon=\"right arrow\"\n          labelPosition=\"right\"\n          className=\"ml2\"\n          primary\n          content=\"Next\"\n          loading={processing}\n          disabled={nextDisabled || processing}\n          onClick={this.handleNext}\n        />\n        <Button\n          floated=\"right\"\n          icon=\"left arrow\"\n          labelPosition=\"left\"\n          className=\"ml2\"\n          content=\"Previous\"\n          disabled={processing}\n          onClick={this.handlePrevious}\n        />\n      </div>\n    );\n  }\n}\n\n// see https://medium.com/@mweststrate/mobx-4-better-simpler-faster-smaller-c1fbc08008da\ndecorate(SelectEnvTypeStep, {\n  handlePrevious: action,\n  handleNext: action,\n  handleSelectedEnvType: action,\n  userStore: computed,\n  envTypesStore: computed,\n  processing: observable,\n  selectedEnvTypeId: observable,\n});\n\nexport default inject('userStore', 'envTypesStore')(withRouter(observer(SelectEnvTypeStep)));\n"],"file":"SelectEnvTypeStep.js"}