{"version":3,"sources":["../../../src/parts/compute/ConfigureComputePlatformStep.js"],"names":["ConfigureComputePlatformStep","handlePrevious","_","isFunction","props","onPrevious","handleCreate","data","studyIds","store","environmentsStore","createEnvironment","environment","onCompleted","window","scrollTo","configurations","content","isEmpty","renderEmpty","renderContent","platformId","title","platformTitle","defaultCidr","isExternal","userStore","user","isExternalUser","renderButtons","nextDisabled","get","computePlatformsStore","getComputePlatform","clientInformationStore","platform","configurationsList","value","first","isUndefined","undefined","ipAddress","React","Component","action","computed"],"mappings":"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","sourcesContent":["/*\n *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\").\n *  You may not use this file except in compliance with the License.\n *  A copy of the License is located at\n *\n *  http://aws.amazon.com/apache2.0\n *\n *  or in the \"license\" file accompanying this file. This file is distributed\n *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n *  express or implied. See the License for the specific language governing\n *  permissions and limitations under the License.\n */\n\nimport _ from 'lodash';\nimport React from 'react';\nimport { decorate, computed, action } from 'mobx';\nimport { observer, inject } from 'mobx-react';\nimport { Icon, Header, Segment, Button } from 'semantic-ui-react';\n\nimport CreateInternalPlatformForm from './parts/CreateInternalPlatformForm';\nimport CreateExternalPlatformForm from './parts/CreateExternalPlatformForm';\n\n// expected props\n// - onPrevious (via props)\n// - onCompleted (via props) a function is called after a call to create a workspace is performed\n// - platformId (via props)\n// - studyIds (via props)\n// - computePlatformsStore (via injection)\n// - clientInformationStore (via injection)\n// - userStore (via injection)\n// - environmentsStore (via injection)\nclass ConfigureComputePlatformStep extends React.Component {\n  componentDidMount() {\n    window.scrollTo(0, 0);\n  }\n\n  get platformId() {\n    return this.props.platformId;\n  }\n\n  get platformTitle() {\n    return _.get(this.computePlatformsStore.getComputePlatform(this.platformId), 'title');\n  }\n\n  get userStore() {\n    return this.props.userStore;\n  }\n\n  get clientInformationStore() {\n    return this.props.clientInformationStore;\n  }\n\n  get computePlatformsStore() {\n    return this.props.computePlatformsStore;\n  }\n\n  get environmentsStore() {\n    return this.props.environmentsStore;\n  }\n\n  get configurations() {\n    const platform = this.computePlatformsStore.getComputePlatform(this.platformId);\n    if (!platform) return [];\n    return platform.configurationsList;\n  }\n\n  get defaultCidr() {\n    // We pick the first one\n    const value = _.get(_.first(this.configurations), 'defaultCidr');\n    if (_.isUndefined(value)) return undefined; // This means that cidr should not be treated as an input\n    if (!_.isEmpty(value)) return value;\n    if (_.isEmpty(this.clientInformationStore.ipAddress)) return '';\n\n    return `${this.clientInformationStore.ipAddress}/32`;\n  }\n\n  get studyIds() {\n    return this.props.studyIds;\n  }\n\n  handlePrevious = () => {\n    if (_.isFunction(this.props.onPrevious)) this.props.onPrevious();\n  };\n\n  // eslint-disable-next-line consistent-return\n  handleCreate = async data => {\n    const studyIds = this.studyIds || [];\n    const store = this.environmentsStore;\n    const environment = await store.createEnvironment({ ...data, studyIds });\n    return this.props.onCompleted(environment);\n  };\n\n  render() {\n    // Note: we assume that whatever component that is including this component, has\n    // already loaded and verified that the computePlatformsStore has no errors\n    const configurations = this.configurations;\n    let content = null;\n\n    if (_.isEmpty(configurations)) {\n      content = this.renderEmpty();\n    } else {\n      content = this.renderContent();\n    }\n\n    return content;\n  }\n\n  renderContent() {\n    const platformId = this.platformId;\n    const configurations = this.configurations;\n    const title = this.platformTitle;\n    const defaultCidr = this.defaultCidr;\n    const isExternal = this.userStore.user.isExternalUser;\n\n    return (\n      <div className=\"mt2 animated fadeIn\">\n        {!isExternal && (\n          <CreateInternalPlatformForm\n            platformId={platformId}\n            configurations={configurations}\n            title={title}\n            defaultCidr={defaultCidr}\n            onPrevious={this.handlePrevious}\n            onNext={this.handleCreate}\n          />\n        )}\n        {isExternal && (\n          <CreateExternalPlatformForm\n            platformId={platformId}\n            configurations={configurations}\n            title={title}\n            defaultCidr={defaultCidr}\n            onPrevious={this.handlePrevious}\n            onNext={this.handleCreate}\n          />\n        )}\n      </div>\n    );\n  }\n\n  renderEmpty() {\n    const title = this.platformTitle;\n    return (\n      <>\n        <Header as=\"h3\" textAlign=\"center\" className=\"mt2\">\n          {title}\n        </Header>\n        <Segment placeholder className=\"mt2\">\n          <Header icon className=\"color-grey\">\n            <Icon name=\"server\" />\n            No compute platform configurations\n            <Header.Subheader>\n              There are no compute platform configurations to choose from. Your role might be restricted. Please contact\n              your administrator.\n            </Header.Subheader>\n          </Header>\n        </Segment>\n        {this.renderButtons()}\n      </>\n    );\n  }\n\n  renderButtons({ nextDisabled = true } = {}) {\n    return (\n      <div className=\"mt3\">\n        <Button floated=\"right\" className=\"ml2\" primary content=\"Create Research Workspace\" disabled={nextDisabled} />\n        <Button\n          floated=\"right\"\n          icon=\"left arrow\"\n          labelPosition=\"left\"\n          className=\"ml2\"\n          content=\"Previous\"\n          onClick={this.handlePrevious}\n        />\n      </div>\n    );\n  }\n}\n\n// see https://medium.com/@mweststrate/mobx-4-better-simpler-faster-smaller-c1fbc08008da\ndecorate(ConfigureComputePlatformStep, {\n  handlePrevious: action,\n  handleCreate: action,\n  userStore: computed,\n  computePlatformsStore: computed,\n  clientInformationStore: computed,\n  platformId: computed,\n  defaultCidr: computed,\n  platformTitle: computed,\n  environmentsStore: computed,\n  studyIds: computed,\n});\n\nexport default inject(\n  'userStore',\n  'computePlatformsStore',\n  'clientInformationStore',\n  'environmentsStore',\n)(observer(ConfigureComputePlatformStep));\n"],"file":"ConfigureComputePlatformStep.js"}