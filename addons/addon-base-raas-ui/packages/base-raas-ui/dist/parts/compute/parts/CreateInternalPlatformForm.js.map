{"version":3,"sources":["../../../../src/parts/compute/parts/CreateInternalPlatformForm.js"],"names":["CreateInternalPlatformForm","props","handlePrevious","_","isFunction","onPrevious","handleNext","form","data","values","params","platformId","configuration","find","configurations","configurationId","forEach","keys","mutableParams","key","has","onNext","projectIdOptions","cidr","defaultCidr","title","renderForm","askForCidr","isUndefined","processing","onCancel","$","store","userStore","projectIdDropdown","React","Component","observable","computed","action"],"mappings":";;;;;;;;;AAeA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACMA,0B;;;;;AACJ,sCAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,8BAAMA,KAAN;;AADiB,UA4BnBC,cA5BmB,GA4BF,YAAM;AACrB,UAAIC,mBAAEC,UAAF,CAAa,MAAKH,KAAL,CAAWI,UAAxB,CAAJ,EAAyC,OAAO,MAAKJ,KAAL,CAAWI,UAAX,EAAP;AAC1C,KA9BkB;;AAAA,UAiCnBC,UAjCmB;AAAA,yEAiCN,iBAAMC,IAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AACLC,gBAAAA,IADK,qBACOD,IAAI,CAACE,MAAL,EADP;AACsBC,kBAAAA,MAAM,EAAE,EAD9B;AACkCC,kBAAAA,UAAU,EAAE,MAAKA;AADnD,oBAGX;;AACMC,gBAAAA,aAJK,GAIWT,mBAAEU,IAAF,CAAO,MAAKC,cAAZ,EAA4B,CAAC,IAAD,EAAON,IAAI,CAACO,eAAZ,CAA5B,CAJX;;AAKXZ,mCAAEa,OAAF,CAAUb,mBAAEc,IAAF,CAAOL,aAAa,CAACM,aAArB,CAAV,EAA+C,UAAAC,GAAG,EAAI;AACpD,sBAAI,CAAChB,mBAAEiB,GAAF,CAAMZ,IAAN,EAAYW,GAAZ,CAAL,EAAuB;AACvBX,kBAAAA,IAAI,CAACE,MAAL,CAAYS,GAAZ,IAAmBX,IAAI,CAACW,GAAD,CAAvB;AACA,yBAAOX,IAAI,CAACW,GAAD,CAAX;AACD,iBAJD;;AALW;AAAA;AAAA,uBAYH,MAAKlB,KAAL,CAAWoB,MAAX,CAAkBb,IAAlB,CAZG;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAcT;;AAdS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAjCM;;AAAA;AAAA;AAAA;AAAA;;AAEjB,2BAAY,YAAM;AAChB,YAAKD,IAAL,GAAY,+DAA8B;AACxCe,QAAAA,gBAAgB,EAAE,MAAKA,gBADiB;AAExCC,QAAAA,IAAI,EAAE,MAAKtB,KAAL,CAAWuB;AAFuB,OAA9B,CAAZ;AAID,KALD;AAFiB;AAQlB;;;;6BA2CQ;AACP,UAAMC,KAAK,GAAG,KAAKxB,KAAL,CAAWwB,KAAX,IAAoB,EAAlC;AACA,0BACE;AAAK,QAAA,SAAS,EAAC;AAAf,sBACE,gCAAC,uBAAD;AAAQ,QAAA,EAAE,EAAC,IAAX;AAAgB,QAAA,SAAS,EAAC;AAA1B,SACGA,KADH,CADF,EAIG,KAAKC,UAAL,EAJH,CADF;AAQD;;;iCAEY;AACX,UAAMnB,IAAI,GAAG,KAAKA,IAAlB;AACA,UAAMoB,UAAU,GAAG,CAACxB,mBAAEyB,WAAF,CAAc,KAAK3B,KAAL,CAAWuB,WAAzB,CAApB;AACA,UAAMV,cAAc,GAAG,KAAKA,cAA5B;AAEA,0BACE,gCAAC,wBAAD;AAAS,QAAA,QAAQ,MAAjB;AAAkB,QAAA,SAAS,EAAC;AAA5B,sBACE,gCAAC,gBAAD;AAAM,QAAA,IAAI,EAAEP,IAAZ;AAAkB,QAAA,QAAQ,EAAE,KAAKL,cAAjC;AAAiD,QAAA,SAAS,EAAE,KAAKI;AAAjE,SACG;AAAA,YAAGuB,UAAH,SAAGA,UAAH;AAAA,YAA+BC,QAA/B,SAA+BA,QAA/B;AAAA,4BACC,+EACE,gCAAC,iBAAD;AAAO,UAAA,KAAK,EAAEvB,IAAI,CAACwB,CAAL,CAAO,MAAP;AAAd,UADF,EAEGJ,UAAU,iBAAI,gCAAC,iBAAD;AAAO,UAAA,KAAK,EAAEpB,IAAI,CAACwB,CAAL,CAAO,MAAP;AAAd,UAFjB,eAGE,gCAAC,oBAAD;AAAU,UAAA,KAAK,EAAExB,IAAI,CAACwB,CAAL,CAAO,WAAP,CAAjB;AAAsC,UAAA,KAAK,MAA3C;AAA4C,UAAA,SAAS;AAArD,UAHF,eAIE,gCAAC,oCAAD;AAA0B,UAAA,cAAc,EAAEjB,cAA1C;AAA0D,UAAA,SAAS,EAAEP,IAAI,CAACwB,CAAL,CAAO,iBAAP;AAArE,UAJF,eAKE,gCAAC,oBAAD;AAAU,UAAA,KAAK,EAAExB,IAAI,CAACwB,CAAL,CAAO,aAAP;AAAjB,UALF,eAOE,gCAAC,uBAAD;AACE,UAAA,OAAO,EAAC,OADV;AAEE,UAAA,SAAS,EAAC,KAFZ;AAGE,UAAA,OAAO,MAHT;AAIE,UAAA,OAAO,EAAC,2BAJV;AAKE,UAAA,QAAQ,EAAEF,UALZ;AAME,UAAA,IAAI,EAAC;AANP,UAPF,eAgBE,gCAAC,uBAAD;AACE,UAAA,OAAO,EAAC,OADV;AAEE,UAAA,IAAI,EAAC,YAFP;AAGE,UAAA,aAAa,EAAC,MAHhB;AAIE,UAAA,SAAS,EAAC,KAJZ;AAKE,UAAA,OAAO,EAAC,UALV;AAME,UAAA,QAAQ,EAAEA,UANZ;AAOE,UAAA,OAAO,EAAEC;AAPX,UAhBF,CADD;AAAA,OADH,CADF,CADF;AAkCD;;;wBA5FsB;AACrB,UAAME,KAAK,GAAG,KAAKC,SAAnB;AACA,aAAOD,KAAK,CAACE,iBAAb;AACD;;;wBAEgB;AACf,aAAO,KAAKjC,KAAL,CAAWU,UAAlB;AACD;;;wBAEoB;AACnB,aAAO,KAAKV,KAAL,CAAWa,cAAlB;AACD;;;wBAEe;AACd,aAAO,KAAKb,KAAL,CAAWgC,SAAlB;AACD,K,CAED;;;;;EA5BuCE,kBAAMC,S,GA0G/C;;;AACA,oBAASpC,0BAAT,EAAqC;AACnCO,EAAAA,IAAI,EAAE8B,gBAD6B;AAEnC1B,EAAAA,UAAU,EAAE2B,cAFuB;AAGnCxB,EAAAA,cAAc,EAAEwB,cAHmB;AAInCL,EAAAA,SAAS,EAAEK,cAJwB;AAKnChB,EAAAA,gBAAgB,EAAEgB,cALiB;AAMnCpC,EAAAA,cAAc,EAAEqC;AANmB,CAArC;;eASe,uBAAO,WAAP,EAAoB,wBAApB,EAA8C,yBAASvC,0BAAT,CAA9C,C","sourcesContent":["/*\n *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\").\n *  You may not use this file except in compliance with the License.\n *  A copy of the License is located at\n *\n *  http://aws.amazon.com/apache2.0\n *\n *  or in the \"license\" file accompanying this file. This file is distributed\n *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n *  express or implied. See the License for the specific language governing\n *  permissions and limitations under the License.\n */\n\nimport _ from 'lodash';\nimport React from 'react';\nimport { decorate, computed, runInAction, observable, action } from 'mobx';\nimport { observer, inject } from 'mobx-react';\nimport { Segment, Button, Header } from 'semantic-ui-react';\nimport { displayError } from '@aws-ee/base-ui/dist/helpers/notification';\nimport Dropdown from '@aws-ee/base-ui/dist/parts/helpers/fields/DropDown';\nimport Form from '@aws-ee/base-ui/dist/parts/helpers/fields/Form';\nimport Input from '@aws-ee/base-ui/dist/parts/helpers/fields/Input';\nimport TextArea from '@aws-ee/base-ui/dist/parts/helpers/fields/TextArea';\n\nimport { getCreateInternalPlatformForm } from '../../../models/forms/CreateInternalPlatformForm';\nimport SelectConfigurationCards from './SelectConfigurationCards';\n\n// expected props\n// - onPrevious (via props)\n// - onNext (via props) a function is called with the form data\n// - platformId (via props)\n// - configurations (via props)\n// - title (via props)\n// - defaultCidr (via props)\n// - clientInformationStore (via injection)\n// - userStore (via injection)\nclass CreateInternalPlatformForm extends React.Component {\n  constructor(props) {\n    super(props);\n    runInAction(() => {\n      this.form = getCreateInternalPlatformForm({\n        projectIdOptions: this.projectIdOptions,\n        cidr: this.props.defaultCidr,\n      });\n    });\n  }\n\n  get projectIdOptions() {\n    const store = this.userStore;\n    return store.projectIdDropdown;\n  }\n\n  get platformId() {\n    return this.props.platformId;\n  }\n\n  get configurations() {\n    return this.props.configurations;\n  }\n\n  get userStore() {\n    return this.props.userStore;\n  }\n\n  // eslint-disable-next-line consistent-return\n  handlePrevious = () => {\n    if (_.isFunction(this.props.onPrevious)) return this.props.onPrevious();\n  };\n\n  // eslint-disable-next-line consistent-return\n  handleNext = async form => {\n    const data = { ...form.values(), params: {}, platformId: this.platformId };\n\n    // We pick the mutable parameters and put them in params object\n    const configuration = _.find(this.configurations, ['id', data.configurationId]);\n    _.forEach(_.keys(configuration.mutableParams), key => {\n      if (!_.has(data, key)) return;\n      data.params[key] = data[key];\n      delete data[key];\n    });\n\n    try {\n      await this.props.onNext(data);\n    } catch (error) {\n      displayError(error);\n    }\n  };\n\n  render() {\n    const title = this.props.title || '';\n    return (\n      <div className=\"mt2\">\n        <Header as=\"h3\" textAlign=\"center\">\n          {title}\n        </Header>\n        {this.renderForm()}\n      </div>\n    );\n  }\n\n  renderForm() {\n    const form = this.form;\n    const askForCidr = !_.isUndefined(this.props.defaultCidr);\n    const configurations = this.configurations;\n\n    return (\n      <Segment clearing className=\"p3 mb3\">\n        <Form form={form} onCancel={this.handlePrevious} onSuccess={this.handleNext}>\n          {({ processing, /* onSubmit, */ onCancel }) => (\n            <>\n              <Input field={form.$('name')} />\n              {askForCidr && <Input field={form.$('cidr')} />}\n              <Dropdown field={form.$('projectId')} fluid selection />\n              <SelectConfigurationCards configurations={configurations} formField={form.$('configurationId')} />\n              <TextArea field={form.$('description')} />\n\n              <Button\n                floated=\"right\"\n                className=\"ml2\"\n                primary\n                content=\"Create Research Workspace\"\n                disabled={processing}\n                type=\"submit\"\n              />\n\n              <Button\n                floated=\"right\"\n                icon=\"left arrow\"\n                labelPosition=\"left\"\n                className=\"ml2\"\n                content=\"Previous\"\n                disabled={processing}\n                onClick={onCancel}\n              />\n            </>\n          )}\n        </Form>\n      </Segment>\n    );\n  }\n}\n\n// see https://medium.com/@mweststrate/mobx-4-better-simpler-faster-smaller-c1fbc08008da\ndecorate(CreateInternalPlatformForm, {\n  form: observable,\n  platformId: computed,\n  configurations: computed,\n  userStore: computed,\n  projectIdOptions: computed,\n  handlePrevious: action,\n});\n\nexport default inject('userStore', 'clientInformationStore')(observer(CreateInternalPlatformForm));\n"],"file":"CreateInternalPlatformForm.js"}