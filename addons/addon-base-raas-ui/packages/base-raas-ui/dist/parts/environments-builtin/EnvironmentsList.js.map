{"version":3,"sources":["../../../src/parts/environments-builtin/EnvironmentsList.js"],"names":["EnvironmentsList","props","setOnboarding","value","onboardingOpen","hidePinModal","pinModalOpen","handleDetailClick","event","preventDefault","stopPropagation","instanceId","currentTarget","dataset","instance","goto","handleCreateEnvironment","handleConfigureCredentials","needsAWSCredentials","user","isExternalResearcher","hasCredentials","getUserStore","isExternalUser","_","isEmpty","storage","getItem","localStorageKeys","pinToken","getEnvironmentsStore","load","startHeartbeat","stopHeartbeat","environmentsStore","userStore","store","content","renderConfigureAWS","error","renderEmpty","renderMain","renderTitle","renderTotal","total","list","map","item","id","React","Component","action","observable"],"mappings":"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","sourcesContent":["import _ from 'lodash';\nimport React from 'react';\nimport { decorate, action, observable, runInAction } from 'mobx';\nimport { observer, inject } from 'mobx-react';\nimport { withRouter } from 'react-router-dom';\nimport { Header, Icon, Segment, Container, Label, Button } from 'semantic-ui-react';\n\nimport { gotoFn } from '@aws-ee/base-ui/dist/helpers/routing';\nimport { storage, swallowError } from '@aws-ee/base-ui/dist/helpers/utils';\nimport { isStoreLoading, isStoreEmpty, isStoreNotEmpty, isStoreError } from '@aws-ee/base-ui/dist/models/BaseStore';\nimport ErrorBox from '@aws-ee/base-ui/dist/parts/helpers/ErrorBox';\nimport ProgressPlaceHolder from '@aws-ee/base-ui/dist/parts/helpers/BasicProgressPlaceholder';\n\nimport EnvironmentCard from './EnvironmentCard';\nimport UserOnboarding from '../users/UserOnboarding';\nimport UserPinModal from '../users/UserPinModal';\nimport localStorageKeys from '../../models/constants/local-storage-keys';\n\n// expected props\n// - environmentsStore (via injection)\n// - location (from react router)\nclass EnvironmentsList extends React.Component {\n  constructor(props) {\n    super(props);\n    const user = this.getUserStore().user;\n\n    runInAction(() => {\n      this.user = user;\n      this.onboardingOpen = false;\n      this.pinModalOpen = user.isExternalUser && _.isEmpty(storage.getItem(localStorageKeys.pinToken));\n    });\n  }\n\n  componentDidMount() {\n    swallowError(this.getEnvironmentsStore().load());\n    this.getEnvironmentsStore().startHeartbeat();\n  }\n\n  componentWillUnmount() {\n    this.getEnvironmentsStore().stopHeartbeat();\n  }\n\n  getEnvironmentsStore() {\n    return this.props.environmentsStore;\n  }\n\n  getUserStore() {\n    return this.props.userStore;\n  }\n\n  setOnboarding = value => {\n    this.onboardingOpen = value;\n  };\n\n  hidePinModal = () => {\n    this.pinModalOpen = false;\n  };\n\n  handleDetailClick = event => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    // see https://reactjs.org/docs/events.html and https://github.com/facebook/react/issues/5733\n    const instanceId = event.currentTarget.dataset.instance;\n    const goto = gotoFn(this);\n    goto(`/workspaces/id/${instanceId}`);\n  };\n\n  handleCreateEnvironment = event => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    const goto = gotoFn(this);\n    goto(`/workspaces/create`);\n  };\n\n  handleConfigureCredentials = event => {\n    event.preventDefault();\n    event.stopPropagation();\n    this.setOnboarding(true);\n  };\n\n  needsAWSCredentials = () => this.user.isExternalResearcher && !this.user.hasCredentials;\n\n  render() {\n    const store = this.getEnvironmentsStore();\n    let content = null;\n\n    if (this.needsAWSCredentials()) {\n      content = this.renderConfigureAWS();\n    } else if (isStoreError(store)) {\n      content = <ErrorBox error={store.error} className=\"p0\" />;\n    } else if (isStoreLoading(store)) {\n      content = <ProgressPlaceHolder segmentCount={3} />;\n    } else if (isStoreEmpty(store)) {\n      content = this.renderEmpty();\n    } else if (isStoreNotEmpty(store)) {\n      content = this.renderMain();\n    } else {\n      content = null;\n    }\n\n    return (\n      <Container className=\"mt3 animated fadeIn\">\n        {this.renderTitle()}\n        {content}\n        {this.onboardingOpen && <UserOnboarding onclose={() => this.setOnboarding(false)} />}\n      </Container>\n    );\n  }\n\n  renderEmpty() {\n    return (\n      <Segment placeholder>\n        <Header icon className=\"color-grey\">\n          <Icon name=\"clipboard outline\" />\n          No research workspaces\n          <Header.Subheader>To create a research workspace, click Create Research Workspace.</Header.Subheader>\n        </Header>\n      </Segment>\n    );\n  }\n\n  renderConfigureAWS() {\n    return (\n      <Segment placeholder>\n        <Header icon className=\"color-grey\">\n          <Icon name=\"key\" />\n          No AWS credentials\n          <Header.Subheader>To manage research workspaces, click Configure AWS Credentials.</Header.Subheader>\n        </Header>\n      </Segment>\n    );\n  }\n\n  renderTitle() {\n    return (\n      <div className=\"mb3 flex\">\n        <Header as=\"h3\" className=\"color-grey mt1 mb0 flex-auto\">\n          <Icon name=\"server\" className=\"align-top\" />\n          <Header.Content className=\"left-align\">Research Workspaces {this.renderTotal()}</Header.Content>\n        </Header>\n        {this.needsAWSCredentials() ? (\n          <Button color=\"orange\" size=\"medium\" basic onClick={this.handleConfigureCredentials}>\n            Configure AWS Credentials\n          </Button>\n        ) : (\n          <Button color=\"blue\" size=\"medium\" basic onClick={this.handleCreateEnvironment}>\n            Create Research Workspace\n          </Button>\n        )}\n      </div>\n    );\n  }\n\n  renderTotal() {\n    const store = this.getEnvironmentsStore();\n    if (isStoreError(store) || isStoreLoading(store)) return null;\n\n    return <Label circular>{store.total}</Label>;\n  }\n\n  renderMain() {\n    const store = this.getEnvironmentsStore();\n    const list = store.list;\n\n    return (\n      <div>\n        <UserPinModal\n          show={this.pinModalOpen}\n          hideModal={this.hidePinModal}\n          user={this.user}\n          message=\"PIN is required to get previously created stack information\"\n        />\n        {_.map(list, item => (\n          <Segment\n            className=\"p3 mb2 cursor-pointer\"\n            clearing\n            key={item.id}\n            data-instance={item.id}\n            onClick={this.handleDetailClick}\n          >\n            <EnvironmentCard environment={item} environmentsStore={this.getEnvironmentsStore()} user={this.user} />\n          </Segment>\n        ))}\n      </div>\n    );\n  }\n}\n\n// see https://medium.com/@mweststrate/mobx-4-better-simpler-faster-smaller-c1fbc08008da\ndecorate(EnvironmentsList, {\n  handleDetailClick: action,\n  setOnboarding: action,\n  hidePinModal: action,\n  user: observable,\n  onboardingOpen: observable,\n  pinModalOpen: observable,\n});\n\nexport default inject('environmentsStore', 'userStore')(withRouter(observer(EnvironmentsList)));\n"],"file":"EnvironmentsList.js"}