{"version":3,"sources":["../../../src/parts/studies/StudiesTab.js"],"names":["StudiesTab","store","studiesStore","load","startHeartbeat","stopHeartbeat","content","error","renderEmpty","renderContent","isSelectable","canSelectStudy","list","map","study","id","categoryId","props","category","isOpenData","categories","openData","isOrgData","organization","canCreateStudy","header","subheader","studiesStoresMap","_","get","userStore","hasProjects","can","isExternalUser","React","Component","computed"],"mappings":";;;;;;;;;AAgBA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;AAEA;AACA;AACA;AACA;IACMA,U;;;;;;;;;;;;;wCAKgB;AAClB,UAAMC,KAAK,GAAG,KAAKC,YAAnB;AACA,UAAI,CAACD,KAAL,EAAY;AACZ,UAAI,CAAC,6BAAaA,KAAb,CAAL,EAA0B,yBAAaA,KAAK,CAACE,IAAN,EAAb;AAC1BF,MAAAA,KAAK,CAACG,cAAN;AACD;;;2CAEsB;AACrB,UAAMH,KAAK,GAAG,KAAKC,YAAnB;AACA,UAAI,CAACD,KAAL,EAAY;AACZA,MAAAA,KAAK,CAACI,aAAN;AACD;;;6BAuBQ;AACP,UAAMH,YAAY,GAAG,KAAKA,YAA1B;AACA,UAAI,CAACA,YAAL,EAAmB,OAAO,IAAP,CAFZ,CAIP;;AACA,UAAII,OAAJ;;AACA,UAAI,6BAAaJ,YAAb,CAAJ,EAAgC;AAC9BI,QAAAA,OAAO,gBAAG,gCAAC,oBAAD;AAAU,UAAA,KAAK,EAAEJ,YAAY,CAACK,KAA9B;AAAqC,UAAA,SAAS,EAAC;AAA/C,UAAV;AACD,OAFD,MAEO,IAAI,+BAAeL,YAAf,CAAJ,EAAkC;AACvCI,QAAAA,OAAO,gBAAG,gCAAC,oCAAD;AAA0B,UAAA,YAAY,EAAE,CAAxC;AAA2C,UAAA,SAAS,EAAC;AAArD,UAAV;AACD,OAFM,MAEA,IAAI,6BAAaJ,YAAb,CAAJ,EAAgC;AACrCI,QAAAA,OAAO,GAAG,KAAKE,WAAL,EAAV;AACD,OAFM,MAEA;AACLF,QAAAA,OAAO,GAAG,KAAKG,aAAL,EAAV;AACD;;AAED,aAAOH,OAAP;AACD;;;oCAEe;AACd,UAAMJ,YAAY,GAAG,KAAKA,YAA1B;AACA,UAAMQ,YAAY,GAAG,KAAKC,cAA1B;AACA,0BACE;AAAK,QAAA,SAAS,EAAC;AAAf,SACGT,YAAY,CAACU,IAAb,CAAkBC,GAAlB,CAAsB,UAAAC,KAAK;AAAA,4BAC1B,gCAAC,oBAAD;AAAU,UAAA,GAAG,EAAEA,KAAK,CAACC,EAArB;AAAyB,UAAA,KAAK,EAAED,KAAhC;AAAuC,UAAA,YAAY,EAAEJ;AAArD,UAD0B;AAAA,OAA3B,CADH,CADF;AAOD;;;kCAEa;AACZ,UAAMM,UAAU,GAAG,KAAKC,KAAL,CAAWC,QAAX,CAAoBH,EAAvC;AACA,UAAMI,UAAU,GAAGH,UAAU,KAAKI,uBAAWC,QAAX,CAAoBN,EAAtD;AACA,UAAMO,SAAS,GAAGN,UAAU,KAAKI,uBAAWG,YAAX,CAAwBR,EAAzD;AACA,UAAMS,cAAc,GAAG,KAAKA,cAA5B;AAEA,UAAIC,MAAM,GAAG,YAAb;AACA,UAAIC,SAAS,GAAGF,cAAc,gBAC5B,mHACkC,0DADlC,wBAD4B,GAK5B,EALF;;AAQA,UAAIL,UAAJ,EAAgB;AACdM,QAAAA,MAAM,GAAG,uCAAT;AACAC,QAAAA,SAAS,GAAG,6EAAZ;AACD;;AAED,UAAIJ,SAAJ,EAAe;AACbG,QAAAA,MAAM,GAAG,4BAAT;AACAC,QAAAA,SAAS,gBACP,+EACE,uJADF,EAIGF,cAAc,iBACb,6GACiD,0DADjD,wBALJ,EASG,CAACA,cAAD,iBACC,wHAC4D,0DAD5D,gBAVJ,CADF;AAiBD;;AAED,0BACE,gCAAC,wBAAD;AAAS,QAAA,WAAW,MAApB;AAAqB,QAAA,SAAS,EAAC;AAA/B,sBACE,gCAAC,uBAAD;AAAQ,QAAA,IAAI,MAAZ;AAAa,QAAA,SAAS,EAAC;AAAvB,sBACE,gCAAC,qBAAD;AAAM,QAAA,IAAI,EAAC;AAAX,QADF,EAEGC,MAFH,eAGE,gCAAC,uBAAD,CAAQ,SAAR,QAAmBC,SAAnB,CAHF,CADF,CADF;AASD;;;wBAvHkB;AACjB,aAAO,KAAKT,KAAL,CAAWU,gBAAX,CAA4B,KAAKV,KAAL,CAAWC,QAAX,CAAoBH,EAAhD,CAAP;AACD;;;wBAeoB;AACnB,aAAOa,mBAAEC,GAAF,CAAM,KAAKZ,KAAL,CAAWa,SAAjB,EAA4B,kCAA5B,EAAgE,IAAhE,KAAyE,KAAKC,WAArF;AACD;;;wBAEoB;AACnB,UAAMC,GAAG,GAAGJ,mBAAEC,GAAF,CAAM,KAAKZ,KAAL,CAAWa,SAAjB,EAA4B,kCAA5B,EAAgE,IAAhE,CAAZ;;AACA,UAAI,CAACE,GAAL,EAAU,OAAOA,GAAP,CAFS,CAEG;;AACtB,UAAI,CAAC,KAAKC,cAAV,EAA0B,OAAO,KAAKF,WAAZ;AAE1B,aAAOC,GAAP;AACD;;;wBAEoB;AACnB;AACA,aAAOJ,mBAAEC,GAAF,CAAM,KAAKZ,KAAL,CAAWa,SAAjB,EAA4B,qBAA5B,EAAmD,IAAnD,CAAP;AACD;;;wBAEiB;AAChB,aAAOF,mBAAEC,GAAF,CAAM,KAAKZ,KAAL,CAAWa,SAAjB,EAA4B,kBAA5B,EAAgD,IAAhD,CAAP;AACD;;;;EArCsBI,kBAAMC,S;;AA2H/B,oBAASnC,UAAT,EAAqB;AACnBE,EAAAA,YAAY,EAAEkC,cADK;AAEnBZ,EAAAA,cAAc,EAAEY,cAFG;AAGnBzB,EAAAA,cAAc,EAAEyB,cAHG;AAInBL,EAAAA,WAAW,EAAEK,cAJM;AAKnBH,EAAAA,cAAc,EAAEG;AALG,CAArB;;eAQe,uBAAO,kBAAP,EAA2B,WAA3B,EAAwC,yBAASpC,UAAT,CAAxC,C","sourcesContent":["/*\n *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\").\n *  You may not use this file except in compliance with the License.\n *  A copy of the License is located at\n *\n *  http://aws.amazon.com/apache2.0\n *\n *  or in the \"license\" file accompanying this file. This file is distributed\n *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n *  express or implied. See the License for the specific language governing\n *  permissions and limitations under the License.\n */\n\n/* eslint-disable max-classes-per-file */\nimport React from 'react';\nimport _ from 'lodash';\nimport { computed, decorate } from 'mobx';\nimport { observer, inject } from 'mobx-react';\nimport { Header, Icon, Segment } from 'semantic-ui-react';\nimport { swallowError } from '@aws-ee/base-ui/dist/helpers/utils';\nimport { isStoreLoading, isStoreError, isStoreReady, isStoreEmpty } from '@aws-ee/base-ui/dist/models/BaseStore';\nimport BasicProgressPlaceholder from '@aws-ee/base-ui/dist/parts/helpers/BasicProgressPlaceholder';\nimport ErrorBox from '@aws-ee/base-ui/dist/parts/helpers/ErrorBox';\n\nimport StudyRow from './StudyRow';\nimport { categories } from '../../models/studies/categories';\n\n// expected props\n// - category (an object with the shape { name, id})\n// - studiesStoresMap (via injection)\n// - userStore (via injection)\nclass StudiesTab extends React.Component {\n  get studiesStore() {\n    return this.props.studiesStoresMap[this.props.category.id];\n  }\n\n  componentDidMount() {\n    const store = this.studiesStore;\n    if (!store) return;\n    if (!isStoreReady(store)) swallowError(store.load());\n    store.startHeartbeat();\n  }\n\n  componentWillUnmount() {\n    const store = this.studiesStore;\n    if (!store) return;\n    store.stopHeartbeat();\n  }\n\n  get canCreateStudy() {\n    return _.get(this.props.userStore, 'user.capabilities.canCreateStudy', true) && this.hasProjects;\n  }\n\n  get canSelectStudy() {\n    const can = _.get(this.props.userStore, 'user.capabilities.canSelectStudy', true);\n    if (!can) return can; // If can't select study, then return early, no need to examine if the user is internal and does not have projects\n    if (!this.isExternalUser) return this.hasProjects;\n\n    return can;\n  }\n\n  get isExternalUser() {\n    // Both external guests and external researchers are considered external users\n    return _.get(this.props.userStore, 'user.isExternalUser', true);\n  }\n\n  get hasProjects() {\n    return _.get(this.props.userStore, 'user.hasProjects', true);\n  }\n\n  render() {\n    const studiesStore = this.studiesStore;\n    if (!studiesStore) return null;\n\n    // Render loading, error, or tab content\n    let content;\n    if (isStoreError(studiesStore)) {\n      content = <ErrorBox error={studiesStore.error} className=\"mt3 mr0 ml0\" />;\n    } else if (isStoreLoading(studiesStore)) {\n      content = <BasicProgressPlaceholder segmentCount={3} className=\"mt3 mr0 ml0\" />;\n    } else if (isStoreEmpty(studiesStore)) {\n      content = this.renderEmpty();\n    } else {\n      content = this.renderContent();\n    }\n\n    return content;\n  }\n\n  renderContent() {\n    const studiesStore = this.studiesStore;\n    const isSelectable = this.canSelectStudy;\n    return (\n      <div className=\"mt3 mr0 ml0\">\n        {studiesStore.list.map(study => (\n          <StudyRow key={study.id} study={study} isSelectable={isSelectable} />\n        ))}\n      </div>\n    );\n  }\n\n  renderEmpty() {\n    const categoryId = this.props.category.id;\n    const isOpenData = categoryId === categories.openData.id;\n    const isOrgData = categoryId === categories.organization.id;\n    const canCreateStudy = this.canCreateStudy;\n\n    let header = 'No studies';\n    let subheader = canCreateStudy ? (\n      <>\n        To create a study, click on the <b>Create Study</b> button at the top.\n      </>\n    ) : (\n      ''\n    );\n\n    if (isOpenData) {\n      header = 'No studies from the Open Data project';\n      subheader = 'The information in this page is updated once a day, please come back later.';\n    }\n\n    if (isOrgData) {\n      header = 'No studies shared with you';\n      subheader = (\n        <>\n          <div>\n            Studies created at the organization level can be shared but you don&apos;t have any that is shared with you.\n          </div>\n          {canCreateStudy && (\n            <div>\n              You can create one yourself by clicking on the <b>Create Study</b> button at the top.\n            </div>\n          )}\n          {!canCreateStudy && (\n            <div>\n              Consider viewing the Open Data studies by clicking on the <span>Open Data</span> tab above.\n            </div>\n          )}\n        </>\n      );\n    }\n\n    return (\n      <Segment placeholder className=\"mt3\">\n        <Header icon className=\"color-grey\">\n          <Icon name=\"clipboard outline\" />\n          {header}\n          <Header.Subheader>{subheader}</Header.Subheader>\n        </Header>\n      </Segment>\n    );\n  }\n}\n\ndecorate(StudiesTab, {\n  studiesStore: computed,\n  canCreateStudy: computed,\n  canSelectStudy: computed,\n  hasProjects: computed,\n  isExternalUser: computed,\n});\n\nexport default inject('studiesStoresMap', 'userStore')(observer(StudiesTab));\n"],"file":"StudiesTab.js"}