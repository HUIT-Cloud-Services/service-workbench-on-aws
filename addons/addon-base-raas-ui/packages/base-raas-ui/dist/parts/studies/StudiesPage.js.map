{"version":3,"sources":["../../../src/parts/studies/StudiesPage.js"],"names":["TabPaneWrapper","props","children","React","Component","StudiesPage","handleNext","envTypeId","encodeURIComponent","handlePrevious","window","scrollTo","category","studiesStoresMap","id","pathname","goto","canSelectStudy","renderTitle","renderStepsProgress","renderSelection","renderStudyTabs","canCreateStudy","hasProjects","isExternalUser","getMenuItemLabel","store","getStudiesStore","emptySpan","total","applicableCategories","_","filter","categories","studyPanes","map","menuItem","name","render","secondary","pointing","selection","filesSelection","empty","count","renderWarningWithButton","content","renderWarning","header","get","userStore","match","params","observable","computed","action"],"mappings":"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","sourcesContent":["/*\n *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\").\n *  You may not use this file except in compliance with the License.\n *  A copy of the License is located at\n *\n *  http://aws.amazon.com/apache2.0\n *\n *  or in the \"license\" file accompanying this file. This file is distributed\n *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n *  express or implied. See the License for the specific language governing\n *  permissions and limitations under the License.\n */\n\n/* eslint-disable max-classes-per-file */\nimport React from 'react';\nimport _ from 'lodash';\nimport { decorate, action, observable, computed } from 'mobx';\nimport { observer, inject, Observer } from 'mobx-react';\nimport { withRouter } from 'react-router-dom';\nimport { Container, Icon, Button, Label, Header, Tab, Message, Menu } from 'semantic-ui-react';\nimport { niceNumber } from '@aws-ee/base-ui/dist/helpers/utils';\nimport { gotoFn } from '@aws-ee/base-ui/dist/helpers/routing';\n\nimport { isStoreError, isStoreNew, isStoreLoading } from '@aws-ee/base-ui/dist/models/BaseStore';\nimport { categories } from '../../models/studies/categories';\nimport StudiesTab from './StudiesTab';\nimport CreateStudy from './CreateStudy';\nimport StudyStepsProgress from './StudyStepsProgress';\n\n// This component is used with the TabPane to replace the default Segment wrapper since\n// we don't want to display the border.\n// eslint-disable-next-line react/prefer-stateless-function\nclass TabPaneWrapper extends React.Component {\n  render() {\n    return <>{this.props.children}</>;\n  }\n}\n\n// expected props\n// - filesSelection (via injection)\n// - studiesStoresMap (via injection)\n// - userStore (via injection)\nclass StudiesPage extends React.Component {\n  componentDidMount() {\n    window.scrollTo(0, 0);\n  }\n\n  getStudiesStore(category) {\n    return this.props.studiesStoresMap[category.id];\n  }\n\n  goto(pathname) {\n    const goto = gotoFn(this);\n    goto(pathname);\n  }\n\n  get canCreateStudy() {\n    // Note, this does not cover the case if you can create a study but don't have any project linked with you yet.\n    return _.get(this.props.userStore, 'user.capabilities.canCreateStudy', true);\n  }\n\n  get canSelectStudy() {\n    return _.get(this.props.userStore, 'user.capabilities.canSelectStudy', true);\n  }\n\n  get isExternalUser() {\n    // Both external guests and external researchers are considered external users\n    return _.get(this.props.userStore, 'user.isExternalUser', true);\n  }\n\n  get hasProjects() {\n    return _.get(this.props.userStore, 'user.hasProjects', true);\n  }\n\n  handleNext = () => {\n    if (this.envTypeId) {\n      this.goto(`/studies/setup-workspace/type/${encodeURIComponent(this.envTypeId)}`);\n    } else {\n      this.goto('/studies/setup-workspace');\n    }\n  };\n\n  render() {\n    const canSelectStudy = this.canSelectStudy;\n\n    return (\n      <Container className=\"mt3\">\n        {this.renderTitle()}\n        {canSelectStudy && this.renderStepsProgress()}\n        {this.renderSelection()}\n        {this.renderStudyTabs()}\n      </Container>\n    );\n  }\n\n  renderTitle() {\n    const canCreateStudy = this.canCreateStudy;\n    const hasProjects = this.hasProjects;\n    return (\n      <div className=\"flex\">\n        <Header as=\"h3\" className=\"color-grey mt1 mb0 flex-auto\">\n          <Icon name=\"book\" className=\"align-top\" />\n          <Header.Content className=\"left-align\">Studies</Header.Content>\n        </Header>\n        {canCreateStudy && hasProjects && <CreateStudy />}\n      </div>\n    );\n  }\n\n  renderStepsProgress() {\n    return <StudyStepsProgress envTypeImmutable={!!this.envTypeId} />;\n  }\n\n  renderStudyTabs() {\n    const isExternalUser = this.isExternalUser;\n    const getMenuItemLabel = category => {\n      const store = this.getStudiesStore(category);\n      const emptySpan = null;\n      if (!store) return emptySpan;\n      if (isStoreError(store)) return emptySpan;\n      if (isStoreNew(store)) return emptySpan;\n      if (isStoreLoading(store)) return emptySpan;\n      return <Label>{niceNumber(store.total)}</Label>;\n    };\n\n    // Create tab panes for each study category. If the user is not external user, then myStudies pane should not be shown\n    const applicableCategories = _.filter(categories, category => {\n      if (category.id === 'my-studies' && isExternalUser) return false;\n      return true;\n    });\n\n    const studyPanes = _.map(applicableCategories, category => ({\n      menuItem: (\n        <Menu.Item key={category.id}>\n          {category.name} {getMenuItemLabel(category)}\n        </Menu.Item>\n      ),\n      render: () => (\n        <Tab.Pane attached={false} key={category.id} as={TabPaneWrapper}>\n          <Observer>{() => <StudiesTab category={category} />}</Observer>\n        </Tab.Pane>\n      ),\n    }));\n\n    return <Tab className=\"mt3\" menu={{ secondary: true, pointing: true }} renderActiveOnly panes={studyPanes} />;\n  }\n\n  renderSelection() {\n    const selection = this.props.filesSelection;\n    const empty = selection.empty;\n    const count = selection.count;\n    const canCreateStudy = this.canCreateStudy;\n    const canSelectStudy = this.canSelectStudy;\n    const hasProjects = this.hasProjects;\n\n    if (empty && canCreateStudy && canSelectStudy && hasProjects) {\n      return this.renderWarningWithButton({\n        content: (\n          <>\n            Select one or more studies to proceed to the next step or create a study by clicking on <b>Create Study</b>{' '}\n            button at the top.\n          </>\n        ),\n      });\n    }\n\n    if (empty && canCreateStudy && canSelectStudy && !hasProjects) {\n      return this.renderWarning({\n        header: 'Missing association with one or more projects!',\n        content:\n          \"You won't be able to select or create studies because you currently don't have any association with one or more projects, please contact your administrator.\",\n      });\n    }\n\n    if (empty && canSelectStudy && !canCreateStudy) {\n      return this.renderWarningWithButton({\n        content: 'Select one or more studies to proceed to the next step.',\n      });\n    }\n\n    if (empty) {\n      return this.renderWarning({\n        header: 'Limited access',\n        content:\n          'You currently have limited access and will not be able to select studies to proceed to the next step.',\n      });\n    }\n\n    return (\n      <Message visible className=\"clearfix\" info>\n        <Button icon labelPosition=\"right\" className=\"ml2\" floated=\"right\" onClick={this.handleNext} color=\"blue\">\n          Next\n          <Icon name=\"right arrow\" />\n        </Button>\n        {// If envTypeId is present then it means we landed on this page after\n        // env type selection from workspace-type-management page.\n        // Show previous button in this case to allow to go back to workspace-type-management screen\n        this.envTypeId && (\n          <Button\n            floated=\"right\"\n            icon=\"left arrow\"\n            labelPosition=\"left\"\n            className=\"ml2\"\n            content=\"Previous\"\n            onClick={this.handlePrevious}\n          />\n        )}\n        <div className=\"mt1\">\n          <span>\n            Selected studies\n            <Label circular color=\"blue\" className=\"ml1\">\n              {niceNumber(count)}\n            </Label>{' '}\n          </span>\n        </div>\n      </Message>\n    );\n  }\n\n  renderWarning({ header, content }) {\n    return (\n      <Message icon warning className=\"mt2\">\n        <Icon name=\"warning\" />\n        <Message.Content>\n          <Message.Header>{header}</Message.Header>\n          <p>{content}</p>\n        </Message.Content>\n      </Message>\n    );\n  }\n\n  renderWarningWithButton({ content }) {\n    return (\n      <Message visible className=\"clearfix\" warning>\n        <Button icon labelPosition=\"right\" className=\"ml2\" floated=\"right\" disabled>\n          Next\n          <Icon name=\"right arrow\" />\n        </Button>\n        {// If envTypeId is present then it means we landed on this page after\n        // env type selection from workspace-type-management page.\n        // Show previous button in this case to allow to go back to workspace-type-management screen\n        this.envTypeId && (\n          <Button\n            floated=\"right\"\n            icon=\"left arrow\"\n            labelPosition=\"left\"\n            className=\"ml2\"\n            content=\"Previous\"\n            onClick={this.handlePrevious}\n          />\n        )}\n        <div className=\"mt1\">{content}</div>\n      </Message>\n    );\n  }\n\n  handlePrevious = () => {\n    this.goto('/workspace-types-management');\n  };\n\n  get envTypeId() {\n    return (this.props.match.params || {}).envTypeId;\n  }\n}\n\ndecorate(StudiesPage, {\n  getStudiesStore: observable,\n  canCreateStudy: computed,\n  canSelectStudy: computed,\n  hasProjects: computed,\n  isExternalUser: computed,\n  handleNext: action,\n});\n\nexport default inject('filesSelection', 'studiesStoresMap', 'userStore')(withRouter(observer(StudiesPage)));\n"],"file":"StudiesPage.js"}