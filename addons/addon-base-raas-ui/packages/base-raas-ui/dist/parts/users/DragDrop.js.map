{"version":3,"sources":["../../../src/parts/users/DragDrop.js"],"names":["DragDrop","props","onDrop","files","reader","FileReader","onabort","console","log","onerror","onload","binaryStr","result","jsonArray","csvJSON","setState","jsonArrayContent","fileContent","forEach","file","readAsText","handleSubmit","formProcessing","addAuthProviderId","state","userArr","usersStore","addUsers","load","handleCancel","event","preventDefault","stopPropagation","validationErrors","Map","user","stores","Stores","authenticationProviderConfigsStore","userRolesStore","userStore","csv","lines","split","headers","i","length","obj","currentline","j","push","pathname","location","link","history","processing","promises","map","provider","getAuthenticationProviderConfigByIdpName","identityProviderName","authenticationProviderId","_","get","Promise","all","content","hasError","error","loading","ready","renderMain","name","size","maxSize","getRootProps","getInputProps","rejectedFiles","isFileTooLarge","renderTable","renderButtons","Component","computed","observable"],"mappings":"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","sourcesContent":["/*\n *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\").\n *  You may not use this file except in compliance with the License.\n *  A copy of the License is located at\n *\n *  http://aws.amazon.com/apache2.0\n *\n *  or in the \"license\" file accompanying this file. This file is distributed\n *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n *  express or implied. See the License for the specific language governing\n *  permissions and limitations under the License.\n */\n\nimport _ from 'lodash';\nimport React, { Component } from 'react';\nimport Dropzone from 'react-dropzone';\nimport { withRouter } from 'react-router-dom';\nimport { inject, observer } from 'mobx-react';\nimport { Segment, Icon, Header, Button, Message, Container } from 'semantic-ui-react';\nimport { computed, decorate, observable, action, runInAction } from 'mobx';\nimport { displayError } from '@aws-ee/base-ui/dist/helpers/notification';\nimport { createLink } from '@aws-ee/base-ui/dist/helpers/routing';\n\nimport { swallowError } from '@aws-ee/base-ui/dist/helpers/utils';\nimport ErrorBox from '@aws-ee/base-ui/dist/parts/helpers/ErrorBox';\nimport BasicProgressPlaceholder from '@aws-ee/base-ui/dist/parts/helpers/BasicProgressPlaceholder';\nimport Stores from '@aws-ee/base-ui/dist/models/Stores';\nimport UserTable from './UserTable';\n\nclass DragDrop extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      files: [],\n      fileContent: '',\n      jsonArrayContent: [],\n    };\n    runInAction(() => {\n      this.formProcessing = false;\n      this.validationErrors = new Map();\n      this.user = {};\n\n      this.stores = new Stores([\n        this.authenticationProviderConfigsStore,\n        this.userRolesStore,\n        this.usersStore,\n        this.userStore,\n      ]);\n    });\n  }\n\n  get userRolesStore() {\n    return this.props.userRolesStore;\n  }\n\n  get usersStore() {\n    return this.props.usersStore;\n  }\n\n  get userStore() {\n    return this.props.userStore;\n  }\n\n  get authenticationProviderConfigsStore() {\n    return this.props.authenticationProviderConfigsStore;\n  }\n\n  componentDidMount() {\n    swallowError(this.stores.load());\n  }\n\n  csvJSON(csv) {\n    const result = [];\n    const lines = csv.split(/\\r?\\n/);\n    const headers = lines[0].split(',');\n\n    for (let i = 1; i < lines.length; i++) {\n      const obj = {};\n      const currentline = lines[i].split(',');\n      for (let j = 0; j < headers.length; j++) {\n        obj[headers[j]] = currentline[j];\n      }\n      result.push(obj);\n    }\n\n    return result;\n  }\n\n  onDrop = files => {\n    const reader = new FileReader();\n    reader.onabort = () => console.log('file reading was aborted');\n    reader.onerror = () => console.log('file reading has failed');\n    reader.onload = () => {\n      const binaryStr = reader.result;\n      const jsonArray = this.csvJSON(binaryStr);\n      this.setState({ jsonArrayContent: jsonArray });\n      this.setState({ fileContent: binaryStr });\n    };\n    files.forEach(file => reader.readAsText(file));\n    this.setState({ files });\n  };\n\n  goto(pathname) {\n    const location = this.props.location;\n    const link = createLink({ location, pathname });\n    this.props.history.push(link);\n  }\n\n  renderButtons() {\n    const processing = this.formProcessing;\n    return (\n      <div className=\"mt3\">\n        <Button floated=\"right\" color=\"blue\" icon disabled={processing} className=\"ml2\" onClick={this.handleSubmit}>\n          Submit\n        </Button>\n        <Button floated=\"right\" disabled={processing} onClick={this.handleCancel}>\n          Cancel\n        </Button>\n      </div>\n    );\n  }\n\n  async addAuthProviderId(userArr) {\n    const promises = userArr.map(async user => {\n      const provider = this.authenticationProviderConfigsStore.getAuthenticationProviderConfigByIdpName(\n        user.identityProviderName,\n      );\n      const authenticationProviderId = _.get(provider, 'id');\n      user.authenticationProviderId = authenticationProviderId;\n      return user;\n    });\n    userArr = await Promise.all(promises);\n    return userArr;\n  }\n\n  handleSubmit = action(async () => {\n    this.formProcessing = true;\n    try {\n      // compose the content to users and invoke add user\n      const userArr = await this.addAuthProviderId(this.state.jsonArrayContent);\n      await this.usersStore.addUsers(userArr);\n      runInAction(() => {\n        this.formProcessing = false;\n      });\n      await this.usersStore.load();\n      this.goto('/users');\n    } catch (error) {\n      runInAction(() => {\n        this.formProcessing = false;\n      });\n      displayError(error);\n    }\n  });\n\n  handleCancel = action(event => {\n    event.preventDefault();\n    event.stopPropagation();\n    this.formProcessing = false;\n    this.goto('/users');\n  });\n\n  renderTable() {\n    let content;\n    if (this.state.fileContent) {\n      content = <UserTable userData={this.state.jsonArrayContent} />;\n    } else {\n      content = '';\n    }\n    return content;\n  }\n\n  render() {\n    const stores = this.stores;\n    let content = null;\n    if (stores.hasError) {\n      content = <ErrorBox error={stores.error} className=\"p0 mb3\" />;\n    } else if (stores.loading) {\n      content = <BasicProgressPlaceholder />;\n    } else if (stores.ready) {\n      content = this.renderMain();\n    } else {\n      content = null;\n    }\n    return content;\n  }\n\n  renderMain() {\n    const files = this.state.files.map(file => (\n      <li key={file.name}>\n        {file.name} - {file.size} bytes\n      </li>\n    ));\n    const maxSize = 512000;\n    return (\n      <div>\n        <Container text>\n          <Message info>\n            <Message.Content>\n              <Message.Header>CSV Example</Message.Header>\n              <p>email,userRole,identityProviderName</p>\n              <p>user1@datalake.amazonaws.com,researcher,DataLake</p>\n              <p>user2@organization.onmicrosoft.com,researcher,AzureAD</p>\n            </Message.Content>\n          </Message>\n        </Container>\n\n        <Segment className=\"mt4 center\">\n          <Header as=\"h4\" color=\"grey\">\n            Drag and drop files here\n          </Header>\n          <Dropzone onDrop={this.onDrop} minSize={0} maxSize={maxSize} multiple>\n            {({ getRootProps, getInputProps, rejectedFiles }) => {\n              const isFileTooLarge = rejectedFiles.length > 0 && rejectedFiles[0].size > maxSize;\n              return (\n                <div {...getRootProps()}>\n                  <input {...getInputProps()} />\n                  {<Icon name=\"cloud upload\" size=\"massive\" color=\"grey\" />}\n                  {isFileTooLarge && <div className=\"text-danger mt-2\">File is too large.</div>}\n                </div>\n              );\n            }}\n          </Dropzone>\n        </Segment>\n        <aside>\n          <h4>Files</h4>\n          <ul>{files}</ul>\n        </aside>\n        {this.renderTable()}\n        {this.renderButtons()}\n      </div>\n    );\n  }\n}\ndecorate(DragDrop, {\n  authenticationProviderConfigsStore: computed,\n  userRolesStore: computed,\n  usersStore: computed,\n  userStore: computed,\n  formProcessing: observable,\n});\n\nexport default inject(\n  'userStore',\n  'usersStore',\n  'userRolesStore',\n  'authenticationProviderConfigsStore',\n)(withRouter(observer(DragDrop)));\n"],"file":"DragDrop.js"}