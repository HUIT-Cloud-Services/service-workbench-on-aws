{"version":3,"sources":["../../../../src/parts/users/__tests__/AddSingleLocalUser.test.js"],"names":["jest","mock","displayErrorMock","require","gotoMock","projectsStore","userRolesStore","isInternalUser","fn","val","isInternalGuest","usersStore","addUser","describe","component","wrapper","beforeEach","instance","displayError","x","displaySuccess","gotoFn","it","ret","userRole","error","message","form","values","clear","handleFormSubmission","expect","toHaveBeenCalledWith","projectId","not","toHaveBeenCalled","objectContaining","check"],"mappings":";;AAeA;;AACA;;AACA;;;;;;;;AAEAA,IAAI,CAACC,IAAL,CAAU,2CAAV;;AACA,IAAMC,gBAAgB,GAAGC,OAAO,CAAC,2CAAD,CAAhC;;AAEAH,IAAI,CAACC,IAAL,CAAU,sCAAV;;AACA,IAAMG,QAAQ,GAAGD,OAAO,CAAC,sCAAD,CAAxB;;AAEA,IAAME,aAAa,GAAG,EAAtB;AACA,IAAMC,cAAc,GAAG;AACrBC,EAAAA,cAAc,EAAEP,IAAI,CAACQ,EAAL,CAAQ,UAAAC,GAAG;AAAA,WAAIA,GAAG,KAAK,cAAZ;AAAA,GAAX,CADK;AAErBC,EAAAA,eAAe,EAAEV,IAAI,CAACQ,EAAL,CAAQ,UAAAC,GAAG;AAAA,WAAIA,GAAG,KAAK,eAAZ;AAAA,GAAX;AAFI,CAAvB;AAIA,IAAME,UAAU,GAAG;AACjBC,EAAAA,OAAO,EAAEZ,IAAI,CAACQ,EAAL;AADQ,CAAnB;AAIAK,QAAQ,CAAC,oBAAD,EAAuB,YAAM;AACnC,MAAIC,SAAS,GAAG,IAAhB;AACA,MAAIC,OAAO,GAAG,IAAd;AACAC,EAAAA,UAAU,CAAC,YAAM;AACf;AACAD,IAAAA,OAAO,GAAG,mCACR,gCAAC,8BAAD,CAAoB,gBAApB;AACE,MAAA,aAAa,EAAEV,aADjB;AAEE,MAAA,cAAc,EAAEC,cAFlB;AAGE,MAAA,UAAU,EAAEK;AAHd,MADQ,CAAV,CAFe,CAUf;;AACAG,IAAAA,SAAS,GAAGC,OAAO,CAACE,QAAR,EAAZ,CAXe,CAaf;;AACAf,IAAAA,gBAAgB,CAACgB,YAAjB,GAAgClB,IAAI,CAACQ,EAAL,CAAQ,UAAAW,CAAC;AAAA,aAAIA,CAAJ;AAAA,KAAT,CAAhC;AACAjB,IAAAA,gBAAgB,CAACkB,cAAjB,GAAkCpB,IAAI,CAACQ,EAAL,CAAQ,UAAAW,CAAC;AAAA,aAAIA,CAAJ;AAAA,KAAT,CAAlC,CAfe,CAiBf;;AACAf,IAAAA,QAAQ,CAACiB,MAAT,GAAkBrB,IAAI,CAACQ,EAAL,CAAQ;AAAA,aAAMR,IAAI,CAACQ,EAAL,EAAN;AAAA,KAAR,CAAlB;AACD,GAnBS,CAAV;AAqBAc,EAAAA,EAAE,CAAC,uBAAD,uEAA0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAC1B;AACMC,YAAAA,GAFoB,GAEd;AACVC,cAAAA,QAAQ,EAAE;AADA,aAFc;AAKpBC,YAAAA,KALoB,GAKZ;AAAEC,cAAAA,OAAO,EAAE;AAAX,aALY;AAMpBC,YAAAA,IANoB,GAMb;AACXC,cAAAA,MAAM,EAAE5B,IAAI,CAACQ,EAAL,CAAQ,YAAM;AACpB,uBAAOe,GAAP;AACD,eAFO,CADG;AAIXM,cAAAA,KAAK,EAAE7B,IAAI,CAACQ,EAAL,CAAQ,YAAM;AACnB,sBAAMiB,KAAN;AACD,eAFM;AAJI,aANa,EAe1B;;AAf0B;AAAA,mBAgBpBX,SAAS,CAACgB,oBAAV,CAA+BH,IAA/B,CAhBoB;;AAAA;AAkB1B;AACAI,YAAAA,MAAM,CAAC7B,gBAAgB,CAACgB,YAAlB,CAAN,CAAsCc,oBAAtC,CAA2DP,KAA3D;;AAnB0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAA1B,GAAF;AAsBAH,EAAAA,EAAE,CAAC,gDAAD,uEAAmD;AAAA;AAAA;AAAA;AAAA;AAAA;AAC7CC,YAAAA,GAD6C,GACvC;AACVC,cAAAA,QAAQ,EAAE,cADA;AAEVS,cAAAA,SAAS,EAAE,CAAC,UAAD;AAFD,aADuC;AAM7CN,YAAAA,IAN6C,GAMtC;AACXC,cAAAA,MAAM,EAAE5B,IAAI,CAACQ,EAAL,CAAQ,YAAM;AACpB,uBAAOe,GAAP;AACD,eAFO,CADG;AAIXM,cAAAA,KAAK,EAAE7B,IAAI,CAACQ,EAAL;AAJI,aANsC,EAanD;;AAbmD;AAAA,mBAc7CM,SAAS,CAACgB,oBAAV,CAA+BH,IAA/B,CAd6C;;AAAA;AAgBnD;AACAI,YAAAA,MAAM,CAAC7B,gBAAgB,CAACkB,cAAlB,CAAN,CAAwCY,oBAAxC,CAA6D,+BAA7D;AACAD,YAAAA,MAAM,CAAC7B,gBAAgB,CAACgB,YAAlB,CAAN,CAAsCgB,GAAtC,CAA0CC,gBAA1C;AACAJ,YAAAA,MAAM,CAACpB,UAAU,CAACC,OAAZ,CAAN,CAA2BoB,oBAA3B,CACED,MAAM,CAACK,gBAAP,CAAwB;AACtBH,cAAAA,SAAS,EAAEV,GAAG,CAACU;AADO,aAAxB,CADF;;AAnBmD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAnD,GAAF;AA0BAX,EAAAA,EAAE,CAAC,sDAAD,uEAAyD;AAAA;AAAA;AAAA;AAAA;AAAA;AACnDC,YAAAA,GADmD,GAC7C;AACVC,cAAAA,QAAQ,EAAE,eADA;AAEVS,cAAAA,SAAS,EAAE,CAAC,UAAD;AAFD,aAD6C;AAMnDI,YAAAA,KANmD,GAM3C;AACZb,cAAAA,QAAQ,EAAED,GAAG,CAACC,QADF;AAEZS,cAAAA,SAAS,EAAE;AAFC,aAN2C;AAWnDN,YAAAA,IAXmD,GAW5C;AACXC,cAAAA,MAAM,EAAE5B,IAAI,CAACQ,EAAL,CAAQ,YAAM;AACpB,uBAAOe,GAAP;AACD,eAFO,CADG;AAIXM,cAAAA,KAAK,EAAE7B,IAAI,CAACQ,EAAL;AAJI,aAX4C,EAkBzD;;AAlByD;AAAA,mBAmBnDM,SAAS,CAACgB,oBAAV,CAA+BH,IAA/B,CAnBmD;;AAAA;AAqBzD;AACAI,YAAAA,MAAM,CAAC7B,gBAAgB,CAACkB,cAAlB,CAAN,CAAwCY,oBAAxC,CAA6D,+BAA7D;AACAD,YAAAA,MAAM,CAAC7B,gBAAgB,CAACgB,YAAlB,CAAN,CAAsCgB,GAAtC,CAA0CC,gBAA1C;AACAJ,YAAAA,MAAM,CAACpB,UAAU,CAACC,OAAZ,CAAN,CAA2BoB,oBAA3B,CAAgDK,KAAhD;;AAxByD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAzD,GAAF;AA0BD,CAlGO,CAAR","sourcesContent":["/*\n *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\").\n *  You may not use this file except in compliance with the License.\n *  A copy of the License is located at\n *\n *  http://aws.amazon.com/apache2.0\n *\n *  or in the \"license\" file accompanying this file. This file is distributed\n *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n *  express or implied. See the License for the specific language governing\n *  permissions and limitations under the License.\n */\n\nimport React from 'react';\nimport { shallow } from 'enzyme';\nimport AddSingleLocalUser from '../AddSingleLocalUser';\n\njest.mock('@aws-ee/base-ui/dist/helpers/notification');\nconst displayErrorMock = require('@aws-ee/base-ui/dist/helpers/notification');\n\njest.mock('@aws-ee/base-ui/dist/helpers/routing');\nconst gotoMock = require('@aws-ee/base-ui/dist/helpers/routing');\n\nconst projectsStore = {};\nconst userRolesStore = {\n  isInternalUser: jest.fn(val => val === 'internalUser'),\n  isInternalGuest: jest.fn(val => val === 'internalGuest'),\n};\nconst usersStore = {\n  addUser: jest.fn(),\n};\n\ndescribe('AddSingleLocalUser', () => {\n  let component = null;\n  let wrapper = null;\n  beforeEach(() => {\n    // Render component\n    wrapper = shallow(\n      <AddSingleLocalUser.WrappedComponent\n        projectsStore={projectsStore}\n        userRolesStore={userRolesStore}\n        usersStore={usersStore}\n      />,\n    );\n\n    // Get instance of the component\n    component = wrapper.instance();\n\n    // Mock display functions because they don't function correctly in enzyme\n    displayErrorMock.displayError = jest.fn(x => x);\n    displayErrorMock.displaySuccess = jest.fn(x => x);\n\n    // Mock goto function\n    gotoMock.gotoFn = jest.fn(() => jest.fn());\n  });\n\n  it('should throw an error', async () => {\n    // BUILD\n    const ret = {\n      userRole: 'internalUser',\n    };\n    const error = { message: 'adding failed' };\n    const form = {\n      values: jest.fn(() => {\n        return ret;\n      }),\n      clear: jest.fn(() => {\n        throw error;\n      }),\n    };\n\n    // OPERATE\n    await component.handleFormSubmission(form);\n\n    // CHECK\n    expect(displayErrorMock.displayError).toHaveBeenCalledWith(error);\n  });\n\n  it('should create an internal user with projectIds', async () => {\n    const ret = {\n      userRole: 'internalUser',\n      projectId: ['potatoes'],\n    };\n\n    const form = {\n      values: jest.fn(() => {\n        return ret;\n      }),\n      clear: jest.fn(),\n    };\n\n    // OPERATE\n    await component.handleFormSubmission(form);\n\n    // CHECK\n    expect(displayErrorMock.displaySuccess).toHaveBeenCalledWith('Added local user successfully');\n    expect(displayErrorMock.displayError).not.toHaveBeenCalled();\n    expect(usersStore.addUser).toHaveBeenCalledWith(\n      expect.objectContaining({\n        projectId: ret.projectId,\n      }),\n    );\n  });\n\n  it('should create a non-internal user without projectIds', async () => {\n    const ret = {\n      userRole: 'internalGuest',\n      projectId: ['potatoes'],\n    };\n\n    const check = {\n      userRole: ret.userRole,\n      projectId: [],\n    };\n\n    const form = {\n      values: jest.fn(() => {\n        return ret;\n      }),\n      clear: jest.fn(),\n    };\n\n    // OPERATE\n    await component.handleFormSubmission(form);\n\n    // CHECK\n    expect(displayErrorMock.displaySuccess).toHaveBeenCalledWith('Added local user successfully');\n    expect(displayErrorMock.displayError).not.toHaveBeenCalled();\n    expect(usersStore.addUser).toHaveBeenCalledWith(check);\n  });\n});\n"],"file":"AddSingleLocalUser.test.js"}