{"version":3,"sources":["../../../src/parts/accounts/AddAwsAccount.js"],"names":["AddAwsAccount","props","handleRoleChange","e","value","setState","role","handleStatusChange","status","handleCancel","event","preventDefault","stopPropagation","formProcessing","handleSubmit","awsAccount","addAwsAccountFormFields","validationResult","fails","validationErrors","errors","awsAccountsStore","addAwsAccount","state","Map","form","renderAddAwsAccountForm","processing","fields","toEditableInput","attributeName","type","handleChange","target","placeholder","Object","keys","map","field","renderField","renderButtons","name","component","explain","label","hasExplain","_","isEmpty","fieldErrors","get","hasError","fieldError","pathname","location","link","history","push","usersStore","React","Component","observable","user"],"mappings":"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","sourcesContent":["/*\n *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\").\n *  You may not use this file except in compliance with the License.\n *  A copy of the License is located at\n *\n *  http://aws.amazon.com/apache2.0\n *\n *  or in the \"license\" file accompanying this file. This file is distributed\n *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n *  express or implied. See the License for the specific language governing\n *  permissions and limitations under the License.\n */\n\nimport React from 'react';\nimport { inject, observer } from 'mobx-react';\nimport { withRouter } from 'react-router-dom';\nimport { decorate, observable, action, runInAction } from 'mobx';\nimport { Button, Dimmer, Header, List, Loader, Segment } from 'semantic-ui-react';\nimport _ from 'lodash';\n\nimport { displayError } from '@aws-ee/base-ui/dist/helpers/notification';\nimport { createLink } from '@aws-ee/base-ui/dist/helpers/routing';\nimport validate from '@aws-ee/base-ui/dist/models/forms/Validate';\n\nimport { getAddAwsAccountForm, getAddAwsAccountFormFields } from '../../models/forms/AddAwsAccountForm';\n\nclass AddAwsAccount extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      // eslint-disable-next-line react/no-unused-state\n      role: 'guest',\n      // eslint-disable-next-line react/no-unused-state\n      status: 'active',\n    };\n\n    runInAction(() => {\n      this.formProcessing = false;\n      this.validationErrors = new Map();\n      this.awsAccount = {};\n    });\n    this.form = getAddAwsAccountForm();\n    this.addAwsAccountFormFields = getAddAwsAccountFormFields();\n  }\n\n  render() {\n    return (\n      <div className=\"mt2 animated fadeIn\">\n        <Header as=\"h2\" icon textAlign=\"center\" className=\"mt3\" color=\"grey\">\n          Add AWS Account\n        </Header>\n        <div className=\"mt3 ml3 mr3 animated fadeIn\">{this.renderAddAwsAccountForm()}</div>\n      </div>\n    );\n  }\n\n  // eslint-disable-next-line react/no-unused-state\n  handleRoleChange = (e, { value }) => this.setState({ role: value });\n\n  // eslint-disable-next-line react/no-unused-state\n  handleStatusChange = (e, { value }) => this.setState({ status: value });\n\n  renderAddAwsAccountForm() {\n    const processing = this.formProcessing;\n    const fields = this.addAwsAccountFormFields;\n    const toEditableInput = (attributeName, type = 'text') => {\n      const handleChange = action(event => {\n        event.preventDefault();\n        this.awsAccount[attributeName] = event.target.value;\n      });\n      return (\n        <div className=\"ui focus input\">\n          <input\n            type={type}\n            defaultValue={this.awsAccount[attributeName]}\n            placeholder={fields[attributeName].placeholder || ''}\n            onChange={handleChange}\n          />\n        </div>\n      );\n    };\n\n    return (\n      <Segment basic className=\"ui fluid form\">\n        <Dimmer active={processing} inverted>\n          <Loader inverted>Checking</Loader>\n        </Dimmer>\n        {Object.keys(fields).map(field => (\n          <React.Fragment key={field}>\n            {this.renderField(field, toEditableInput(field))}\n            <div className=\"mb4\" />\n          </React.Fragment>\n        ))}\n        {this.renderButtons()}\n      </Segment>\n    );\n  }\n\n  renderButtons() {\n    const processing = this.formProcessing;\n    return (\n      <div className=\"mt3\">\n        <Button floated=\"right\" color=\"blue\" icon disabled={processing} className=\"ml2\" onClick={this.handleSubmit}>\n          Add AWS Account\n        </Button>\n        <Button floated=\"right\" disabled={processing} onClick={this.handleCancel}>\n          Cancel\n        </Button>\n      </div>\n    );\n  }\n\n  renderField(name, component) {\n    const fields = this.addAwsAccountFormFields;\n    const explain = fields[name].explain;\n    const label = fields[name].label;\n    const hasExplain = !_.isEmpty(explain);\n    const fieldErrors = this.validationErrors.get(name);\n    const hasError = !_.isEmpty(fieldErrors);\n\n    return (\n      <div>\n        <Header className=\"mr3 mt0\" as=\"h2\" color=\"grey\">\n          {label}\n        </Header>\n        {hasExplain && <div className=\"mb2\">{explain}</div>}\n        <div className={`ui big field input block m0 ${hasError ? 'error' : ''}`}>{component}</div>\n        {hasError && (\n          <div className=\"ui pointing red basic label\">\n            <List>\n              {_.map(fieldErrors, fieldError => (\n                <List.Item key={name}>\n                  <List.Content>{fieldError}</List.Content>\n                </List.Item>\n              ))}\n            </List>\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  goto(pathname) {\n    const location = this.props.location;\n    const link = createLink({ location, pathname });\n    this.props.history.push(link);\n  }\n\n  handleCancel = action(event => {\n    event.preventDefault();\n    event.stopPropagation();\n    this.formProcessing = false;\n    this.goto('/accounts');\n  });\n\n  handleSubmit = action(async () => {\n    this.formProcessing = true;\n    try {\n      // Perform client side validations first\n      const validationResult = await validate(this.awsAccount, this.addAwsAccountFormFields);\n      // if there are any client side validation errors then do not attempt to make API call\n      if (validationResult.fails()) {\n        runInAction(() => {\n          this.validationErrors = validationResult.errors;\n          this.formProcessing = false;\n        });\n      } else {\n        // There are no client side validation errors so ask the store to add user (which will make API call to server to add the user)\n\n        await this.props.awsAccountsStore.addAwsAccount(this.awsAccount);\n        runInAction(() => {\n          this.formProcessing = false;\n        });\n        this.goto('/accounts');\n      }\n    } catch (error) {\n      runInAction(() => {\n        this.formProcessing = false;\n      });\n      displayError(error);\n    }\n  });\n\n  getStore() {\n    return this.props.usersStore;\n  }\n}\n\n// see https://medium.com/@mweststrate/mobx-4-better-simpler-faster-smaller-c1fbc08008da\ndecorate(AddAwsAccount, {\n  formProcessing: observable,\n  user: observable,\n  validationErrors: observable,\n});\nexport default inject('usersStore', 'awsAccountsStore')(withRouter(observer(AddAwsAccount)));\n"],"file":"AddAwsAccount.js"}