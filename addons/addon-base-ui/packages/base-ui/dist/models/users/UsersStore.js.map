{"version":3,"sources":["../../../src/models/users/UsersStore.js"],"names":["UsersStore","BaseStore","named","props","users","types","optional","map","User","actions","self","superCleanup","cleanup","doLoad","runInAction","forEach","user","uid","replace","clear","addUser","addedUser","addedUserModel","create","set","id","updateUser","updatedUser","userModel","previousUser","get","views","empty","size","hasNonRootAdmins","nonRootAdmins","_","filter","list","isAdmin","isRootUser","isEmpty","hasNonRootUsers","nonRootUsers","result","push","asSelectOptions","nonClearables","value","label","longDisplayName","clearableValue","includes","asDropDownOptions","status","key","text","asUserObject","userIdentifier","username","ns","undefined","asUserObjects","userIdentifiers","toUserIds","userObjects","toLongNames","toLongName","object","registerContextItems","appContext","usersStore"],"mappings":"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","sourcesContent":["/*\n *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\").\n *  You may not use this file except in compliance with the License.\n *  A copy of the License is located at\n *\n *  http://aws.amazon.com/apache2.0\n *\n *  or in the \"license\" file accompanying this file. This file is distributed\n *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n *  express or implied. See the License for the specific language governing\n *  permissions and limitations under the License.\n */\n\nimport _ from 'lodash';\nimport { applySnapshot, getSnapshot, types } from 'mobx-state-tree';\n\nimport { addUser, getUsers, updateUser } from '../../helpers/api';\nimport { User } from './User';\nimport { BaseStore } from '../BaseStore';\n\nconst UsersStore = BaseStore.named('UsersStore')\n  .props({\n    users: types.optional(types.map(User), {}),\n  })\n\n  .actions(self => {\n    // save the base implementation of cleanup\n    const superCleanup = self.cleanup;\n\n    return {\n      async doLoad() {\n        const users = (await getUsers()) || [];\n        self.runInAction(() => {\n          const map = {};\n          users.forEach(user => {\n            const uid = user.uid;\n            map[uid] = user;\n          });\n          self.users.replace(map);\n        });\n      },\n\n      cleanup: () => {\n        self.users.clear();\n        superCleanup();\n      },\n      addUser: async user => {\n        const addedUser = await addUser(user);\n        self.runInAction(() => {\n          // Added newly created user to users map\n          const addedUserModel = User.create(addedUser);\n          self.users.set(addedUserModel.id, addedUserModel);\n        });\n      },\n      updateUser: async user => {\n        const updatedUser = await updateUser(user);\n        const userModel = User.create(updatedUser);\n        const previousUser = self.users.get(userModel.id);\n        applySnapshot(previousUser, updatedUser);\n      },\n    };\n  })\n\n  .views(self => ({\n    get empty() {\n      return self.users.size === 0;\n    },\n\n    get hasNonRootAdmins() {\n      const nonRootAdmins = _.filter(self.list, user => user.isAdmin && !user.isRootUser);\n      return !_.isEmpty(nonRootAdmins);\n    },\n\n    get hasNonRootUsers() {\n      return !_.isEmpty(self.nonRootUsers);\n    },\n\n    get nonRootUsers() {\n      return _.filter(self.list, user => !user.isRootUser);\n    },\n\n    get list() {\n      const result = [];\n      // converting map self.users to result array\n      self.users.forEach(user => result.push(user));\n      return result;\n    },\n\n    asSelectOptions({ nonClearables = [] } = {}) {\n      const result = [];\n      self.users.forEach(user =>\n        result.push({\n          value: user.id,\n          label: user.longDisplayName,\n          clearableValue: !nonClearables.includes(user.id),\n        }),\n      );\n      return result;\n    },\n\n    asDropDownOptions({ status = 'active' } = {}) {\n      const result = [];\n      self.users.forEach(user => {\n        if (user.status === status) {\n          result.push({\n            key: user.id,\n            value: user.id,\n            text: user.longDisplayName,\n          });\n        }\n      });\n      return result;\n    },\n\n    asUserObject(userIdentifier) {\n      if (userIdentifier) {\n        const { uid, username, ns } = userIdentifier;\n        const user = self.users.get(uid);\n        return user || User.create({ username, ns });\n      }\n      return undefined;\n    },\n\n    asUserObjects(userIdentifiers = []) {\n      const result = [];\n      userIdentifiers.forEach(userIdentifier => {\n        if (userIdentifier) {\n          const user = self.users.get(userIdentifier.uid);\n          if (user) {\n            result.push(user);\n          } else {\n            result.push(User.create(getSnapshot(userIdentifier)));\n          }\n        }\n      });\n\n      return result;\n    },\n  }));\n\nfunction toUserIds(userObjects) {\n  return _.map(userObjects, user => user.id);\n}\n\nfunction toLongNames(userObjects) {\n  return _.map(userObjects, user => user.longDisplayName);\n}\n\nfunction toLongName(object) {\n  if (object) {\n    return object.longDisplayName;\n  }\n  return 'Unknown';\n}\n\nfunction registerContextItems(appContext) {\n  appContext.usersStore = UsersStore.create({}, appContext);\n}\n\nexport { UsersStore, toUserIds, toLongNames, toLongName, registerContextItems };\n"],"file":"UsersStore.js"}