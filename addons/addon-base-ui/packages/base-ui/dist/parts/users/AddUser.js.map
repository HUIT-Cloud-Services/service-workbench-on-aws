{"version":3,"sources":["../../../src/parts/users/AddUser.js"],"names":["AddUser","props","handleCancel","event","preventDefault","stopPropagation","formProcessing","handleSubmit","user","addUserFormFields","validationResult","fails","validationErrors","errors","getStore","addUser","Map","form","renderAddUserForm","processing","fields","toEditableInput","attributeName","type","handleChange","target","value","placeholder","toRadioGroupInput","radioOptions","defaultSelected","isBooleanInput","trueValue","count","_","map","radioOption","label","renderField","isAdmin","status","renderButtons","name","component","explain","hasExplain","isEmpty","fieldErrors","get","hasError","fieldError","pathname","location","link","history","push","usersStore","React","Component","observable"],"mappings":"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","sourcesContent":["/*\n *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\").\n *  You may not use this file except in compliance with the License.\n *  A copy of the License is located at\n *\n *  http://aws.amazon.com/apache2.0\n *\n *  or in the \"license\" file accompanying this file. This file is distributed\n *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n *  express or implied. See the License for the specific language governing\n *  permissions and limitations under the License.\n */\n\nimport React from 'react';\nimport { inject, observer } from 'mobx-react';\nimport { withRouter } from 'react-router-dom';\nimport { decorate, observable, action, runInAction } from 'mobx';\nimport { Button, Dimmer, Header, List, Loader, Radio, Segment } from 'semantic-ui-react';\nimport _ from 'lodash';\n\nimport { getAddUserForm, getAddUserFormFields } from '../../models/forms/AddUserForm';\nimport { displayError } from '../../helpers/notification';\nimport { createLink } from '../../helpers/routing';\nimport validate from '../../models/forms/Validate';\n\nclass AddUser extends React.Component {\n  constructor(props) {\n    super(props);\n\n    runInAction(() => {\n      this.formProcessing = false;\n      this.validationErrors = new Map();\n      this.user = {};\n    });\n    this.form = getAddUserForm();\n    this.addUserFormFields = getAddUserFormFields();\n  }\n\n  render() {\n    return (\n      <div className=\"mt2 animated fadeIn\">\n        <Header as=\"h2\" icon textAlign=\"center\" className=\"mt3\" color=\"grey\">\n          Add User\n        </Header>\n        <div className=\"mt3 ml3 mr3 animated fadeIn\">{this.renderAddUserForm()}</div>\n      </div>\n    );\n  }\n\n  renderAddUserForm() {\n    const processing = this.formProcessing;\n    const fields = this.addUserFormFields;\n    const toEditableInput = (attributeName, type = 'text') => {\n      const handleChange = action(event => {\n        event.preventDefault();\n        this.user[attributeName] = event.target.value;\n      });\n      return (\n        <div className=\"ui focus input\">\n          <input\n            type={type}\n            defaultValue={this.user[attributeName]}\n            placeholder={fields[attributeName].placeholder || ''}\n            onChange={handleChange}\n          />\n        </div>\n      );\n    };\n    const toRadioGroupInput = ({\n      attributeName,\n      radioOptions,\n      defaultSelected,\n      isBooleanInput = true,\n      trueValue = 'yes',\n    }) => {\n      const handleChange = () =>\n        action((event, { value }) => {\n          if (isBooleanInput) {\n            this.user[attributeName] = value === trueValue;\n          } else {\n            this.user[attributeName] = value;\n          }\n          event.stopPropagation();\n        });\n      let count = 0;\n      return (\n        <span>\n          {_.map(radioOptions, radioOption => {\n            return (\n              <Radio\n                key={++count}\n                className=\"ml1\"\n                name={attributeName}\n                checked={defaultSelected === radioOption.value}\n                value={radioOption.value}\n                label={radioOption.label}\n                onChange={handleChange()}\n              />\n            );\n          })}\n        </span>\n      );\n    };\n\n    return (\n      <Segment basic className=\"ui fluid form\">\n        <Dimmer active={processing} inverted>\n          <Loader inverted>Checking</Loader>\n        </Dimmer>\n\n        {this.renderField('username', toEditableInput('username'))}\n        <div className=\"mb4\" />\n\n        {this.renderField('password', toEditableInput('password', 'password'))}\n        <div className=\"mb4\" />\n\n        {this.renderField('email', toEditableInput('email', 'email'))}\n        <div className=\"mb4\" />\n\n        {this.renderField('firstName', toEditableInput('firstName'))}\n        <div className=\"mb4\" />\n\n        {this.renderField('lastName', toEditableInput('lastName'))}\n        <div className=\"mb4\" />\n\n        {this.renderField(\n          'isAdmin',\n          toRadioGroupInput({\n            attributeName: 'isAdmin',\n            defaultSelected: this.user.isAdmin ? 'yes' : 'no',\n            isBooleanInput: true,\n            radioOptions: [\n              { value: 'yes', label: 'Yes' },\n              { value: 'no', label: 'No' },\n            ],\n          }),\n        )}\n        <div className=\"mb4\" />\n\n        {this.renderField(\n          'status',\n          toRadioGroupInput({\n            attributeName: 'status',\n            defaultSelected: this.user.status || 'active',\n            isBooleanInput: false,\n            radioOptions: [\n              { value: 'active', label: 'Active' },\n              { value: 'inactive', label: 'Inactive' },\n            ],\n          }),\n        )}\n        <div className=\"mb4\" />\n\n        {this.renderButtons()}\n      </Segment>\n    );\n  }\n\n  renderButtons() {\n    const processing = this.formProcessing;\n    return (\n      <div className=\"mt3\">\n        <Button floated=\"right\" color=\"blue\" icon disabled={processing} className=\"ml2\" onClick={this.handleSubmit}>\n          Add User\n        </Button>\n        <Button floated=\"right\" disabled={processing} onClick={this.handleCancel}>\n          Cancel\n        </Button>\n      </div>\n    );\n  }\n\n  renderField(name, component) {\n    const fields = this.addUserFormFields;\n    const explain = fields[name].explain;\n    const label = fields[name].label;\n    const hasExplain = !_.isEmpty(explain);\n    const fieldErrors = this.validationErrors.get(name);\n    const hasError = !_.isEmpty(fieldErrors);\n\n    return (\n      <div>\n        <Header className=\"mr3 mt0\" as=\"h2\" color=\"grey\">\n          {label}\n        </Header>\n        {hasExplain && <div className=\"mb2\">{explain}</div>}\n        <div className={`ui big field input block m0 ${hasError ? 'error' : ''}`}>{component}</div>\n        {hasError && (\n          <div className=\"ui pointing red basic label\">\n            <List>\n              {_.map(fieldErrors, fieldError => (\n                <List.Item key={name}>\n                  <List.Content>{fieldError}</List.Content>\n                </List.Item>\n              ))}\n            </List>\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  goto(pathname) {\n    const location = this.props.location;\n    const link = createLink({ location, pathname });\n    this.props.history.push(link);\n  }\n\n  handleCancel = action(event => {\n    event.preventDefault();\n    event.stopPropagation();\n    this.formProcessing = false;\n    this.goto('/users');\n  });\n\n  handleSubmit = action(async () => {\n    this.formProcessing = true;\n    try {\n      // Perform client side validations first\n      const validationResult = await validate(this.user, this.addUserFormFields);\n      // if there are any client side validation errors then do not attempt to make API call\n      if (validationResult.fails()) {\n        runInAction(() => {\n          this.validationErrors = validationResult.errors;\n          this.formProcessing = false;\n        });\n      } else {\n        // There are no client side validation errors so ask the store to add user (which will make API call to server to add the user)\n        await this.getStore().addUser(this.user);\n        runInAction(() => {\n          this.formProcessing = false;\n        });\n        this.goto('/users');\n      }\n    } catch (error) {\n      runInAction(() => {\n        this.formProcessing = false;\n      });\n      displayError(error);\n    }\n  });\n\n  getStore() {\n    return this.props.usersStore;\n  }\n}\n\n// see https://medium.com/@mweststrate/mobx-4-better-simpler-faster-smaller-c1fbc08008da\ndecorate(AddUser, {\n  formProcessing: observable,\n  user: observable,\n  validationErrors: observable,\n});\nexport default inject('userStore', 'usersStore')(withRouter(observer(AddUser)));\n"],"file":"AddUser.js"}