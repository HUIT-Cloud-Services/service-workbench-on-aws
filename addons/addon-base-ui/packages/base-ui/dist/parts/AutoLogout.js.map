{"version":3,"sources":["../../src/parts/AutoLogout.js"],"names":["AutoLogout","props","startDialogCountDown","_","isUndefined","intervalId","dialogCountDown","setInterval","doLogout","cancelDialogCountDown","clearInterval","authentication","logout","autoLogout","handleLogout","event","preventDefault","stopPropagation","undefined","authenticated","app","userAuthenticated","autoLogoutTimeoutInMinutes","modalOpen","React","Component","computed","observable","action"],"mappings":"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","sourcesContent":["/*\n *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\").\n *  You may not use this file except in compliance with the License.\n *  A copy of the License is located at\n *\n *  http://aws.amazon.com/apache2.0\n *\n *  or in the \"license\" file accompanying this file. This file is distributed\n *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n *  express or implied. See the License for the specific language governing\n *  permissions and limitations under the License.\n */\n\nimport _ from 'lodash';\nimport React from 'react';\nimport { observable, action, decorate, runInAction, computed } from 'mobx';\nimport { observer, inject } from 'mobx-react';\nimport { Button, Modal, Header } from 'semantic-ui-react';\nimport IdleTimer from 'react-idle-timer';\n\nimport { autoLogoutTimeoutInMinutes } from '../helpers/settings';\n\n// expected props\n// - authentication\n// - app\nclass AutoLogout extends React.Component {\n  constructor(props) {\n    super(props);\n\n    runInAction(() => {\n      this.dialogCountDown = undefined;\n      this.intervalId = undefined;\n    });\n  }\n\n  get app() {\n    return this.props.app;\n  }\n\n  get authentication() {\n    return this.props.authentication;\n  }\n\n  get modalOpen() {\n    return this.dialogCountDown >= 0;\n  }\n\n  componentDidMount() {}\n\n  clearInterval() {\n    if (!_.isUndefined(this.intervalId)) {\n      clearInterval(this.intervalId);\n      this.intervalId = undefined;\n    }\n    this.dialogCountDown = undefined;\n  }\n\n  startDialogCountDown = () => {\n    if (!_.isUndefined(this.intervalId)) return;\n    this.dialogCountDown = 60;\n\n    this.intervalId = setInterval(async () => {\n      // eslint-disable-next-line consistent-return\n      runInAction(() => {\n        if (this.dialogCountDown <= 0) {\n          return this.doLogout();\n        }\n        this.dialogCountDown -= 1;\n      });\n    }, 1000);\n  };\n\n  cancelDialogCountDown = () => {\n    this.clearInterval();\n  };\n\n  doLogout = async () => {\n    this.clearInterval();\n    return this.authentication.logout({ autoLogout: true });\n  };\n\n  handleLogout = async event => {\n    event.preventDefault();\n    event.stopPropagation();\n    return this.doLogout();\n  };\n\n  render() {\n    const authenticated = this.app.userAuthenticated;\n    if (!authenticated) return null;\n    return (\n      <>\n        <IdleTimer timeout={1000 * 60 * autoLogoutTimeoutInMinutes} onIdle={this.startDialogCountDown} />\n        <Modal open={this.modalOpen} closeOnEscape={false} closeOnDimmerClick={false} centered={false}>\n          <Modal.Header>Are you still there?</Modal.Header>\n          <Modal.Content className=\"center\">\n            <div>For security purposes, you will be logged out in</div>\n            <Header as=\"h1\">{this.dialogCountDown}</Header>\n            <div>seconds</div>\n          </Modal.Content>\n          <Modal.Actions className=\"clearfix\">\n            <Button floated=\"right\" primary content=\"Keep Me Logged In\" onClick={this.cancelDialogCountDown} />\n            <Button floated=\"right\" content=\"Log Out\" onClick={this.handleLogout} />\n          </Modal.Actions>\n        </Modal>\n      </>\n    );\n  }\n}\n\n// see https://medium.com/@mweststrate/mobx-4-better-simpler-faster-smaller-c1fbc08008da\ndecorate(AutoLogout, {\n  app: computed,\n  authentication: computed,\n  modalOpen: computed,\n  intervalId: observable,\n  dialogCountDown: observable,\n  startDialogCountDown: action,\n  doLogout: action,\n  handleLogout: action,\n  cancelDialogCountDown: action,\n  clearInterval: action,\n});\n\nexport default inject('authentication', 'app')(observer(AutoLogout));\n"],"file":"AutoLogout.js"}