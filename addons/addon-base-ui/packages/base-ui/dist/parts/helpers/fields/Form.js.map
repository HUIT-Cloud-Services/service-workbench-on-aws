{"version":3,"sources":["../../../../src/parts/helpers/fields/Form.js"],"names":["Form","props","handleFormSubmission","form","onSuccess","getOnSuccess","formProcessing","result","handleFormErrors","onError","getOnError","errors","getFormErrors","handleSubmit","event","getForm","preventDefault","stopPropagation","onSubmit","formHooks","error","handleCancel","onCancel","getOnCancel","reset","dimmer","_","isUndefined","noop","errorMap","visit","obj","isNil","isString","isEmpty","push","isArray","isObject","forEach","value","size","length","title","toMessage","msg","JSON","stringify","map","index","processing","renderer","isFunction","children","className","getDimmer","showErrorPanel","formContent","renderErrorPanel","renderFormAs","React","Component","observable","action"],"mappings":";;;;;;;;;AAeA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACMA,I;;;;;AACJ,gBAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,8BAAMA,KAAN;;AADiB,UAsDnBC,oBAtDmB;AAAA,yEAsDI,iBAAMC,IAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AACfC,gBAAAA,SADe,GACH,MAAKC,YAAL,EADG;AAErB,sBAAKC,cAAL,GAAsB,IAAtB;AAFqB;AAAA;AAAA,uBAIEF,SAAS,CAACD,IAAD,CAJX;;AAAA;AAIbI,gBAAAA,MAJa;AAKnB,uCAAY,YAAM;AAChB,wBAAKD,cAAL,GAAsB,KAAtB;AACD,iBAFD;AALmB,iDASZC,MATY;;AAAA;AAAA;AAAA;AAWnB,uCAAY,YAAM;AAChB,wBAAKD,cAAL,GAAsB,KAAtB;AACD,iBAFD;AAXmB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAtDJ;;AAAA;AAAA;AAAA;AAAA;;AAAA,UAyEnBE,gBAzEmB;AAAA,0EAyEA,kBAAML,IAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AACXM,gBAAAA,OADW,GACD,MAAKC,UAAL,EADC;AAEjB,sBAAKJ,cAAL,GAAsB,KAAtB;AACMK,gBAAAA,MAHW,GAGF,MAAKC,aAAL,EAHE;AAAA,kDAKVH,OAAO,CAACN,IAAD,EAAOQ,MAAP,CALG;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAzEA;;AAAA;AAAA;AAAA;AAAA;;AAAA,UAiFnBE,YAjFmB,GAiFJ,UAAAC,KAAK,EAAI;AACtB,UAAMX,IAAI,GAAG,MAAKY,OAAL,EAAb;;AACAD,MAAAA,KAAK,CAACE,cAAN;AACAF,MAAAA,KAAK,CAACG,eAAN;AACA,YAAKX,cAAL,GAAsB,IAAtB;;AACA,UAAI;AACF,eAAOH,IAAI,CAACe,QAAL,CAAcJ,KAAd,EAAqB,MAAKK,SAA1B,CAAP;AACD,OAFD,CAEE,OAAOC,KAAP,EAAc;AACd,cAAKd,cAAL,GAAsB,KAAtB;AACA,cAAMc,KAAN;AACD;AACF,KA5FkB;;AAAA,UA8FnBC,YA9FmB,GA8FJ,UAAAP,KAAK,EAAI;AACtB,UAAMX,IAAI,GAAG,MAAKY,OAAL,EAAb;;AACA,UAAMO,QAAQ,GAAG,MAAKC,WAAL,EAAjB;;AAEAT,MAAAA,KAAK,CAACE,cAAN;AACAF,MAAAA,KAAK,CAACG,eAAN;AACA,YAAKX,cAAL,GAAsB,KAAtB;AACAH,MAAAA,IAAI,CAACqB,KAAL;AACAF,MAAAA,QAAQ,CAACnB,IAAD,CAAR;AACD,KAvGkB;;AAEjB,UAAKgB,SAAL,GAAiB;AACff,MAAAA,SAAS,EAAE,MAAKF,oBADD;AAEfO,MAAAA,OAAO,EAAE,MAAKD;AAFC,KAAjB;AAKA,2BAAY,YAAM;AAChB,YAAKF,cAAL,GAAsB,KAAtB;AACD,KAFD;AAPiB;AAUlB;;;;8BAES;AACR,aAAO,KAAKL,KAAL,CAAWE,IAAlB;AACD;;;gCAEW;AACV,UAAMsB,MAAM,GAAG,KAAKxB,KAAL,CAAWwB,MAA1B;AACA,aAAOC,mBAAEC,WAAF,CAAcF,MAAd,IAAwB,IAAxB,GAA+B,CAAC,CAACA,MAAxC;AACD;;;kCAEa;AACZ,aAAO,KAAKxB,KAAL,CAAWqB,QAAX,IAAuBI,mBAAEE,IAAhC;AACD;;;mCAEc;AACb,aAAO,KAAK3B,KAAL,CAAWG,SAAX,IAAwBsB,mBAAEE,IAAjC;AACD;;;iCAEY;AACX,aAAO,KAAK3B,KAAL,CAAWQ,OAAX,IAAsBiB,mBAAEE,IAA/B;AACD;;;oCAEe;AACd,UAAMzB,IAAI,GAAG,KAAKY,OAAL,EAAb;AACA,UAAMc,QAAQ,GAAG1B,IAAI,CAACQ,MAAL,MAAiB,EAAlC;AACA,UAAMA,MAAM,GAAG,EAAf;;AACA,UAAMmB,KAAK,GAAG,SAARA,KAAQ,CAAAC,GAAG,EAAI;AACnB,YAAIL,mBAAEM,KAAF,CAAQD,GAAR,CAAJ,EAAkB;;AAClB,YAAIL,mBAAEO,QAAF,CAAWF,GAAX,KAAmB,CAACL,mBAAEQ,OAAF,CAAUH,GAAV,CAAxB,EAAwC;AACtCpB,UAAAA,MAAM,CAACwB,IAAP,CAAYJ,GAAZ;AACA;AACD;;AACD,YAAIL,mBAAEU,OAAF,CAAUL,GAAV,KAAkBL,mBAAEW,QAAF,CAAWN,GAAX,CAAtB,EAAuC;AACrCL,6BAAEY,OAAF,CAAUP,GAAV,EAAe,UAAAQ,KAAK,EAAI;AACtBT,YAAAA,KAAK,CAACS,KAAD,CAAL;AACD,WAFD;AAGD;AACF,OAXD;;AAaAT,MAAAA,KAAK,CAACD,QAAD,CAAL;AACA,aAAOlB,MAAP;AACD;;;uCAqDkB;AACjB,UAAMA,MAAM,GAAG,KAAKC,aAAL,EAAf;AACA,UAAM4B,IAAI,GAAG7B,MAAM,CAAC8B,MAApB;AACA,UAAID,IAAI,KAAK,CAAb,EAAgB,OAAO,IAAP;AAChB,UAAME,KAAK,+CAAwCF,IAAI,KAAK,CAAT,GAAa,EAAb,GAAkB,GAA1D,CAAX;;AACA,UAAMG,SAAS,GAAG,SAAZA,SAAY,CAAAC,GAAG;AAAA,eAAKlB,mBAAEW,QAAF,CAAWO,GAAX,IAAkBC,IAAI,CAACC,SAAL,CAAeF,GAAf,CAAlB,aAA2CA,GAA3C,CAAL;AAAA,OAArB;;AAEA,0BACE,gCAAC,wBAAD;AAAS,QAAA,SAAS,EAAC,yBAAnB;AAA6C,QAAA,QAAQ;AAArD,sBACE,gCAAC,wBAAD,CAAS,MAAT,QAAiBF,KAAjB,CADF,eAEE,gCAAC,wBAAD,CAAS,IAAT,QACGhB,mBAAEqB,GAAF,CAAMpC,MAAN,EAAc,UAACiC,GAAD,EAAMI,KAAN;AAAA,4BACb,gCAAC,wBAAD,CAAS,IAAT;AAAc,UAAA,GAAG,EAAEA;AAAnB,WAA2BL,SAAS,CAACC,GAAD,CAApC,CADa;AAAA,OAAd,CADH,CAFF,CADF;AAUD;;;6BAEQ;AACP,UAAMK,UAAU,GAAG,KAAK3C,cAAxB;AACA,UAAM4C,QAAQ,GAAGxB,mBAAEyB,UAAF,CAAa,KAAKlD,KAAL,CAAWmD,QAAxB,IAAoC,KAAKnD,KAAL,CAAWmD,QAA/C,GAA0D1B,mBAAEE,IAA7E;AACA,UAAMyB,SAAS,GAAG,KAAKpD,KAAL,CAAWoD,SAA7B;AACA,UAAM5B,MAAM,GAAG,KAAK6B,SAAL,EAAf;AACA,UAAM3C,MAAM,GAAG,KAAKC,aAAL,EAAf;AAEA,UAAM2C,cAAc,GAAG7B,mBAAEM,KAAF,CAAQ,KAAK/B,KAAL,CAAWsD,cAAnB,KAAsC,KAAKtD,KAAL,CAAWsD,cAAxE;;AAEA,UAAMC,WAAW,gBACf,kEACG/B,MAAM,iBACL,gCAAC,uBAAD;AAAQ,QAAA,MAAM,EAAEwB,UAAhB;AAA4B,QAAA,QAAQ;AAApC,sBACE,gCAAC,uBAAD;AAAQ,QAAA,QAAQ;AAAhB,sBADF,CAFJ,EAMGM,cAAc,IAAI,KAAKE,gBAAL,EANrB,EAOGP,QAAQ,CAAC;AACRD,QAAAA,UAAU,EAAVA,UADQ;AAERtC,QAAAA,MAAM,EAANA,MAFQ;AAGRO,QAAAA,QAAQ,EAAE,KAAKL,YAHP;AAIRS,QAAAA,QAAQ,EAAE,KAAKD;AAJP,OAAD,CAPX,CADF;;AAgBA,UAAMqC,YAAY,GAAG,KAAKzD,KAAL,CAAWyD,YAAhC;;AACA,UAAIhC,mBAAEyB,UAAF,CAAaO,YAAb,CAAJ,EAAgC;AAC9B,eAAOA,YAAY,CAACF,WAAD,CAAnB;AACD;;AACD,0BACE;AAAM,QAAA,SAAS,EAAE,4BAAE,eAAF,EAAmBH,SAAnB,CAAjB;AAAgD,QAAA,QAAQ,EAAE,KAAKxC;AAA/D,SACG2C,WADH,CADF;AAKD;;;;EA/JgBG,kBAAMC,S,GAkKzB;;;AACA,oBAAS5D,IAAT,EAAe;AACbM,EAAAA,cAAc,EAAEuD,gBADH;AAEbhD,EAAAA,YAAY,EAAEiD,YAFD;AAGb5D,EAAAA,oBAAoB,EAAE4D,YAHT;AAIbtD,EAAAA,gBAAgB,EAAEsD,YAJL;AAKbzC,EAAAA,YAAY,EAAEyC;AALD,CAAf;;eAQe,yBAAS9D,IAAT,C","sourcesContent":["/*\n *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\").\n *  You may not use this file except in compliance with the License.\n *  A copy of the License is located at\n *\n *  http://aws.amazon.com/apache2.0\n *\n *  or in the \"license\" file accompanying this file. This file is distributed\n *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n *  express or implied. See the License for the specific language governing\n *  permissions and limitations under the License.\n */\n\nimport _ from 'lodash';\nimport React from 'react';\nimport { observer } from 'mobx-react';\nimport { decorate, action, observable, runInAction } from 'mobx';\nimport { Dimmer, Loader, Message } from 'semantic-ui-react';\nimport c from 'classnames';\n\n// expected props\n// - form (via props) the mobx form instance\n// - onSuccess (via props) is called once mobx form calls on hooks.onSuccess(), receives (form)\n// - onError (via props) is called once mobx form calls on hooks.onError(), receives (form)\n// - onCancel (via props) receives (form)\n// - dimmer (via props) default to true, set to false if you don't want to use the dimmer (buttons will still be disabled during processing)\n// - className (via props)\n// - showErrorPanel (via props) default to true, set to false if you don't want the error panel to be rendered (i.e., if you only want the errors to be displayed next to the fields but not show the main error panel)\nclass Form extends React.Component {\n  constructor(props) {\n    super(props);\n    this.formHooks = {\n      onSuccess: this.handleFormSubmission,\n      onError: this.handleFormErrors,\n    };\n\n    runInAction(() => {\n      this.formProcessing = false;\n    });\n  }\n\n  getForm() {\n    return this.props.form;\n  }\n\n  getDimmer() {\n    const dimmer = this.props.dimmer;\n    return _.isUndefined(dimmer) ? true : !!dimmer;\n  }\n\n  getOnCancel() {\n    return this.props.onCancel || _.noop;\n  }\n\n  getOnSuccess() {\n    return this.props.onSuccess || _.noop;\n  }\n\n  getOnError() {\n    return this.props.onError || _.noop;\n  }\n\n  getFormErrors() {\n    const form = this.getForm();\n    const errorMap = form.errors() || {};\n    const errors = [];\n    const visit = obj => {\n      if (_.isNil(obj)) return;\n      if (_.isString(obj) && !_.isEmpty(obj)) {\n        errors.push(obj);\n        return;\n      }\n      if (_.isArray(obj) || _.isObject(obj)) {\n        _.forEach(obj, value => {\n          visit(value);\n        });\n      }\n    };\n\n    visit(errorMap);\n    return errors;\n  }\n\n  handleFormSubmission = async form => {\n    const onSuccess = this.getOnSuccess();\n    this.formProcessing = true;\n    try {\n      const result = await onSuccess(form);\n      runInAction(() => {\n        this.formProcessing = false;\n      });\n\n      return result;\n    } catch (error) {\n      runInAction(() => {\n        this.formProcessing = false;\n      });\n\n      throw error;\n    }\n  };\n\n  handleFormErrors = async form => {\n    const onError = this.getOnError();\n    this.formProcessing = false;\n    const errors = this.getFormErrors();\n\n    return onError(form, errors);\n  };\n\n  handleSubmit = event => {\n    const form = this.getForm();\n    event.preventDefault();\n    event.stopPropagation();\n    this.formProcessing = true;\n    try {\n      return form.onSubmit(event, this.formHooks);\n    } catch (error) {\n      this.formProcessing = false;\n      throw error;\n    }\n  };\n\n  handleCancel = event => {\n    const form = this.getForm();\n    const onCancel = this.getOnCancel();\n\n    event.preventDefault();\n    event.stopPropagation();\n    this.formProcessing = false;\n    form.reset();\n    onCancel(form);\n  };\n\n  renderErrorPanel() {\n    const errors = this.getFormErrors();\n    const size = errors.length;\n    if (size === 0) return null;\n    const title = `Please Correct The Following Error${size === 1 ? '' : 's'}`;\n    const toMessage = msg => (_.isObject(msg) ? JSON.stringify(msg) : `${msg}`);\n\n    return (\n      <Message className=\"mb3 mt0 animated fadeIn\" negative>\n        <Message.Header>{title}</Message.Header>\n        <Message.List>\n          {_.map(errors, (msg, index) => (\n            <Message.Item key={index}>{toMessage(msg)}</Message.Item>\n          ))}\n        </Message.List>\n      </Message>\n    );\n  }\n\n  render() {\n    const processing = this.formProcessing;\n    const renderer = _.isFunction(this.props.children) ? this.props.children : _.noop;\n    const className = this.props.className;\n    const dimmer = this.getDimmer();\n    const errors = this.getFormErrors();\n\n    const showErrorPanel = _.isNil(this.props.showErrorPanel) || this.props.showErrorPanel;\n\n    const formContent = (\n      <>\n        {dimmer && (\n          <Dimmer active={processing} inverted>\n            <Loader inverted>Processing</Loader>\n          </Dimmer>\n        )}\n        {showErrorPanel && this.renderErrorPanel()}\n        {renderer({\n          processing,\n          errors,\n          onSubmit: this.handleSubmit,\n          onCancel: this.handleCancel,\n        })}\n      </>\n    );\n    const renderFormAs = this.props.renderFormAs;\n    if (_.isFunction(renderFormAs)) {\n      return renderFormAs(formContent);\n    }\n    return (\n      <form className={c('ui fluid form', className)} onSubmit={this.handleSubmit}>\n        {formContent}\n      </form>\n    );\n  }\n}\n\n// see https://medium.com/@mweststrate/mobx-4-better-simpler-faster-smaller-c1fbc08008da\ndecorate(Form, {\n  formProcessing: observable,\n  handleSubmit: action,\n  handleFormSubmission: action,\n  handleFormErrors: action,\n  handleCancel: action,\n});\n\nexport default observer(Form);\n"],"file":"Form.js"}